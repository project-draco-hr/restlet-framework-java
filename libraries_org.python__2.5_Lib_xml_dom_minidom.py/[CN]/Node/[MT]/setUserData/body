def setUserData(self, key, data, handler):
    old = None
    try:
        d = self._user_data
    except AttributeError:
        d = {}
        self._user_data = d
    if d.has_key(key):
        old = d[key][0]
    if (data is None):
        handler = None
        if (old is not None):
            del d[key]
    else:
        d[key] = (data, handler)
    return old
