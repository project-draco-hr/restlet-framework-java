{
  Representation result=null;
  long contentLength=HeaderUtils.getContentLength(headers);
  boolean chunkedEncoding=HeaderUtils.isChunkedEncoding(headers);
  boolean connectionClose=HeaderUtils.isConnectionClose(headers);
  if ((contentLength != Representation.UNKNOWN_SIZE && contentLength != 0) || chunkedEncoding || connectionClose) {
    ReadableByteChannel inboundEntityChannel=null;
    ReadableBufferedChannel rbc=new ReadableBufferedChannel(this,getByteBuffer(),getConnection().getReadableSelectionChannel());
    if (chunkedEncoding) {
      inboundEntityChannel=new ReadableChunkedChannel(rbc);
    }
 else {
      inboundEntityChannel=new ReadableSizedSelectionChannel(rbc,contentLength);
    }
    setEntityRegistration(rbc.getRegistration());
    if (inboundEntityChannel != null) {
      result=new ReadableRepresentation(inboundEntityChannel,null,contentLength){
        @Override public void release(){
          getConnection().close(false);
        }
      }
;
      result.setSize(contentLength);
      setMessageState(MessageState.BODY);
    }
  }
 else {
    result=new EmptyRepresentation();
  }
  if (headers != null) {
    try {
      result=HeaderUtils.extractEntityHeaders(headers,result);
    }
 catch (    Throwable t) {
      getLogger().log(Level.WARNING,"Error while parsing entity headers",t);
    }
  }
  return result;
}
