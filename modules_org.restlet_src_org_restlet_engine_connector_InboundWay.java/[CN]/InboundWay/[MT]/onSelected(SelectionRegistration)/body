{
  try {
    super.onSelected(registration);
    if ((getMessageState() == MessageState.BODY) && (getEntityRegistration() != null)) {
      getEntityRegistration().onSelected(registration.getReadyOperations());
    }
 else {
      while (isSelected()) {
        int result=getIoBuffer().refill(getConnection().getReadableSelectionChannel());
        if (result == 0) {
          if (getIoState() == IoState.PROCESSING) {
            setIoState(IoState.INTEREST);
          }
        }
 else         if (result == -1) {
          getConnection().close(true);
          setIoState(IoState.IDLE);
          setMessageState(MessageState.IDLE);
        }
        while (isMessageReadable()) {
          readMessage();
        }
      }
    }
  }
 catch (  Exception e) {
    getConnection().onError("Error while reading a message. Closing the connection.",e,Status.CONNECTOR_ERROR_COMMUNICATION);
  }
}
