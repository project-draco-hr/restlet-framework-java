{
  try {
    super.onSelected(registration);
    if ((getMessageState() == MessageState.BODY) && (getEntityRegistration() != null)) {
      getEntityRegistration().onSelected(registration.getReadyOperations());
    }
 else {
      while (isSelected()) {
        if (getIoBuffer().isFilling()) {
          int result=getIoBuffer().fill(getConnection().getReadableSelectionChannel());
          if (result == 0) {
            if (getIoState() == IoState.PROCESSING) {
              setIoState(IoState.INTEREST);
            }
          }
 else           if (result == -1) {
            getConnection().close(true);
            setIoState(IoState.IDLE);
            setMessageState(MessageState.IDLE);
          }
        }
        while (isMessageReadable()) {
          readMessage();
        }
      }
    }
  }
 catch (  Exception e) {
    getLogger().log(Level.FINE,"Error while reading a message. Closing the connection.",e);
    getConnection().onError("Error while reading a message. Closing the connection.",e,Status.CONNECTOR_ERROR_COMMUNICATION);
  }
}
