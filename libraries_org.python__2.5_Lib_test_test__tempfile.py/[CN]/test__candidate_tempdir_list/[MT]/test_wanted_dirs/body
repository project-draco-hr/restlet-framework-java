def test_wanted_dirs(self):
    added = []
    try:
        for envname in ('TMPDIR', 'TEMP', 'TMP'):
            dirname = os.getenv(envname)
            if (not dirname):
                os.environ[envname] = os.path.abspath(envname)
                added.append(envname)
        cand = tempfile._candidate_tempdir_list()
        for envname in ('TMPDIR', 'TEMP', 'TMP'):
            dirname = os.getenv(envname)
            if (not dirname):
                raise ValueError
            self.assert_((dirname in cand))
        try:
            dirname = os.getcwd()
        except (AttributeError, os.error):
            dirname = os.curdir
        self.assert_((dirname in cand))
    finally:
        for p in added:
            del os.environ[p]
