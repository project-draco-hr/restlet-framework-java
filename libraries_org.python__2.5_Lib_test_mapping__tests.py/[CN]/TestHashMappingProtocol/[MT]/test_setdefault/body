def test_setdefault(self):
    TestMappingProtocol.test_setdefault(self)


    class Exc(Exception):
        pass


    class BadHash(object):
        fail = False

        def __hash__(self):
            if self.fail:
                raise Exc()
            else:
                return 42
    d = self._empty_mapping()
    x = BadHash()
    d[x] = 42
    x.fail = True
    self.assertRaises(Exc, d.setdefault, x, [])
