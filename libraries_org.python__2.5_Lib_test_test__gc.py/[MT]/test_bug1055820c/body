def test_bug1055820c():
    c0 = C1055820(0)
    gc.collect()
    c1 = C1055820(1)
    c1.keep_c0_alive = c0
    del c0.loop
    c2 = C1055820(2)
    c2wr = weakref.ref(c2)
    ouch = []

    def callback(ignored):
        ouch[:] = [c2wr()]
    c0wr = weakref.ref(c0, callback)
    c0 = c1 = c2 = None
    junk = []
    i = 0
    detector = GC_Detector()
    while (not detector.gc_happened):
        i += 1
        if (i > 10000):
            raise TestFailed("gc didn't happen after 10000 iterations")
        expect(len(ouch), 0, 'bug1055820c')
        junk.append([])
    expect(len(ouch), 1, 'bug1055820c')
    for x in ouch:
        expect(x, None, 'bug1055820c')
