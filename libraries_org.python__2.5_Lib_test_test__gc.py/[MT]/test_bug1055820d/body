def test_bug1055820d():
    ouch = []


    class D(C1055820):

        def __del__(self):
            ouch[:] = [c2wr()]
    d0 = D(0)
    gc.collect()
    c1 = C1055820(1)
    c1.keep_d0_alive = d0
    del d0.loop
    c2 = C1055820(2)
    c2wr = weakref.ref(c2)
    d0 = c1 = c2 = None
    detector = GC_Detector()
    junk = []
    i = 0
    while (not detector.gc_happened):
        i += 1
        if (i > 10000):
            raise TestFailed("gc didn't happen after 10000 iterations")
        expect(len(ouch), 0, 'bug1055820d')
        junk.append([])
    expect(len(ouch), 1, 'bug1055820d')
    for x in ouch:
        expect(x, None, 'bug1055820d')
