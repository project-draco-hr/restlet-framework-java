def compile(p, flags=0):
    if isstring(p):
        import sre_parse
        pattern = p
        p = sre_parse.parse(p, flags)
    else:
        pattern = None
    code = _code(p, flags)
    if (p.pattern.groups > 100):
        raise AssertionError('sorry, but this version only supports 100 named groups')
    groupindex = p.pattern.groupdict
    indexgroup = ([None] * p.pattern.groups)
    for (k, i) in groupindex.items():
        indexgroup[i] = k
    return _sre.compile(pattern, (flags | p.pattern.flags), code, (p.pattern.groups - 1), groupindex, indexgroup)
