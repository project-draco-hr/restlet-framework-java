def resolveEntity(self, publicId, systemId):
    assert (systemId is not None)
    source = DOMInputSource()
    source.publicId = publicId
    source.systemId = systemId
    source.byteStream = self._get_opener().open(systemId)
    source.encoding = self._guess_media_encoding(source)
    import posixpath, urlparse
    parts = urlparse.urlparse(systemId)
    (scheme, netloc, path, params, query, fragment) = parts
    if (path and (not path.endswith('/'))):
        path = (posixpath.dirname(path) + '/')
        parts = (scheme, netloc, path, params, query, fragment)
        source.baseURI = urlparse.urlunparse(parts)
    return source
