def writestr(self, zinfo_or_arcname, bytes):
    "Write a file into the archive.  The contents is the string\n        'bytes'.  'zinfo_or_arcname' is either a ZipInfo instance or\n        the name of the file in the archive."
    if (not isinstance(zinfo_or_arcname, ZipInfo)):
        zinfo = ZipInfo(filename=zinfo_or_arcname, date_time=time.localtime(time.time())[:6])
        zinfo.compress_type = self.compression
    else:
        zinfo = zinfo_or_arcname
    zinfo.file_size = len(bytes)
    zinfo.header_offset = self.fp.tell()
    self._writecheck(zinfo)
    self._didModify = True
    zinfo.CRC = binascii.crc32(bytes)
    if (zinfo.compress_type == ZIP_DEFLATED):
        co = zlib.compressobj(zlib.Z_DEFAULT_COMPRESSION, zlib.DEFLATED, (-15))
        bytes = (co.compress(bytes) + co.flush())
        zinfo.compress_size = len(bytes)
    else:
        zinfo.compress_size = zinfo.file_size
    zinfo.header_offset = self.fp.tell()
    self.fp.write(zinfo.FileHeader())
    self.fp.write(bytes)
    self.fp.flush()
    if (zinfo.flag_bits & 8):
        self.fp.write(struct.pack('<lLL', zinfo.CRC, zinfo.compress_size, zinfo.file_size))
    self.filelist.append(zinfo)
    self.NameToInfo[zinfo.filename] = zinfo
