def __init__(self, file, mode='r', compression=ZIP_STORED, allowZip64=False):
    'Open the ZIP file with mode read "r", write "w" or append "a".'
    self._allowZip64 = allowZip64
    self._didModify = False
    if (compression == ZIP_STORED):
        pass
    elif (compression == ZIP_DEFLATED):
        if (not zlib):
            raise RuntimeError, 'Compression requires the (missing) zlib module'
    else:
        raise RuntimeError, 'That compression method is not supported'
    self.debug = 0
    self.NameToInfo = {}
    self.filelist = []
    self.compression = compression
    self.mode = key = mode.replace('b', '')[0]
    if isinstance(file, basestring):
        self._filePassed = 0
        self.filename = file
        modeDict = {'r': 'rb', 'w': 'wb', 'a': 'r+b', }
        self.fp = open(file, modeDict[mode])
    else:
        self._filePassed = 1
        self.fp = file
        self.filename = getattr(file, 'name', None)
    if (key == 'r'):
        self._GetContents()
    elif (key == 'w'):
        pass
    elif (key == 'a'):
        try:
            self._RealGetContents()
            self.fp.seek(self.start_dir, 0)
        except BadZipfile:
            self.fp.seek(0, 2)
    else:
        if (not self._filePassed):
            self.fp.close()
            self.fp = None
        raise RuntimeError, 'Mode must be "r", "w" or "a"'
