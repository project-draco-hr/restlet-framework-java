def _safe_import_hook(self, name, caller, fromlist):
    if (name in self.badmodules):
        self._add_badmodule(name, caller)
        return
    try:
        self.import_hook(name, caller)
    except ImportError as msg:
        self.msg(2, 'ImportError:', str(msg))
        self._add_badmodule(name, caller)
    else:
        if fromlist:
            for sub in fromlist:
                if (sub in self.badmodules):
                    self._add_badmodule(sub, caller)
                    continue
                try:
                    self.import_hook(name, caller, [sub])
                except ImportError as msg:
                    self.msg(2, 'ImportError:', str(msg))
                    fullname = ((name + '.') + sub)
                    self._add_badmodule(fullname, caller)
