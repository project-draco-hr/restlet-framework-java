def test_randbelow_logic(self, _log=log, int=int):
    for i in xrange(1, 1000):
        n = (1L << i)
        numbits = (i + 1)
        k = int((1.00001 + _log(n, 2)))
        self.assertEqual(k, numbits)
        self.assert_((n == (2 ** (k - 1))))
        n += (n - 1)
        k = int((1.00001 + _log(n, 2)))
        self.assert_((k in [numbits, (numbits + 1)]))
        self.assert_(((2 ** k) > n > (2 ** (k - 2))))
        n -= (n >> 15)
        k = int((1.00001 + _log(n, 2)))
        self.assertEqual(k, numbits)
        self.assert_(((2 ** k) > n > (2 ** (k - 1))))
