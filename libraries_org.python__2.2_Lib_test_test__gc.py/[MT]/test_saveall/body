def test_saveall():
    debug = gc.get_debug()
    gc.set_debug((debug | gc.DEBUG_SAVEALL))
    l = []
    l.append(l)
    id_l = id(l)
    del l
    gc.collect()
    try:
        for obj in gc.garbage:
            if (id(obj) == id_l):
                del obj[:]
                break
        else:
            raise TestFailed, "didn't find obj in garbage (saveall)"
        gc.garbage.remove(obj)
    finally:
        gc.set_debug(debug)
