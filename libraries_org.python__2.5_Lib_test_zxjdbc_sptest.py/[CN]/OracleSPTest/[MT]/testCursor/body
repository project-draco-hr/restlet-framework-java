def testCursor(self):
    c = self.cursor()
    try:
        c.execute("insert into sptest values ('a')")
        c.execute("insert into sptest values ('b')")
        c.execute("insert into sptest values ('c')")
        c.execute("insert into sptest values ('d')")
        c.execute("insert into sptest values ('e')")
        c.execute('\n                    CREATE OR REPLACE PACKAGE types\n                    AS\n                            TYPE ref_cursor IS REF CURSOR;\n                    END;\n            ')
        c.execute('\n                    CREATE OR REPLACE FUNCTION funccur(v_x IN VARCHAR)\n                            RETURN types.ref_cursor\n                    AS\n                            funccur_cursor types.ref_cursor;\n                    BEGIN\n                            OPEN funccur_cursor FOR\n                                    SELECT x FROM sptest WHERE x < v_x;\n                            RETURN funccur_cursor;\n                    END;\n            ')
        self.proc_errors('funccur')
        c.callproc('funccur', ('z',))
        data = c.fetchall()
        self.assertEquals(5, len(data))
        c.callproc('funccur', ('c',))
        data = c.fetchall()
        self.assertEquals(2, len(data))
    finally:
        c.close()
