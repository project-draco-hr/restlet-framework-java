def test_weakref(self):
    if (sys.platform[:4] == 'java'):
        return
    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    p = proxy(s)
    self.assertEqual(p.fileno(), s.fileno())
    s.close()
    s = None
    try:
        p.fileno()
    except ReferenceError:
        pass
    else:
        self.fail('Socket proxy still exists')
