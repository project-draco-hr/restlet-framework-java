def _testOption(self, level, option, values):
    for (flag, func) in [(self.test_udp, self._testUDPOption), (self.test_tcp_server, self._testTCPServerOption), (self.test_tcp_client, self._testTCPClientOption)]:
        if flag:
            func(level, option, values)
        else:
            try:
                func(level, option, values)
            except socket.error as se:
                self.failUnlessEqual(se[0], errno.ENOPROTOOPT, ('Wrong errno from unsupported option exception: %d' % se[0]))
            except Exception as x:
                self.fail(('Wrong exception raised from unsupported option: %s' % str(x)))
            else:
                self.fail('Setting unsupported option should have raised an exception')
