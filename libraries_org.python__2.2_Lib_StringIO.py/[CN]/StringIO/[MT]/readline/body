def readline(self, length=None):
    if self.closed:
        raise ValueError, 'I/O operation on closed file'
    if self.buflist:
        self.buf += ''.join(self.buflist)
        self.buflist = []
    i = self.buf.find('\n', self.pos)
    if (i < 0):
        newpos = self.len
    else:
        newpos = (i + 1)
    if (length is not None):
        if ((self.pos + length) < newpos):
            newpos = (self.pos + length)
    r = self.buf[self.pos:newpos]
    self.pos = newpos
    return r
