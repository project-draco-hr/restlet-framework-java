def close(self):
    if (self.state < _DID_DATA):
        self.close_data()
    if (self.state != _DID_DATA):
        raise Error, 'Close at the wrong time'
    if (self.rlen != 0):
        raise Error, ('Incorrect resource-datasize, diff=%r' % (self.rlen,))
    self._writecrc()
    self.ofp.close()
    self.state = None
    del self.ofp
