def listdir(path):
    'List directory contents, using cache.'
    try:
        (cached_mtime, list) = cache[path]
        del cache[path]
    except KeyError:
        (cached_mtime, list) = ((-1), [])
    try:
        mtime = os.stat(path)[8]
    except os.error:
        return []
    if (mtime != cached_mtime):
        try:
            list = os.listdir(path)
        except os.error:
            return []
        list.sort()
    cache[path] = (mtime, list)
    return list
