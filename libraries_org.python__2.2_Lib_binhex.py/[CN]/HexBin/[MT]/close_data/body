def close_data(self):
    if (self.state != _DID_HEADER):
        raise Error, 'close_data at wrong time'
    if self.dlen:
        dummy = self._read(self.dlen)
    self._checkcrc()
    self.state = _DID_DATA
