{
  boolean bContinue=true;
  if (hasPreconditions(request.getConditions())) {
    Variant preferredVariant=null;
    if (isNegotiateContent()) {
      List<Variant> variants=target.getVariants();
      if ((variants != null) && (!variants.isEmpty())) {
        preferredVariant=response.getRequest().getClientInfo().getPreferredVariant(variants);
      }
    }
 else {
      List<Variant> variants=target.getVariants();
      if (variants.size() == 1) {
        preferredVariant=variants.get(0);
      }
 else {
        response.setStatus(Status.CLIENT_ERROR_PRECONDITION_FAILED);
        bContinue=false;
      }
    }
    if (preferredVariant != null && bContinue) {
      Status status=getConditionalStatus(request.getConditions(),request.getMethod(),preferredVariant);
      if (status != null) {
        response.setStatus(status);
        bContinue=false;
      }
    }
  }
  if (bContinue) {
    Object oHeaders=request.getAttributes().get("org.restlet.http.headers");
    if (oHeaders != null) {
      Series headers=(Series)oHeaders;
      if (headers.getFirst("Content-Range",true) != null) {
        response.setStatus(new Status(Status.SERVER_ERROR_NOT_IMPLEMENTED,"the Content-Range header is not understood"));
        bContinue=false;
      }
    }
  }
  if (bContinue) {
    if (request.isEntityAvailable()) {
      Result result=target.put(request.getEntity());
      response.setStatus(result.getStatus());
      response.setRedirectRef(result.getRedirectRef());
      response.setEntity(result.getEntity());
      updateAllowedMethods(response,target);
    }
 else {
      response.setStatus(new Status(Status.CLIENT_ERROR_BAD_REQUEST,"Missing request entity"));
    }
  }
}
