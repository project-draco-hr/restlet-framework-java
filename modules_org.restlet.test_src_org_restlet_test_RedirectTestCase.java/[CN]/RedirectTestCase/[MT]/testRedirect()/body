{
  Component clientComponent=new Component();
  Component proxyComponent=new Component();
  Component originComponent=new Component();
  clientComponent.getClients().add(Protocol.HTTP);
  proxyComponent.getClients().add(Protocol.HTTP);
  String target="http://localhost:9090{rr}";
  Redirector proxy=new Redirector(proxyComponent.getContext(),target,Redirector.MODE_DISPATCHER);
  Restlet trace=new Restlet(originComponent.getContext()){
    @Override public void handle(    Request request,    Response response){
      String message="Resource URI:  " + request.getResourceRef() + '\n'+ "Base URI:      "+ request.getResourceRef().getBaseRef()+ '\n'+ "Remaining part: "+ request.getResourceRef().getRemainingPart()+ '\n'+ "Method name:   "+ request.getMethod()+ '\n';
      response.setEntity(new StringRepresentation(message,MediaType.TEXT_PLAIN));
    }
  }
;
  proxyComponent.getDefaultHost().attach("",proxy);
  originComponent.getDefaultHost().attach("",trace);
  proxyComponent.getServers().add(Protocol.HTTP,8182);
  originComponent.getServers().add(Protocol.HTTP,9090);
  originComponent.start();
  proxyComponent.start();
  clientComponent.start();
  Context context=clientComponent.getContext();
  String uri="http://localhost:8182/?foo=bar";
  testCall(context,Method.GET,uri);
  testCall(context,Method.DELETE,uri);
  uri="http://localhost:8182/abcd/efgh/ijkl?foo=bar&foo=beer";
  testCall(context,Method.GET,uri);
  testCall(context,Method.DELETE,uri);
  uri="http://localhost:8182/v1/client/kwse/CnJlNUQV9%252BNNqbUf7Lhs2BYEK2Y%253D/user/johnm/uVGYTDK4kK4zsu96VHGeTCzfwso%253D/";
  testCall(context,Method.GET,uri);
  clientComponent.stop();
  originComponent.stop();
  proxyComponent.stop();
}
