def main():
    for i in range(NUM_THREADS):
        thread.start_new(f, (i,))
    time.sleep(LONGSLEEP)
    a = alive.keys()
    a.sort()
    verify((a == range(NUM_THREADS)))
    prefork_lives = alive.copy()
    if (sys.platform in ['unixware7']):
        cpid = os.fork1()
    else:
        cpid = os.fork()
    if (cpid == 0):
        time.sleep(LONGSLEEP)
        n = 0
        for key in alive.keys():
            if (alive[key] != prefork_lives[key]):
                n = (n + 1)
        os._exit(n)
    else:
        (spid, status) = os.waitpid(cpid, 0)
        verify((spid == cpid))
        verify((status == 0), ('cause = %d, exit = %d' % ((status & 255), (status >> 8))))
        global stop
        stop = 1
        time.sleep((2 * SHORTSLEEP))
