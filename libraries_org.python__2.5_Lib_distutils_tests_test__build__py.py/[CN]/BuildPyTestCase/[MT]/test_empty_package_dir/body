def test_empty_package_dir(self):
    cwd = os.getcwd()
    sources = self.mkdtemp()
    open(os.path.join(sources, '__init__.py'), 'w').close()
    testdir = os.path.join(sources, 'doc')
    os.mkdir(testdir)
    open(os.path.join(testdir, 'testfile'), 'w').close()
    os.chdir(sources)
    sys.stdout = StringIO.StringIO()
    try:
        dist = Distribution({'packages': ['pkg'], 'package_dir': {'pkg': '', }, 'package_data': {'pkg': ['doc/*'], }, })
        dist.script_name = os.path.join(sources, 'setup.py')
        dist.script_args = ['build']
        dist.parse_command_line()
        try:
            dist.run_commands()
        except DistutilsFileError:
            self.fail("failed package_data test when package_dir is ''")
    finally:
        os.chdir(cwd)
        sys.stdout = sys.__stdout__
