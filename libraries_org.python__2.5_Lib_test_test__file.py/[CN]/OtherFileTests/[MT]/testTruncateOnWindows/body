def testTruncateOnWindows(self):
    os.unlink(TESTFN)

    def bug801631():
        f = open(TESTFN, 'wb')
        f.write('12345678901')
        f.close()
        f = open(TESTFN, 'rb+')
        data = f.read(5)
        if (data != '12345'):
            self.fail(('Read on file opened for update failed %r' % data))
        if (f.tell() != 5):
            self.fail(('File pos after read wrong %d' % f.tell()))
        f.truncate()
        if (f.tell() != 5):
            self.fail(('File pos after ftruncate wrong %d' % f.tell()))
        f.close()
        size = os.path.getsize(TESTFN)
        if (size != 5):
            self.fail(('File size after ftruncate wrong %d' % size))
    try:
        bug801631()
    finally:
        os.unlink(TESTFN)
