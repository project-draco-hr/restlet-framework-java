{
  Call call=new Call();
  call.setResourceRef("http://www.domain.com:8080/path1/path2/path3?param1&param2=123&query=abc");
  String pattern="http://www.target.org";
  pattern+="${path}#[if query('query')]?${query('query')}#[end]";
  StringTemplate te=new StringTemplate(pattern);
  String targetUri=te.process(new CallModel(call,null));
  assertEquals("http://www.target.org/path1/path2/path3?abc",targetUri);
  call.setResourceRef("http://www.domain.com:8080/path1/path2/path3?param1&param2=123");
  targetUri=te.process(new CallModel(call,null));
  assertEquals("http://www.target.org/path1/path2/path3",targetUri);
}
