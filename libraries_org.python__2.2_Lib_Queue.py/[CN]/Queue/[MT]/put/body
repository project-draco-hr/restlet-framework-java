def put(self, item, block=1):
    "Put an item into the queue.\n\n        If optional arg 'block' is 1 (the default), block if\n        necessary until a free slot is available.  Otherwise (block\n        is 0), put an item on the queue if a free slot is immediately\n        available, else raise the Full exception.\n        "
    if block:
        self.fsema.acquire()
    elif (not self.fsema.acquire(0)):
        raise Full
    self.mutex.acquire()
    release_fsema = True
    try:
        was_empty = self._empty()
        self._put(item)
        if was_empty:
            self.esema.release()
        release_fsema = (not self._full())
    finally:
        if release_fsema:
            self.fsema.release()
        self.mutex.release()
