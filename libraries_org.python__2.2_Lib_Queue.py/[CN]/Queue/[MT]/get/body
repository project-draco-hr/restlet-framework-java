def get(self, block=1):
    "Remove and return an item from the queue.\n\n        If optional arg 'block' is 1 (the default), block if\n        necessary until an item is available.  Otherwise (block is 0),\n        return an item if one is immediately available, else raise the\n        Empty exception.\n        "
    if block:
        self.esema.acquire()
    elif (not self.esema.acquire(0)):
        raise Empty
    self.mutex.acquire()
    release_esema = True
    try:
        was_full = self._full()
        item = self._get()
        if was_full:
            self.fsema.release()
        release_esema = (not self._empty())
    finally:
        if release_esema:
            self.esema.release()
        self.mutex.release()
    return item
