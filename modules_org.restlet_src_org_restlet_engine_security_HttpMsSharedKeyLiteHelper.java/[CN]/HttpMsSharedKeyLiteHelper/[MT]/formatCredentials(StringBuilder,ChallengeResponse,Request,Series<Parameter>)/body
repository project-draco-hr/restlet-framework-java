{
  final String methodName=request.getMethod().getName();
  String date="";
  if (httpHeaders.getFirstValue("x-ms-date",true) == null) {
    date=httpHeaders.getFirstValue(HttpConstants.HEADER_DATE,true);
    if (date == null) {
      date=DateUtils.format(new Date(),DateUtils.FORMAT_RFC_1123.get(0));
      httpHeaders.add(HttpConstants.HEADER_DATE,date);
    }
  }
  final String canonicalizedResource=getCanonicalizedResourceName(request.getResourceRef());
  final StringBuilder rest=new StringBuilder();
  rest.append(methodName).append(date).append('\n').append(canonicalizedResource);
  sb.append(challenge.getIdentifier()).append(':').append(Base64.encode(DigestUtils.toHMac256(rest.toString(),Base64.decode(new String(challenge.getSecret()))),true));
}
