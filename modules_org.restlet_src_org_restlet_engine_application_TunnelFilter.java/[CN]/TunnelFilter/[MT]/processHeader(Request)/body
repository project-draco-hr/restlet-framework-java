{
  final TunnelService tunnelService=getTunnelService();
  if (tunnelService.isMethodTunnel()) {
    final Series<Parameter> extraHeaders=(Series<Parameter>)request.getAttributes().get(HttpConstants.ATTRIBUTE_HEADERS);
    if (extraHeaders != null) {
      final String newMethodValue=extraHeaders.getFirstValue(getTunnelService().getMethodHeaderParameter(),true);
      if (newMethodValue != null && newMethodValue.trim().length() > 0) {
        request.setMethod(Method.valueOf(newMethodValue));
      }
    }
  }
}
