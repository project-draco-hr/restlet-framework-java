def test_set_item(self):
    key0 = self._box.add((self._template % 'original 0'))
    self.assert_((self._box.get_string(key0) == (self._template % 'original 0')))
    key1 = self._box.add((self._template % 'original 1'))
    self.assert_((self._box.get_string(key1) == (self._template % 'original 1')))
    self._box[key0] = (self._template % 'changed 0')
    self.assert_((self._box.get_string(key0) == (self._template % 'changed 0')))
    self._box[key1] = (self._template % 'changed 1')
    self.assert_((self._box.get_string(key1) == (self._template % 'changed 1')))
    self._box[key0] = _sample_message
    self._check_sample(self._box[key0])
    self._box[key1] = self._box[key0]
    self._check_sample(self._box[key1])
    self._box[key0] = (self._template % 'original 0')
    self.assert_((self._box.get_string(key0) == (self._template % 'original 0')))
    self._check_sample(self._box[key1])
    self.assertRaises(KeyError, (lambda : self._box.__setitem__('foo', 'bar')))
    self.assertRaises(KeyError, (lambda : self._box['foo']))
    self.assert_((len(self._box) == 2))
