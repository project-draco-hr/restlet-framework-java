def test_command_packages_configfile(self):
    sys.argv.append('build')
    f = open(TESTFN, 'w')
    try:
        print  >> f, '[global]'
        print  >> f, 'command_packages = foo.bar, splat'
        f.close()
        d = self.create_distribution([TESTFN])
        self.assertEqual(d.get_command_packages(), ['distutils.command', 'foo.bar', 'splat'])
        sys.argv[1:] = ['--command-packages', 'spork', 'build']
        d = self.create_distribution([TESTFN])
        self.assertEqual(d.get_command_packages(), ['distutils.command', 'spork'])
        sys.argv[1:] = ['--command-packages', '', 'build']
        d = self.create_distribution([TESTFN])
        self.assertEqual(d.get_command_packages(), ['distutils.command'])
    finally:
        os.unlink(TESTFN)
