{
  if (representation != null) {
    final PipeStream pipe=new PipeStream();
    final Context context=Context.getCurrent();
    final Response response=Response.getCurrent();
    Thread writer=new Thread(){
      @Override public void run(){
        try {
          Context.setCurrent(context);
          Response.setCurrent(response);
          OutputStream os=pipe.getOutputStream();
          representation.write(os);
          os.write(-1);
          os.close();
        }
 catch (        IOException ioe) {
          Logger.getLogger(ByteUtils.class.getCanonicalName()).log(Level.FINE,"Error while writing to the piped input stream.",ioe);
        }
      }
    }
;
    writer.setDaemon(false);
    writer.start();
    return pipe.getInputStream();
  }
 else {
    return null;
  }
}
