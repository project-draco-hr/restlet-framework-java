{
  boolean result=false;
synchronized (getBuffer()) {
    int remaining=0;
    if (getBufferState() == STATE_BUFFER_DRAINING) {
      remaining=getBuffer().remaining();
      if (remaining == 0) {
        setBufferState(STATE_BUFFER_FILLING);
      }
    }
    if (getBufferState() == STATE_BUFFER_FILLING) {
      remaining=getWrappedChannel().read(getBuffer());
      if (remaining > 0) {
        setBufferState(STATE_BUFFER_DRAINING);
      }
    }
    if (remaining > 0) {
      result=NioUtils.fillLine(getLineBuilder(),getBuffer());
    }
  }
  return result;
}
