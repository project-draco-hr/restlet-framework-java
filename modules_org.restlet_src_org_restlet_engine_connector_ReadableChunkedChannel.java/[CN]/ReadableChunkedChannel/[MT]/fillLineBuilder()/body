{
  boolean result=false;
synchronized (getByteBuffer()) {
    int size=0;
    if (getBufferState() == BufferState.DRAINING) {
      size=getByteBuffer().remaining();
    }
    if (size == 0) {
      setBufferState(BufferState.FILLING);
      getByteBuffer().clear();
      if (super.refill()) {
        size=getByteBuffer().remaining();
      }
    }
    if (size > 0) {
      setLineBuilderState(NioUtils.fillLine(getLineBuilder(),getLineBuilderState(),getByteBuffer()));
      return getLineBuilderState() == BufferState.DRAINING;
    }
  }
  return result;
}
