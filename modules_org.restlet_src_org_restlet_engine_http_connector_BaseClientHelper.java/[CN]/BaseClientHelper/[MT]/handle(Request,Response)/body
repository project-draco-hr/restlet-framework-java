{
  try {
    if (response.getOnReceived() == null) {
      CountDownLatch latch=new CountDownLatch(1);
      request.getAttributes().put("org.restlet.engine.http.connector.latch",latch);
      getOutboundMessages().add(response);
      latch.await();
    }
 else {
      getOutboundMessages().add(response);
    }
  }
 catch (  Exception e) {
    getLogger().log(Level.INFO,"Error while handling a " + request.getProtocol().getName() + " client request",e);
    response.setStatus(Status.CONNECTOR_ERROR_INTERNAL,e);
  }
}
