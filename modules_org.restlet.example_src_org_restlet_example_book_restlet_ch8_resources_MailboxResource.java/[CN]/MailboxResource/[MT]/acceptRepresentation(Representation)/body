{
  Form form=new Form(entity);
  Mail mail=new Mail();
  mail.setStatus(Mail.STATUS_RECEIVED);
  String senderAddress=form.getFirstValue("senderAddress");
  String senderName=form.getFirstValue("senderName");
  Contact contact=getObjectsFacade().lookForContact(senderAddress,mailbox);
  if (contact == null) {
    contact=new Contact();
    contact.setMailAddress(senderAddress);
    contact.setName(senderName);
  }
  mail.setSender(contact);
  mail.setMessage(form.getFirstValue("message"));
  mail.setSubject(form.getFirstValue("subject"));
  Series<Parameter> recipients=form.subList("recipient");
  for (  Parameter recipient : recipients) {
    contact=getObjectsFacade().lookForContact(recipient.getValue(),mailbox);
    if (contact == null) {
      contact=new Contact();
      String[] recipientValues=recipient.getValue().split("\\$");
      contact.setMailAddress(recipientValues[0]);
      contact.setName(recipientValues[1]);
    }
    mail.getRecipients().add(contact);
  }
  getObjectsFacade().createMail(mailbox,mail);
}
