'text_file\n\nprovides the TextFile class, which gives an interface to text files\nthat (optionally) takes care of stripping comments, ignoring blank\nlines, and joining lines with backslashes.'
__revision__ = '$Id: text_file.py 29687 2002-11-14 02:25:42Z akuchling $'
from types import *
import sys, os, string
if (__name__ == '__main__'):
    test_data = '# test file\n\nline 3 \\\n# intervening comment\n  continues on next line\n'
    result1 = map((lambda x: (x + '\n')), string.split(test_data, '\n')[0:(-1)])
    result2 = ['\n', 'line 3 \\\n', '  continues on next line\n']
    result3 = ['# test file\n', 'line 3 \\\n', '# intervening comment\n', '  continues on next line\n']
    result4 = ['line 3 \\', '  continues on next line']
    result5 = ['line 3   continues on next line']
    result6 = ['line 3 continues on next line']

    def test_input(count, description, file, expected_result):
        result = file.readlines()
        if (result == expected_result):
            print ('ok %d (%s)' % (count, description))
        else:
            print ('not ok %d (%s):' % (count, description))
            print '** expected:'
            print expected_result
            print '** received:'
            print result
    filename = 'test.txt'
    out_file = open(filename, 'w')
    out_file.write(test_data)
    out_file.close()
    in_file = TextFile(filename, strip_comments=0, skip_blanks=0, lstrip_ws=0, rstrip_ws=0)
    test_input(1, 'no processing', in_file, result1)
    in_file = TextFile(filename, strip_comments=1, skip_blanks=0, lstrip_ws=0, rstrip_ws=0)
    test_input(2, 'strip comments', in_file, result2)
    in_file = TextFile(filename, strip_comments=0, skip_blanks=1, lstrip_ws=0, rstrip_ws=0)
    test_input(3, 'strip blanks', in_file, result3)
    in_file = TextFile(filename)
    test_input(4, 'default processing', in_file, result4)
    in_file = TextFile(filename, strip_comments=1, skip_blanks=1, join_lines=1, rstrip_ws=1)
    test_input(5, 'join lines without collapsing', in_file, result5)
    in_file = TextFile(filename, strip_comments=1, skip_blanks=1, join_lines=1, rstrip_ws=1, collapse_join=1)
    test_input(6, 'join lines with collapsing', in_file, result6)
    os.remove(filename)
