{
  Preference result=null;
  if (parameters == null) {
switch (type) {
case TYPE_CHARACTER_SET:
      result=new CharacterSetPrefImpl(new CharacterSetImpl(metadata.toString()));
    break;
case TYPE_ENCODING:
  result=new EncodingPrefImpl(new EncodingImpl(metadata.toString()));
break;
case TYPE_LANGUAGE:
result=new LanguagePrefImpl(new LanguageImpl(metadata.toString()));
break;
case TYPE_MEDIA_TYPE:
result=new MediaTypePrefImpl(new MediaTypeImpl(metadata.toString()));
break;
}
}
 else {
List<Parameter> mediaParams=extractMediaParams(parameters);
float quality=extractQuality(parameters);
switch (type) {
case TYPE_CHARACTER_SET:
result=new CharacterSetPrefImpl(new CharacterSetImpl(metadata.toString()),quality,parameters);
break;
case TYPE_ENCODING:
result=new EncodingPrefImpl(new EncodingImpl(metadata.toString()),quality,parameters);
break;
case TYPE_LANGUAGE:
result=new LanguagePrefImpl(new LanguageImpl(metadata.toString()),quality,parameters);
break;
case TYPE_MEDIA_TYPE:
result=new MediaTypePrefImpl(new MediaTypeImpl(metadata.toString(),mediaParams),quality,parameters);
break;
}
}
return result;
}
