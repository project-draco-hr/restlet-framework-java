{
  final Router router=new Router(getContext());
  final RmepGuard guard=new RmepGuard(getContext(),ChallengeScheme.HTTP_BASIC,"rmep",this.dataFacade);
  guard.setNext(MailRootResource.class);
  router.attachDefault(guard);
  final Directory imgDirectory=new Directory(getContext(),LocalReference.createFileReference(webRootPath + "/images"));
  router.attach("/images",imgDirectory);
  final Directory cssDirectory=new Directory(getContext(),LocalReference.createFileReference(webRootPath + "/stylesheets"));
  router.attach("/stylesheets",cssDirectory);
  router.attach("/users",UsersResource.class);
  router.attach("/users/{userId}",UserResource.class);
  router.attach("/mailboxes",MailboxesResource.class);
  final Router mailboxRouter=new Router(getContext());
  mailboxRouter.attachDefault(MailboxResource.class);
  mailboxRouter.attach("/contacts",ContactsResource.class);
  mailboxRouter.attach("/contacts/{contactId}",ContactResource.class);
  mailboxRouter.attach("/mails",MailsResource.class);
  mailboxRouter.attach("/mails/{mailId}",MailResource.class);
  mailboxRouter.attach("/feeds",FeedsResource.class);
  mailboxRouter.attach("/feeds/{feedId}",FeedResource.class);
  router.attach("/mailboxes/{mailboxId}",mailboxRouter);
  return router;
}
