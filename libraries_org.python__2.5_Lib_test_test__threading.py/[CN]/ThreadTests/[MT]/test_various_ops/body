def test_various_ops(self):
    NUMTASKS = 10
    sema = threading.BoundedSemaphore(value=3)
    mutex = threading.RLock()
    numrunning = Counter()
    threads = []
    for i in range(NUMTASKS):
        t = TestThread(('<thread %d>' % i), self, sema, mutex, numrunning)
        threads.append(t)
        t.start()
    if verbose:
        print 'waiting for all tasks to complete'
    for t in threads:
        t.join(NUMTASKS)
        self.assert_((not t.isAlive()))
    if verbose:
        print 'all tasks done'
    self.assertEqual(numrunning.get(), 0)
