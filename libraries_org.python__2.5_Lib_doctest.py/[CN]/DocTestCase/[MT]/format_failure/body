def format_failure(self, err):
    test = self._dt_test
    if (test.lineno is None):
        lineno = 'unknown line number'
    else:
        lineno = ('%s' % test.lineno)
    lname = '.'.join(test.name.split('.')[(-1):])
    return ('Failed doctest test for %s\n  File "%s", line %s, in %s\n\n%s' % (test.name, test.filename, lineno, lname, err))
