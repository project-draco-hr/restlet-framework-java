{
  Series<Parameter> headers=new Form();
  Request request=response.getRequest();
  try {
    addGeneralHeaders(request,headers);
    addRequestHeaders(request,headers);
    addEntityHeaders(request.getEntity(),headers);
    writeMessage(response,headers);
  }
 catch (  Exception e) {
    getLogger().log(Level.INFO,"An exception occured writing the request",e);
    response.setStatus(Status.CONNECTOR_ERROR_COMMUNICATION,"An exception occured writing the request");
    response.setEntity(null);
    try {
      writeMessage(response,headers);
    }
 catch (    Exception ee) {
      getLogger().log(Level.WARNING,"Unable to send error request",ee);
    }
  }
 finally {
    if (request.getOnSent() != null) {
      request.getOnSent().handle(request,response);
    }
    getOutboundMessages().poll();
    if (request.isExpectingResponse()) {
      getInboundMessages().add(response);
    }
    setOutboundBusy(false);
  }
}
