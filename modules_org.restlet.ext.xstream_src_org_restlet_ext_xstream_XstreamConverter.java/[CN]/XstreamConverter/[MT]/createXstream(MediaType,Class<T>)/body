{
  XStream result=null;
  try {
    if (MediaType.APPLICATION_JSON.isCompatible(mediaType)) {
      result=new XStream(getJsonDriverClass().newInstance());
      result.setMode(XStream.NO_REFERENCES);
    }
 else {
      result=new XStream(getXmlDriverClass().newInstance());
    }
    result.addPermission(NoTypePermission.NONE);
    result.addPermission(NullPermission.NULL);
    result.addPermission(PrimitiveTypePermission.PRIMITIVES);
    result.allowTypeHierarchy(Collection.class);
    result.allowTypesByWildcard(new String[]{target.getPackage().getName() + ".*"});
    result.autodetectAnnotations(true);
  }
 catch (  Exception e) {
    IOException ioe=new IOException("Unable to create the XStream driver: " + e.getMessage());
    ioe.initCause(e);
    throw ioe;
  }
  return result;
}
