{
  Preference result=null;
  if (parameters == null) {
switch (type) {
case TYPE_CHARACTER_SET:
      result=new CharacterSetPref(new DefaultCharacterSet(metadata.toString()));
    break;
case TYPE_ENCODING:
  result=new EncodingPref(new DefaultEncoding(metadata.toString()));
break;
case TYPE_LANGUAGE:
result=new LanguagePref(new DefaultLanguage(metadata.toString()));
break;
case TYPE_MEDIA_TYPE:
result=new MediaTypePref(new DefaultMediaType(metadata.toString()));
break;
}
}
 else {
ParameterList mediaParams=extractMediaParams(parameters);
float quality=extractQuality(parameters);
switch (type) {
case TYPE_CHARACTER_SET:
result=new CharacterSetPref(new DefaultCharacterSet(metadata.toString()),quality,parameters);
break;
case TYPE_ENCODING:
result=new EncodingPref(new DefaultEncoding(metadata.toString()),quality,parameters);
break;
case TYPE_LANGUAGE:
result=new LanguagePref(new DefaultLanguage(metadata.toString()),quality,parameters);
break;
case TYPE_MEDIA_TYPE:
result=new MediaTypePref(new DefaultMediaType(metadata.toString(),mediaParams),quality,parameters);
break;
}
}
return result;
}
