def _register_channel(self, socket_object, channel, mask):
    jmask = 0
    if (mask & POLLIN):
        if (channel.validOps() & OP_ACCEPT):
            jmask = OP_ACCEPT
        else:
            jmask = OP_READ
    if (mask & POLLOUT):
        jmask |= OP_WRITE
        if (channel.validOps() & OP_CONNECT):
            jmask |= OP_CONNECT
    selectionkey = channel.register(self.selector, jmask)
    self.chanmap[channel] = (socket_object, selectionkey)
