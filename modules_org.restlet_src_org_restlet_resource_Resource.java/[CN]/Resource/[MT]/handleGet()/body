{
  Variant selectedVariant=null;
  List<Variant> variants=getVariants();
  if ((variants == null) || (variants.isEmpty())) {
    getResponse().setStatus(Status.CLIENT_ERROR_NOT_FOUND);
  }
 else   if (isNegotiateContent()) {
    selectedVariant=getPreferredVariant();
    if (selectedVariant == null) {
      getResponse().setStatus(Status.CLIENT_ERROR_NOT_ACCEPTABLE);
      ReferenceList refs=new ReferenceList(variants.size());
      for (      Variant variant : variants) {
        if (variant.getIdentifier() != null) {
          refs.add(variant.getIdentifier());
        }
      }
      selectedVariant=refs.getTextRepresentation();
    }
 else {
      getResponse().getDimensions().clear();
      getResponse().getDimensions().add(Dimension.CHARACTER_SET);
      getResponse().getDimensions().add(Dimension.ENCODING);
      getResponse().getDimensions().add(Dimension.LANGUAGE);
      getResponse().getDimensions().add(Dimension.MEDIA_TYPE);
    }
  }
 else {
    if (variants.size() == 1) {
      selectedVariant=variants.get(0);
    }
 else {
      ReferenceList variantRefs=new ReferenceList();
      for (      Variant variant : variants) {
        if (variant.getIdentifier() != null) {
          variantRefs.add(variant.getIdentifier());
        }
 else {
          getLogger().warning("A resource with multiple variants should provide and identifier for each variants when content negotiation is turned off");
        }
      }
      if (variantRefs.size() > 0) {
        getResponse().setStatus(Status.REDIRECTION_MULTIPLE_CHOICES);
        selectedVariant=variantRefs.getTextRepresentation();
      }
 else {
        getResponse().setStatus(Status.CLIENT_ERROR_NOT_FOUND);
      }
    }
  }
  if (getRequest().getConditions().hasSome()) {
    Status status=getRequest().getConditions().getStatus(getRequest().getMethod(),selectedVariant);
    if (status != null) {
      getResponse().setStatus(status);
      getResponse().setEntity(null);
    }
 else {
      getResponse().setEntity(getRepresentation(selectedVariant));
    }
  }
 else {
    getResponse().setEntity(getRepresentation(selectedVariant));
  }
}
