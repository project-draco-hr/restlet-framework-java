{
  if (readMessageLine()) {
    ConnectedRequest request=(ConnectedRequest)getMessage().getRequest();
    Series<Parameter> headers=request.getHeaders();
    Parameter header=readMessageHeader();
    while (header != null) {
      if (headers == null) {
        headers=new Form();
      }
      headers.add(header);
      if (readMessageLine()) {
        header=readMessageHeader();
        if (header == null) {
          if (HeaderUtils.isConnectionClose(headers)) {
            getConnection().setState(ConnectionState.CLOSING);
          }
          Representation entity=createEntity(headers);
          if (entity instanceof EmptyRepresentation) {
            setMessageState(MessageState.START_LINE);
          }
 else {
            request.setEntity(entity);
            setMessageState(MessageState.BODY);
          }
          if (request != null) {
            if (request.isExpectingResponse()) {
              getMessages().add(getMessage());
            }
            getConnection().getHelper().getInboundMessages().add(getMessage());
          }
        }
      }
 else {
      }
    }
    request.setHeaders(headers);
  }
}
