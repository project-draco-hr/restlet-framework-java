{
switch (getMessageState()) {
case START:
    if (getHelper().getLogger().isLoggable(Level.FINE)) {
      getHelper().getLogger().log(Level.FINE,"Writing message to " + getConnection().getSocketAddress());
    }
  writeStartLine();
setMessageState(MessageState.HEADERS);
break;
case HEADERS:
if (getHeaders() == null) {
setHeaders(new Series<Header>(Header.class));
setHeaderIndex(0);
addHeaders(getHeaders());
}
if (getHeaderIndex() < getHeaders().size()) {
Header header=getHeaders().get(getHeaderIndex());
getLineBuilder().append(header.getName());
getLineBuilder().append(": ");
getLineBuilder().append(header.getValue());
getLineBuilder().append('\r');
getLineBuilder().append('\n');
setHeaderIndex(getHeaderIndex() + 1);
}
 else {
getLineBuilder().append('\r');
getLineBuilder().append('\n');
onHeadersCompleted();
}
break;
default :
break;
}
}
