{
  if (canDrain()) {
    int bytesWritten=getConnection().getWritableSelectionChannel().write(getIoBuffer().getBytes());
    if (getLogger().isLoggable(Level.FINER)) {
      getLogger().finer("Bytes written: " + bytesWritten);
    }
    if (getHelper().getThrottleTimeMs() > 0) {
      try {
        Thread.sleep(getHelper().getThrottleTimeMs());
      }
 catch (      InterruptedException e) {
      }
    }
    if (bytesWritten == 0) {
      if (getIoState() == IoState.PROCESSING) {
        setIoState(IoState.INTEREST);
      }
    }
 else     if (getIoBuffer().getBytes().hasRemaining()) {
      getIoBuffer().getBytes().compact();
    }
 else     if (getMessageState() == MessageState.END) {
      onCompleted(false);
    }
 else {
      getIoBuffer().clear();
    }
  }
}
