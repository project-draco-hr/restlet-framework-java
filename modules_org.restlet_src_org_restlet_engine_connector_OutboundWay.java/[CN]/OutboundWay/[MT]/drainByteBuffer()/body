{
  if ((getByteBuffer().hasRemaining()) && (getIoState() == IoState.PROCESSING)) {
    int bytesWritten=getConnection().getWritableSelectionChannel().write(getByteBuffer());
    if (getLogger().isLoggable(Level.FINE)) {
      getLogger().fine("Bytes written: " + bytesWritten);
    }
    if (getHelper().getThrottleTimeMs() > 0) {
      try {
        Thread.sleep(getHelper().getThrottleTimeMs());
      }
 catch (      InterruptedException e) {
      }
    }
    if (bytesWritten == 0) {
      setIoState(IoState.INTEREST);
    }
 else     if (getByteBuffer().hasRemaining()) {
      getByteBuffer().compact();
    }
 else     if (getMessageState() == MessageState.END) {
      onCompleted(false);
    }
 else {
      getByteBuffer().clear();
      setByteBufferState(BufferState.FILLING);
    }
  }
}
