{
  BufferState result=builderState;
  int next;
  if (result == BufferState.IDLE) {
    result=BufferState.FILLING;
  }
  while ((result != BufferState.DRAINING) && byteBuffer.hasRemaining()) {
    next=(int)byteBuffer.get();
switch (builderState) {
case FILLING:
      if (HeaderUtils.isCarriageReturn(next)) {
        result=BufferState.FILLED;
      }
 else {
        lineBuilder.append((char)next);
      }
    break;
case FILLED:
  if (HeaderUtils.isLineFeed(next)) {
    result=BufferState.DRAINING;
  }
 else {
    throw new IOException("Missing line feed character at the end of the line");
  }
break;
}
}
return result;
}
