{
  try {
    if (getIoState() == IoState.INTEREST) {
      setIoState(IoState.PROCESSING);
      if (getMessageState() == MessageState.IDLE) {
        setMessageState(MessageState.START);
      }
    }
 else     if (getIoState() == IoState.CANCELING) {
      setIoState(IoState.CANCELLED);
    }
    if (getLogger().isLoggable(Level.FINER)) {
      getLogger().log(Level.FINER,"Way selected. Processing IO for : " + this);
    }
    int drained=processIoBuffer();
    if ((drained == -1) && (getConnection().getState() == ConnectionState.CLOSING)) {
      getBuffer().clear();
    }
 else     if (getIoState() == IoState.PROCESSING) {
      setIoState(IoState.INTEREST);
    }
  }
 catch (  Exception e) {
    getLogger().log(Level.FINE,"Error while processing a message. Closing the connection.",e);
    getConnection().onError("Error while processing a message. Closing the connection.",e,Status.CONNECTOR_ERROR_COMMUNICATION);
  }
}
