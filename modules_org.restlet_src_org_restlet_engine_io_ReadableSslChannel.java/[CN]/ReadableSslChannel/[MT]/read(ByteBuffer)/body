{
  int result=0;
  refill();
  if ((getPacketBufferState() == BufferState.DRAINING) || (getManager().getState() == SslState.HANDSHAKING)) {
    int dstSize=dst.remaining();
    if (dstSize > 0) {
      int lastRead=0;
      while (dst.hasRemaining() && (getManager().getState() != SslState.CLOSED) && getPacketBuffer().hasRemaining()&& (getConnection().getInboundWay().getIoState() != IoState.IDLE)&& (lastRead != -1)) {
        SSLEngineResult sslResult=runEngine(dst);
        handleResult(sslResult,dst);
        refill();
      }
      result=dstSize - dst.remaining();
    }
  }
  return result;
}
