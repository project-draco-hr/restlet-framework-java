{
  int result=0;
  refill();
  if (getPacketBufferState() == BufferState.DRAINING) {
    int dstSize=dst.remaining();
    if (dstSize > 0) {
      SSLEngineResult sslResult=getManager().getEngine().unwrap(getPacketBuffer(),dst);
      result=dstSize - dst.remaining();
      int remaining=getPacketBuffer().remaining();
      if (remaining == 0) {
        setPacketBufferState(BufferState.FILLING);
        refill();
      }
      handleResult(sslResult);
    }
  }
  return result;
}
