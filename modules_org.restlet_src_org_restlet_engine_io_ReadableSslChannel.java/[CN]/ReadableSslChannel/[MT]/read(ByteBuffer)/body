{
  int result=0;
  if (getPacketBufferState() == BufferState.FILLING) {
    refill();
  }
  if (getPacketBufferState() == BufferState.DRAINING) {
    int remaining=dst.remaining();
    SSLEngineResult sslResult=getManager().getEngine().unwrap(getPacketBuffer(),dst);
    result=remaining - dst.remaining();
    if (getPacketBuffer().remaining() == 0) {
      setPacketBufferState(BufferState.FILLING);
    }
    handleResult(sslResult);
  }
  return result;
}
