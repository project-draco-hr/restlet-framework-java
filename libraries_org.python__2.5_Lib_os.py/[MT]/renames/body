def renames(old, new):
    'renames(old, new)\n\n    Super-rename; create directories as necessary and delete any left\n    empty.  Works like rename, except creation of any intermediate\n    directories needed to make the new pathname good is attempted\n    first.  After the rename, directories corresponding to rightmost\n    path segments of the old name will be pruned way until either the\n    whole path is consumed or a nonempty directory is found.\n\n    Note: this function can fail with the new directory structure made\n    if you lack permissions needed to unlink the leaf directory or\n    file.\n\n    '
    (head, tail) = path.split(new)
    if (head and tail and (not path.exists(head))):
        makedirs(head)
    rename(old, new)
    (head, tail) = path.split(old)
    if (head and tail):
        try:
            removedirs(head)
        except error:
            pass
