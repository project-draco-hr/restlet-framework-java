def __init__(self, name, mode):
    mode = {'r': os.O_RDONLY, 'w': ((os.O_WRONLY | os.O_CREAT) | os.O_TRUNC), }[mode]
    if hasattr(os, 'O_BINARY'):
        mode |= os.O_BINARY
    self.fd = os.open(name, mode)
