def test_popitem(self):
    for copymode in ((-1), (+ 1)):
        for log2size in range(12):
            size = (2 ** log2size)
            a = {}
            b = {}
            for i in range(size):
                a[repr(i)] = i
                if (copymode < 0):
                    b[repr(i)] = i
            if (copymode > 0):
                b = a.copy()
            for i in range(size):
                (ka, va) = ta = a.popitem()
                self.assertEqual(va, int(ka))
                (kb, vb) = tb = b.popitem()
                self.assertEqual(vb, int(kb))
                self.assert_((not ((copymode < 0) and (ta != tb))))
            self.assert_((not a))
            self.assert_((not b))
    d = {}
    self.assertRaises(KeyError, d.popitem)
