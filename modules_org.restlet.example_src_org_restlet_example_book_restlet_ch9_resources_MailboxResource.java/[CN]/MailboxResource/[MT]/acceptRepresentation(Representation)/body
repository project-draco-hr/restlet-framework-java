{
  Form form=new Form(entity);
  Mail mail=new Mail();
  mail.setStatus(Mail.STATUS_RECEIVED);
  String senderAddress=form.getFirstValue("senderAddress");
  String senderName=form.getFirstValue("senderName");
  Contact contact=lookForContact(senderAddress,mailbox);
  if (contact == null) {
    contact=new Contact();
    contact.setMailAddress(senderAddress);
    contact.setName(senderName);
    getDAOFactory().getMailboxDAO().createContact(mailbox,contact);
  }
  mail.setSender(contact);
  mail.setMessage(form.getFirstValue("message"));
  mail.setSubject(form.getFirstValue("subject"));
  Series<Parameter> recipients=form.subList("recipient");
  for (  Parameter recipient : recipients) {
    contact=lookForContact(recipient.getValue(),mailbox);
    if (contact == null) {
      contact=new Contact();
      contact.setMailAddress(recipient.getValue());
      getDAOFactory().getMailboxDAO().createContact(mailbox,contact);
    }
    mail.getRecipients().add(contact);
  }
  getDAOFactory().getMailboxDAO().createMail(mailbox,mail);
}
