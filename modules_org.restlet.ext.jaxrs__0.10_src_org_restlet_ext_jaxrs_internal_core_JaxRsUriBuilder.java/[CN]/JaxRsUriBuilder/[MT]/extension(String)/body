{
  final StringBuilder path=getPath();
  final int lastPathSt=path.lastIndexOf("/");
  final int lastSegmSt=path.indexOf(".",lastPathSt);
  if (lastSegmSt > 0) {
    path.delete(lastSegmSt,Integer.MAX_VALUE);
  }
  if (extension != null) {
    CharSequence ext;
    ext=EncodeOrCheck.pathSegmentWithMatrix(extension,this.encode);
    if ((ext.length() == 0) || (ext.charAt(0) != '.')) {
      path.append('.');
    }
    path.append(ext);
  }
  return this;
}
