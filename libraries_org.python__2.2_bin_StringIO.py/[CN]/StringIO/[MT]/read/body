def read(self, n=(-1)):
    if self.closed:
        raise ValueError, 'I/O operation on closed file'
    if self.buflist:
        self.buf += ''.join(self.buflist)
        self.buflist = []
    if (n < 0):
        newpos = self.len
    else:
        newpos = min((self.pos + n), self.len)
    r = self.buf[self.pos:newpos]
    self.pos = newpos
    return r
