def createMessage(self, dir, mbox=False):
    t = int((time.time() % 1000000))
    pid = self._counter
    self._counter += 1
    filename = os.extsep.join((str(t), str(pid), 'myhostname', 'mydomain'))
    tmpname = os.path.join(self._dir, 'tmp', filename)
    newname = os.path.join(self._dir, dir, filename)
    fp = open(tmpname, 'w')
    self._msgfiles.append(tmpname)
    if mbox:
        fp.write(FROM_)
    fp.write(DUMMY_MESSAGE)
    fp.close()
    if hasattr(os, 'link'):
        os.link(tmpname, newname)
    else:
        fp = open(newname, 'w')
        fp.write(DUMMY_MESSAGE)
        fp.close()
    self._msgfiles.append(newname)
    return tmpname
