def test_main():
    import gc
    import sys
    thesuite = test_suite()
    lastrc = None
    while True:
        test_support.run_suite(thesuite)
        if 1:
            break
        gc.collect()
        if gc.garbage:
            raise SystemError(('gc.garbage not empty after test run: %r' % gc.garbage))
        if hasattr(sys, 'gettotalrefcount'):
            thisrc = sys.gettotalrefcount()
            print  >> sys.stderr, ('*' * 10), 'total refs:', thisrc,
            if lastrc:
                print  >> sys.stderr, 'delta:', (thisrc - lastrc)
            else:
                print  >> sys.stderr
            lastrc = thisrc
