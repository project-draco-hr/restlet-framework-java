{
  if (this.agentAttributes == null) {
    this.agentAttributes=new HashMap<String,String>();
    final Map<String,Object> map=new HashMap<String,Object>();
    Template template=null;
    final Variable agentName=new Variable(Variable.TYPE_TOKEN);
    final Variable agentVersion=new Variable(Variable.TYPE_TOKEN);
    final Variable agentComment=new Variable(Variable.TYPE_COMMENT);
    final Variable agentCommentAttribute=new Variable(Variable.TYPE_COMMENT_ATTRIBUTE);
    final Variable facultativeData=new Variable(Variable.TYPE_ALL,null,false,false);
    for (    String string : ClientInfo.getUserAgentTemplates()) {
      template=new Template(string,Template.MODE_EQUALS);
      template.getVariables().put("agentName",agentName);
      template.getVariables().put("agentVersion",agentVersion);
      template.getVariables().put("agentComment",agentComment);
      template.getVariables().put("agentOs",agentCommentAttribute);
      template.getVariables().put("commentAttribute",agentCommentAttribute);
      template.getVariables().put("facultativeData",facultativeData);
      if (template.parse(getAgent(),map) > -1) {
        for (        final String key : map.keySet()) {
          this.agentAttributes.put(key,(String)map.get(key));
        }
        break;
      }
    }
  }
  return this.agentAttributes;
}
