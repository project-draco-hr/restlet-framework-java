{
  if (this.agentAttributes == null) {
    agentAttributes=new HashMap<String,Object>();
    URL userAgentPropertiesUrl=Engine.getClassLoader().getResource("agent.properties");
    if (userAgentPropertiesUrl != null) {
      BufferedReader reader;
      try {
        reader=new BufferedReader(new InputStreamReader(userAgentPropertiesUrl.openStream(),CharacterSet.UTF_8.getName()));
        Template template=null;
        Variable agentName=new Variable(Variable.TYPE_TOKEN);
        Variable agentVersion=new Variable(Variable.TYPE_TOKEN);
        Variable agentComment=new Variable(Variable.TYPE_COMMENT);
        Variable agentCommentAttribute=new Variable(Variable.TYPE_COMMENT_ATTRIBUTE);
        Variable facultativeData=new Variable(Variable.TYPE_ALL,null,false,false);
        String line=reader.readLine();
        for (; line != null; line=reader.readLine()) {
          if (line.trim().length() > 0 && !line.trim().startsWith("#")) {
            template=new Template(line,Template.MODE_EQUALS);
            template.getVariables().put("agentName",agentName);
            template.getVariables().put("agentVersion",agentVersion);
            template.getVariables().put("agentComment",agentComment);
            template.getVariables().put("agentOs",agentCommentAttribute);
            template.getVariables().put("commentAttribute",agentCommentAttribute);
            template.getVariables().put("facultativeData",facultativeData);
            if (template.parse(getAgent(),agentAttributes) > -1) {
              break;
            }
          }
        }
        reader.close();
      }
 catch (      IOException e) {
        return agentAttributes;
      }
    }
  }
  return agentAttributes;
}
