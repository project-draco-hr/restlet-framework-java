def main():
    'Script main program.'
    import getopt
    try:
        (opts, args) = getopt.getopt(sys.argv[1:], 'lfqd:x:')
    except getopt.error as msg:
        print msg
        print 'usage: python compileall.py [-l] [-f] [-q] [-d destdir] [-x regexp] [directory ...]'
        print "-l: don't recurse down"
        print '-f: force rebuild even if timestamps are up-to-date'
        print '-q: quiet operation'
        print '-d destdir: purported directory name for error messages'
        print '   if no directory arguments, -l sys.path is assumed'
        print '-x regexp: skip files matching the regular expression regexp'
        print '   the regexp is search for in the full path of the file'
        sys.exit(2)
    maxlevels = 10
    ddir = None
    force = 0
    quiet = 0
    rx = None
    for (o, a) in opts:
        if (o == '-l'):
            maxlevels = 0
        if (o == '-d'):
            ddir = a
        if (o == '-f'):
            force = 1
        if (o == '-q'):
            quiet = 1
        if (o == '-x'):
            import re
            rx = re.compile(a)
    if ddir:
        if (len(args) != 1):
            print '-d destdir require exactly one directory argument'
            sys.exit(2)
    success = 1
    try:
        if args:
            for dir in args:
                if (not compile_dir(dir, maxlevels, ddir, force, rx, quiet)):
                    success = 0
        else:
            success = compile_path()
    except KeyboardInterrupt:
        print '\n[interrupt]'
        success = 0
    return success
