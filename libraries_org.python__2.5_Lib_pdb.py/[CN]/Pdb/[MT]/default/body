def default(self, line):
    if (line[:1] == '!'):
        line = line[1:]
    locals = self.curframe.f_locals
    globals = self.curframe.f_globals
    try:
        code = compile((line + '\n'), '<stdin>', 'single')
        exec code in globals, locals
    except:
        (t, v) = sys.exc_info()[:2]
        if (type(t) == type('')):
            exc_type_name = t
        else:
            exc_type_name = t.__name__
        print  >> self.stdout, '***', (exc_type_name + ':'), v
