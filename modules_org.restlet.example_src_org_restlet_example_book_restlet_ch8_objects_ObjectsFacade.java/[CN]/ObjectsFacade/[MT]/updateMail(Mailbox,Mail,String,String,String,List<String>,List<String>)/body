{
  mail.setSubject(subject);
  mail.setMessage(message);
  mail.setTags(tags);
  if (Mail.STATUS_DRAFT.equalsIgnoreCase(mail.getStatus())) {
    final List<Contact> mailRecipients=new ArrayList<Contact>();
    if (mailAddresses != null) {
      if (mail.getRecipients() != null) {
        for (        final Contact recipient : mail.getRecipients()) {
          if (!mailAddresses.contains(recipient.getMailAddress())) {
            this.dataFacade.deleteContact(recipient);
          }
        }
      }
      for (      final String mailAddress : mailAddresses) {
        final Contact contact=lookForContact(mailAddress,mailbox);
        if (contact != null) {
          mailRecipients.add(contact);
        }
 else {
          for (          final Contact recipient : mail.getRecipients()) {
            if (recipient.getMailAddress().equals(mailAddress)) {
              mailRecipients.add(recipient);
              break;
            }
          }
        }
      }
      mail.setRecipients(mailRecipients);
    }
 else {
      if (mail.getRecipients() != null) {
        for (        final Contact recipient : mail.getRecipients()) {
          this.dataFacade.deleteContact(recipient);
        }
      }
      mail.setRecipients(null);
    }
  }
  mail.setStatus(status);
  updateMail(mailbox,mail);
  return mail;
}
