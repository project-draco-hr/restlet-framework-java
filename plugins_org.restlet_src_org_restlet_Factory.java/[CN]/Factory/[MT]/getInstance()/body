{
  Factory result=instance;
  if (result == null) {
    String factoryClassName=null;
    ClassLoader cl=Thread.currentThread().getContextClassLoader();
    URL configURL=cl.getResource("meta-inf/services/org.restlet.Factory");
    if (configURL != null) {
      try {
        BufferedReader reader=new BufferedReader(new InputStreamReader(configURL.openStream(),"utf-8"));
        String providerName=reader.readLine();
        factoryClassName=providerName.substring(0,providerName.indexOf('#')).trim();
      }
 catch (      Exception e) {
      }
    }
    if (factoryClassName == null) {
      logger.log(Level.SEVERE,"Unable to register the Restlet API implementation. Please check that the JAR file is in your classpath.");
    }
 else {
      try {
        instance=(Factory)Class.forName(factoryClassName).newInstance();
        result=instance;
      }
 catch (      Exception e) {
        logger.log(Level.SEVERE,"Unable to register the Restlet API implementation",e);
        throw new RuntimeException("Unable to register the Restlet API implementation");
      }
    }
  }
  return result;
}
