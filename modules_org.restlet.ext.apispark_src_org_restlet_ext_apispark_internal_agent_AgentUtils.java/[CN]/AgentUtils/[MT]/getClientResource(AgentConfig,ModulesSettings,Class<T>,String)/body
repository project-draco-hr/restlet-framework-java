{
  StringBuilder sb=new StringBuilder(agentConfig.getAgentServiceUrl());
  if (!agentConfig.getAgentServiceUrl().endsWith("/")) {
    sb.append("/");
  }
  sb.append("agent");
  sb.append("/cells/");
  sb.append(agentConfig.getCell());
  sb.append("/versions/");
  sb.append(agentConfig.getCellVersion());
  if (resourcePath != null) {
    if (!resourcePath.startsWith("/")) {
      sb.append("/");
    }
    sb.append(resourcePath);
  }
  ClientResource clientResource=new ClientResource(sb.toString());
  clientResource.setChallengeResponse(ChallengeScheme.HTTP_BASIC,agentConfig.getAgentUsername(),agentConfig.getAgentSecret());
  Series<Header> headers=clientResource.getRequest().getHeaders();
  headers.add(AgentConstants.REQUEST_HEADER_CONNECTOR_AGENT_VERSION,AgentConfig.AGENT_VERSION);
  if (modulesSettings != null) {
    headers.add(AgentConstants.REQUEST_HEADER_CONNECTOR_CELL_REVISION,modulesSettings.getCellRevision());
  }
  return clientResource.wrap(resourceClass);
}
