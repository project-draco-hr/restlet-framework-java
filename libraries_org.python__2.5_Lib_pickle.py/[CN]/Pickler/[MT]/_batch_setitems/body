def _batch_setitems(self, items):
    save = self.save
    write = self.write
    if (not self.bin):
        for (k, v) in items:
            save(k)
            save(v)
            write(SETITEM)
        return
    r = xrange(self._BATCHSIZE)
    while (items is not None):
        tmp = []
        for i in r:
            try:
                tmp.append(items.next())
            except StopIteration:
                items = None
                break
        n = len(tmp)
        if (n > 1):
            write(MARK)
            for (k, v) in tmp:
                save(k)
                save(v)
            write(SETITEMS)
        elif n:
            (k, v) = tmp[0]
            save(k)
            save(v)
            write(SETITEM)
