def list_directory(self, path):
    'Helper to produce a directory listing (absent index.html).\n\n        Return value is either a file object, or None (indicating an\n        error).  In either case, the headers are sent, making the\n        interface the same as for send_head().\n\n        '
    try:
        list = os.listdir(path)
    except os.error:
        self.send_error(404, 'No permission to list directory')
        return None
    list.sort(key=(lambda a: a.lower()))
    f = StringIO()
    displaypath = cgi.escape(urllib.unquote(self.path))
    f.write(('<title>Directory listing for %s</title>\n' % displaypath))
    f.write(('<h2>Directory listing for %s</h2>\n' % displaypath))
    f.write('<hr>\n<ul>\n')
    for name in list:
        fullname = os.path.join(path, name)
        displayname = linkname = name
        if os.path.isdir(fullname):
            displayname = (name + '/')
            linkname = (name + '/')
        if os.path.islink(fullname):
            displayname = (name + '@')
        f.write(('<li><a href="%s">%s</a>\n' % (urllib.quote(linkname), cgi.escape(displayname))))
    f.write('</ul>\n<hr>\n')
    length = f.tell()
    f.seek(0)
    self.send_response(200)
    self.send_header('Content-type', 'text/html')
    self.send_header('Content-Length', str(length))
    self.end_headers()
    return f
