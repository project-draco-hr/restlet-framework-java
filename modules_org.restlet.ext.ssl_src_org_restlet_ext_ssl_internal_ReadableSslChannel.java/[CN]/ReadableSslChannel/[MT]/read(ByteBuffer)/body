{
  int result=0;
  boolean continueReading=true;
  getWrappedChannel().refill();
  if (getManager().getState() == SslState.WRITING_APPLICATION_DATA) {
    getManager().setState(SslState.READING_APPLICATION_DATA);
  }
  while (continueReading) {
    result+=drain(targetBuffer);
    continueReading=(getWrappedChannel().refill() > 0);
  }
  return result;
}
