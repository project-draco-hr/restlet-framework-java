{
  int result=0;
  int dstSize=targetBuffer.remaining();
  SSLEngineResult sslResult=null;
switch (getManager().getState()) {
case READING_APPLICATION_DATA:
case HANDSHAKING:
    sslResult=runEngine(targetBuffer);
  handleResult(sslResult,targetBuffer);
break;
case CLOSED:
case WRITING_APPLICATION_DATA:
break;
case CREATED:
case IDLE:
case REHANDSHAKING:
throw new IOException("Unexpected SSL state");
}
result=dstSize - targetBuffer.remaining();
return result;
}
