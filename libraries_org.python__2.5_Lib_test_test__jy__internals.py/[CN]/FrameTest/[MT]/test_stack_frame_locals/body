def test_stack_frame_locals(self):

    def h():
        a = 1
        b = 2
        raise AttributeError('spam')
    try:
        h()
    except:
        import sys
        tb = sys.exc_info()[2]
        while (tb.tb_next is not None):
            tb = tb.tb_next
        vars = tb.tb_frame.f_locals
        self.assertEquals(sorted(vars.items()), [('a', 1), ('b', 2)])
