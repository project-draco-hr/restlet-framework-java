{
  final StringBuilder sb=new StringBuilder();
  String hostName=resourceRef.getHostDomain();
  if (hostName.endsWith(".s3.amazonaws.com")) {
    String bucketName=hostName.substring(0,hostName.length() - 17);
    sb.append("/" + bucketName);
  }
  sb.append(resourceRef.getPath());
  final Form query=resourceRef.getQueryAsForm();
  if (query.getFirst("acl",true) != null) {
    sb.append("?acl");
  }
 else   if (query.getFirst("torrent",true) != null) {
    sb.append("?torrent");
  }
 else   if (query.getFirst("location",true) != null) {
    sb.append("?location");
  }
  return sb.toString();
}
