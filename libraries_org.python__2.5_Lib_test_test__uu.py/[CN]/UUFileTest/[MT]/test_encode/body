def test_encode(self):
    try:
        fin = open(self.tmpin, 'wb')
        fin.write(plaintext)
        fin.close()
        fin = open(self.tmpin, 'rb')
        fout = open(self.tmpout, 'w')
        uu.encode(fin, fout, self.tmpin, mode=420)
        fin.close()
        fout.close()
        fout = open(self.tmpout, 'r')
        s = fout.read()
        fout.close()
        self.assertEqual(s, (encodedtextwrapped % (420, self.tmpin)))
        uu.encode(self.tmpin, self.tmpout, mode=420)
        fout = open(self.tmpout, 'r')
        s = fout.read()
        fout.close()
        self.assertEqual(s, (encodedtextwrapped % (420, self.tmpin)))
    finally:
        self._kill(fin)
        self._kill(fout)
