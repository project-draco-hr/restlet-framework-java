{
  AuthenticatedUser user=codeStore.remove(code);
  if (user == null)   throw new IllegalArgumentException("Code not valid");
  Token t=generateToken(user,expire);
  user.removeCode(code);
  return t;
}
