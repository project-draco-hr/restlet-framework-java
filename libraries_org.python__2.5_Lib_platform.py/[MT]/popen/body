def popen(cmd, mode='r', bufsize=None):
    ' Portable popen() interface.\n    '
    popen = None
    if (os.environ.get('OS', '') == 'Windows_NT'):
        try:
            import win32pipe
        except ImportError:
            pass
        else:
            popen = win32pipe.popen
    if (popen is None):
        if hasattr(os, 'popen'):
            popen = os.popen
            if (sys.platform == 'win32'):
                try:
                    popen('')
                except os.error:
                    popen = _popen
        else:
            popen = _popen
    if (bufsize is None):
        return popen(cmd, mode)
    else:
        return popen(cmd, mode, bufsize)
