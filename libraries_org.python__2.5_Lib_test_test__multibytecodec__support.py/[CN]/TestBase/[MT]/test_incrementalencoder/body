def test_incrementalencoder(self):
    UTF8Reader = codecs.getreader('utf-8')
    for sizehint in (([None] + range(1, 33)) + [64, 128, 256, 512, 1024]):
        istream = UTF8Reader(StringIO(self.tstring[1]))
        ostream = StringIO()
        encoder = self.incrementalencoder()
        while 1:
            if (sizehint is not None):
                data = istream.read(sizehint)
            else:
                data = istream.read()
            if (not data):
                break
            e = encoder.encode(data)
            ostream.write(e)
        self.assertEqual(ostream.getvalue(), self.tstring[0])
