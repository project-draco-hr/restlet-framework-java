def test_incrementalencoder_error_callback(self):
    inv = self.unmappedunicode
    e = self.incrementalencoder()
    self.assertRaises(UnicodeEncodeError, e.encode, inv, True)
    e.errors = 'ignore'
    self.assertEqual(e.encode(inv, True), '')
    e.reset()

    def tempreplace(exc):
        return (u'called', exc.end)
    codecs.register_error('test.incremental_error_callback', tempreplace)
    e.errors = 'test.incremental_error_callback'
    self.assertEqual(e.encode(inv, True), 'called')
    e.errors = 'ignore'
    self.assertEqual(e.encode(inv, True), '')
