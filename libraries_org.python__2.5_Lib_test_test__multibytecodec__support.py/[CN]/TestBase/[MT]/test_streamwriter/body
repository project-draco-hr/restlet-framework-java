def test_streamwriter(self):
    readfuncs = ('read', 'readline', 'readlines')
    UTF8Reader = codecs.getreader('utf-8')
    for name in readfuncs:
        for sizehint in (([None] + range(1, 33)) + [64, 128, 256, 512, 1024]):
            istream = UTF8Reader(StringIO(self.tstring[1]))
            ostream = self.writer(StringIO())
            func = getattr(istream, name)
            while 1:
                if (sizehint is not None):
                    data = func(sizehint)
                else:
                    data = func()
                if (not data):
                    break
                if (name == 'readlines'):
                    ostream.writelines(data)
                else:
                    ostream.write(data)
            self.assertEqual(ostream.getvalue(), self.tstring[0])
