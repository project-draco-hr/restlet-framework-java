{
  if (entity instanceof Representation)   return (Representation)entity;
  if (entity == null)   return null;
  Class<? extends Object> entityClass=entity.getClass();
  SortedMetadata<MediaType> accMediaTypes=callContext.getAccMediaTypes();
  MessageBodyWriterSet mbws=this.messageBodyWriters.subSet(entityClass);
  List<MediaType> possMediaTypes;
  if (responseMediaType != null)   possMediaTypes=Collections.singletonList(responseMediaType);
 else   if (resourceMethod instanceof ResourceMethod)   possMediaTypes=determineMediaType16((ResourceMethod)resourceMethod,mbws,accMediaTypes,callContext.getResponse());
 else   possMediaTypes=Collections.singletonList(MediaType.TEXT_PLAIN);
  mbws=mbws.subSet(possMediaTypes);
  MessageBodyWriter mbw=mbws.getBest(accMediaTypes);
  if (mbw == null)   throw handleWebAppExc(new WebApplicationException(406),callContext,resourceMethod);
  MediaType mediaType;
  if (responseMediaType != null)   mediaType=responseMediaType;
 else   mediaType=determineMediaType79(possMediaTypes,callContext.getResponse());
  MultivaluedMap<String,Object> httpResponseHeaders=new WrappedRequestForHttpHeaders(callContext.getResponse(),jaxRsRespHeaders,getLogger());
  return new JaxRsOutputRepresentation(entity,mediaType,mbw,httpResponseHeaders);
}
