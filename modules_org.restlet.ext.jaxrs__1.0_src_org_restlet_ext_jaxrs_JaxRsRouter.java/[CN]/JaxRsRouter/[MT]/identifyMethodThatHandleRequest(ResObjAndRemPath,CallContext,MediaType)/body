{
  org.restlet.data.Method httpMethod=callContext.getRequest().getMethod();
  ResourceObject resObj=resObjAndRemPath.resourceObject;
  RemainingPath u=resObjAndRemPath.u;
  ResourceClass resourceClass=resObj.getResourceClass();
  Collection<ResourceMethod> resourceMethods=resourceClass.getMethodsForPath(u);
  if (resourceMethods.isEmpty())   throw new CouldNotFindMethodException(errorRestletResourceMethodNotFound,"there is no method on class " + resourceClass.getName() + " for remaining path "+ u);
  boolean alsoGet=httpMethod.equals(Method.HEAD);
  removeNotSupportedHttpMethod(resourceMethods,httpMethod,alsoGet);
  if (resourceMethods.isEmpty()) {
    if (httpMethod.equals(Method.OPTIONS)) {
      Set<Method> allowedMethods=resourceClass.getAllowedMethods(u);
      callContext.getResponse().getAllowedMethods().addAll(allowedMethods);
      throw new RequestHandledException();
    }
    throw new CouldNotFindMethodException(errorRestletMethodNotAllowed,"there is no method supporting the http method " + httpMethod + " on class "+ resourceClass.getName()+ " and remaining path "+ u);
  }
  if (givenMediaType != null) {
    Iterator<ResourceMethod> methodIter=resourceMethods.iterator();
    while (methodIter.hasNext()) {
      ResourceMethod resourceMethod=methodIter.next();
      if (!resourceMethod.isGivenMediaTypeSupported(givenMediaType))       methodIter.remove();
    }
    if (resourceMethods.isEmpty())     throw new CouldNotFindMethodException(errorRestletUnsupportedMediaType,"there is no java method on class " + resourceClass.getName() + " supporting the http method "+ httpMethod+ " and remaining path "+ u+ " and the given media types");
  }
  SortedMetadata<MediaType> accMediaTypes=callContext.getAccMediaTypes();
  Iterator<ResourceMethod> methodIter=resourceMethods.iterator();
  while (methodIter.hasNext()) {
    ResourceMethod resourceMethod=methodIter.next();
    if (!resourceMethod.isAcceptedMediaTypeSupported(accMediaTypes))     methodIter.remove();
  }
  if (resourceMethods.isEmpty()) {
    throw new CouldNotFindMethodException(errorRestletNotAcceptable,"there is no java method on class " + resourceClass.getName() + " supporting the http method "+ httpMethod+ " and remaining path "+ u+ " and the given and accepted media types");
  }
  ResourceMethod bestResourceMethod=getBestMethod(resourceMethods,givenMediaType,accMediaTypes,httpMethod);
  MatchingResult mr=bestResourceMethod.getPathRegExp().match(u);
  addMrVarsToMap(mr,callContext);
  return new ResObjAndMeth(resObj,bestResourceMethod);
}
