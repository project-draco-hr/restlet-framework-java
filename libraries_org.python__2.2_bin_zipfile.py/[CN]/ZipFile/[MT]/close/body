def close(self):
    'Close the file, and for mode "w" and "a" write the ending\n        records.'
    if (self.fp is None):
        return
    if (self.mode in ('w', 'a')):
        count = 0
        pos1 = self.fp.tell()
        for zinfo in self.filelist:
            count = (count + 1)
            dt = zinfo.date_time
            dosdate = ((((dt[0] - 1980) << 9) | (dt[1] << 5)) | dt[2])
            dostime = (((dt[3] << 11) | (dt[4] << 5)) | (dt[5] // 2))
            centdir = struct.pack(structCentralDir, stringCentralDir, zinfo.create_version, zinfo.create_system, zinfo.extract_version, zinfo.reserved, zinfo.flag_bits, zinfo.compress_type, dostime, dosdate, zinfo.CRC, zinfo.compress_size, zinfo.file_size, len(zinfo.filename), len(zinfo.extra), len(zinfo.comment), 0, zinfo.internal_attr, zinfo.external_attr, zinfo.header_offset)
            self.fp.write(centdir)
            self.fp.write(zinfo.filename)
            self.fp.write(zinfo.extra)
            self.fp.write(zinfo.comment)
        pos2 = self.fp.tell()
        endrec = struct.pack(structEndArchive, stringEndArchive, 0, 0, count, count, (pos2 - pos1), pos1, 0)
        self.fp.write(endrec)
        self.fp.flush()
    if (not self._filePassed):
        self.fp.close()
    self.fp = None
