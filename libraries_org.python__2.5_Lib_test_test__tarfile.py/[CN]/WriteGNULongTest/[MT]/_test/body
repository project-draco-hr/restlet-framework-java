def _test(self, name, link=None):
    tarinfo = tarfile.TarInfo(name)
    if link:
        tarinfo.linkname = link
        tarinfo.type = tarfile.LNKTYPE
    tar = tarfile.open(tmpname(), 'w')
    tar.posix = False
    tar.addfile(tarinfo)
    v1 = self._calc_size(name, link)
    v2 = tar.offset
    self.assertEqual(v1, v2, 'GNU longname/longlink creation failed')
    tar.close()
    tar = tarfile.open(tmpname())
    member = tar.next()
    self.failIf((member is None), 'unable to read longname member')
    self.assert_(((tarinfo.name == member.name) and (tarinfo.linkname == member.linkname)), 'unable to read longname member')
    tar.close()
