def test_main():
    f = open(tarname(), 'rb')
    fguts = f.read()
    f.close()
    if gzip:
        tar = gzip.open(tarname('gz'), 'wb')
        tar.write(fguts)
        tar.close()
    if bz2:
        tar = bz2.BZ2File(tarname('bz2'), 'wb')
        tar.write(fguts)
        tar.close()
    tests = [FileModeTest, OpenFileobjTest, ReadTest, ReadStreamTest, ReadDetectTest, ReadDetectFileobjTest, ReadAsteriskTest, ReadStreamAsteriskTest, ReadFileobjTest, WriteTest, Write100Test, WriteSize0Test, WriteStreamTest, WriteGNULongTest, ReadGNULongTest]
    if hasattr(os, 'link'):
        tests.append(ExtractHardlinkTest)
        tests.append(CreateHardlinkTest)
    if gzip:
        tests.extend([ReadTestGzip, ReadStreamTestGzip, WriteTestGzip, WriteStreamTestGzip, ReadDetectTestGzip, ReadDetectFileobjTestGzip, ReadAsteriskTestGzip, ReadStreamAsteriskTestGzip, ReadFileobjTestGzip])
    if bz2:
        tests.extend([ReadTestBzip2, ReadStreamTestBzip2, WriteTestBzip2, WriteStreamTestBzip2, ReadDetectTestBzip2, ReadDetectFileobjTestBzip2, ReadAsteriskTestBzip2, ReadStreamAsteriskTestBzip2, ReadFileobjTestBzip2])
    try:
        test_support.run_unittest(*tests)
    finally:
        if gzip:
            os.remove(tarname('gz'))
        if bz2:
            os.remove(tarname('bz2'))
        if os.path.exists(dirname()):
            shutil.rmtree(dirname())
        if os.path.exists(tmpname()):
            os.remove(tmpname())
