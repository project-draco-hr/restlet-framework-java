{
  String[] names=isFindInAncestors() ? BeanFactoryUtils.beanNamesForTypeIncludingAncestors(factory,Resource.class,true,true) : factory.getBeanNamesForType(Resource.class,true,true);
  BeanFactory bf=this.applicationContext == null ? factory : this.applicationContext;
  for (  final String name : names) {
    final String uri=resolveUri(name,factory);
    if (uri != null) {
      if (this.attachments == null || !this.attachments.containsKey(uri)) {
        attach(uri,createFinder(bf,name));
      }
    }
  }
  if (this.attachments != null) {
    for (    Map.Entry<String,String> attachment : this.attachments.entrySet()) {
      attach(attachment.getKey(),createFinder(bf,attachment.getValue()));
    }
  }
}
