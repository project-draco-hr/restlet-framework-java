{
  ListableBeanFactory source=this.applicationContext == null ? factory : this.applicationContext;
  attachAllResources(source);
  attachAllRestlets(source);
  if (getAttachments() != null) {
    for (    Map.Entry<String,String> attachment : getAttachments().entrySet()) {
      String uri=attachment.getKey();
      String beanName=attachment.getValue();
      Class<?> beanType=source.getType(beanName);
      if (Resource.class.isAssignableFrom(beanType)) {
        attachResource(uri,beanName,source);
      }
 else       if (Restlet.class.isAssignableFrom(beanType)) {
        attachRestlet(uri,beanName,source);
      }
 else {
        throw new IllegalStateException(beanName + " is not routable.  It must be either a Resource or a Restlet.");
      }
    }
  }
}
