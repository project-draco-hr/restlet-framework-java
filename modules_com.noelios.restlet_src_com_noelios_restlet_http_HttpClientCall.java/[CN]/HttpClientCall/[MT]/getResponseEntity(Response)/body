{
  Representation result=null;
  long size=Representation.UNKNOWN_SIZE;
  Series<Parameter> responseHeaders=getResponseHeaders();
  String transferEncoding=responseHeaders.getFirstValue(HttpConstants.HEADER_TRANSFER_ENCODING,true);
  if (transferEncoding != null && !"identity".equalsIgnoreCase(transferEncoding)) {
    size=Representation.UNKNOWN_SIZE;
  }
 else {
    String contentLength=responseHeaders.getFirstValue(HttpConstants.HEADER_CONTENT_LENGTH,true);
    if (contentLength != null) {
      try {
        size=Long.parseLong(contentLength);
      }
 catch (      NumberFormatException e) {
        getLogger().warning("Unkown value received as content length: \"" + contentLength + "\".");
      }
    }
  }
  if (getMethod().equals(Method.HEAD.getName())) {
    result=Representation.createEmpty();
  }
 else   if (response.getStatus().equals(Status.REDIRECTION_NOT_MODIFIED)) {
    result=Representation.createEmpty();
  }
 else   if (response.getStatus().equals(Status.SUCCESS_NO_CONTENT)) {
    result=Representation.createEmpty();
  }
 else {
    if (!response.getStatus().isInformational() && !response.getStatus().equals(Status.SUCCESS_RESET_CONTENT) && !response.getStatus().equals(Status.SUCCESS_PARTIAL_CONTENT)) {
      InputStream stream=getUnClosedResponseEntityStream(getResponseEntityStream(size));
      ReadableByteChannel channel=getResponseEntityChannel(size);
      if (stream != null) {
        result=new InputRepresentation(stream,null);
      }
 else       if (channel != null) {
        result=new ReadableRepresentation(channel,null);
      }
    }
  }
  if (result != null) {
    result.setSize(size);
    copyResponseEntityHeaders(responseHeaders,result);
    if (size == Representation.UNKNOWN_SIZE) {
      getLogger().info("The length of the message body is unknown. The entity must be handled carefully");
    }
  }
  return result;
}
