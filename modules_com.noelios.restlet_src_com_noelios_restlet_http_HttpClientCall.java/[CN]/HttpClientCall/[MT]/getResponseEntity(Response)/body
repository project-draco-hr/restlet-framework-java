{
  Representation result=null;
  long size=Representation.UNKNOWN_SIZE;
  Series<Parameter> responseHeaders=getResponseHeaders();
  String transferEncoding=responseHeaders.getFirstValue(HttpConstants.HEADER_TRANSFER_ENCODING,true);
  if (transferEncoding != null && !"identity".equalsIgnoreCase(transferEncoding)) {
    size=Representation.UNKNOWN_SIZE;
  }
 else {
    String contentLength=responseHeaders.getFirstValue(HttpConstants.HEADER_CONTENT_LENGTH,true);
    if (contentLength != null) {
      try {
        size=Long.parseLong(contentLength);
      }
 catch (      NumberFormatException e) {
        getLogger().warning("Unkown value received as content length: \"" + contentLength + "\".");
      }
    }
  }
  InputStream stream=getUnClosedResponseEntityStream(getResponseEntityStream(size));
  ReadableByteChannel channel=getResponseEntityChannel(size);
  if (stream != null) {
    result=new InputRepresentation(stream,null);
  }
 else   if (channel != null) {
    result=new ReadableRepresentation(channel,null);
  }
  result=copyResponseEntityHeaders(responseHeaders,result);
  if (result != null) {
    result.setSize(size);
    if (size == Representation.UNKNOWN_SIZE) {
      getLogger().info("The length of the message body is unknown. The entity must be handled carefully, and may be consumed entirely in order to surely release the connection.");
    }
  }
  return result;
}
