{
  tunnelFilter.getTunnelService().setMethodTunnel(true);
  Map<String,Object> attributesHeader=new HashMap<String,Object>();
  Series<Parameter> headers=new Form();
  headers.add(HttpConstants.HEADER_X_HTTP_METHOD_OVERRIDE,Method.GET.getName());
  headers.add(HttpConstants.HEADER_X_FORWARDED_FOR,"TEST");
  attributesHeader.put(HttpConstants.ATTRIBUTE_HEADERS,headers);
  createGet(UNEFFECTED);
  this.request.setAttributes(attributesHeader);
  filter();
  assertMethod(Method.GET);
  createPost(UNEFFECTED);
  filter();
  assertMethod(Method.POST);
  createPost(UNEFFECTED);
  tunnelFilter.getTunnelService().setMethodHeaderParameter(HttpConstants.HEADER_X_FORWARDED_FOR);
  this.request.setAttributes(attributesHeader);
  filter();
  assertNotSameMethod(Method.PUT);
  createPost(UNEFFECTED);
  tunnelFilter.getTunnelService().setMethodHeaderParameter(HttpConstants.HEADER_X_FORWARDED_FOR);
  tunnelFilter.getTunnelService().setHeaderTunnel(false);
  this.request.setAttributes(attributesHeader);
  filter();
  assertMethod(Method.POST);
}
