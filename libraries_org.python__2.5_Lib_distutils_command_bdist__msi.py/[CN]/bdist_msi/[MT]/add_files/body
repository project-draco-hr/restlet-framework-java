def add_files(self):
    db = self.db
    cab = msilib.CAB('distfiles')
    f = Feature(db, 'default', 'Default Feature', 'Everything', 1, directory='TARGETDIR')
    f.set_current()
    rootdir = os.path.abspath(self.bdist_dir)
    root = Directory(db, cab, None, rootdir, 'TARGETDIR', 'SourceDir')
    db.Commit()
    todo = [root]
    while todo:
        dir = todo.pop()
        for file in os.listdir(dir.absolute):
            afile = os.path.join(dir.absolute, file)
            if os.path.isdir(afile):
                newdir = Directory(db, cab, dir, file, file, ('%s|%s' % (dir.make_short(file), file)))
                todo.append(newdir)
            else:
                key = dir.add_file(file)
                if (file == self.install_script):
                    if self.install_script_key:
                        raise DistutilsOptionError, ('Multiple files with name %s' % file)
                    self.install_script_key = ('[#%s]' % key)
    cab.commit(db)
