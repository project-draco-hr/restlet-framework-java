def dump_struct(self, value, write, escape=escape):
    i = id(value)
    if self.memo.has_key(i):
        raise TypeError, 'cannot marshal recursive dictionaries'
    self.memo[i] = None
    dump = self.__dump
    write('<value><struct>\n')
    for (k, v) in value.items():
        write('<member>\n')
        if (type(k) is not StringType):
            if (unicode and (type(k) is UnicodeType)):
                k = k.encode(self.encoding)
            else:
                raise TypeError, 'dictionary key must be string'
        write(('<name>%s</name>\n' % escape(k)))
        dump(v, write)
        write('</member>\n')
    write('</struct></value>\n')
    del self.memo[i]
