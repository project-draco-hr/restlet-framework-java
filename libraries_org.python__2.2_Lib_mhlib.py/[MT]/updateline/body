def updateline(file, key, value, casefold=1):
    try:
        f = open(file, 'r')
        lines = f.readlines()
        f.close()
    except IOError:
        lines = []
    pat = (re.escape(key) + ':(.*)\n')
    prog = re.compile(pat, (casefold and re.IGNORECASE))
    if (value is None):
        newline = None
    else:
        newline = ('%s: %s\n' % (key, value))
    for i in range(len(lines)):
        line = lines[i]
        if prog.match(line):
            if (newline is None):
                del lines[i]
            else:
                lines[i] = newline
            break
    else:
        if (newline is not None):
            lines.append(newline)
    tempfile = (file + '~')
    f = open(tempfile, 'w')
    for line in lines:
        f.write(line)
    f.close()
    os.rename(tempfile, file)
