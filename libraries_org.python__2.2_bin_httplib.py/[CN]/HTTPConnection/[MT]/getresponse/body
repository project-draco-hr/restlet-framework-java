def getresponse(self):
    'Get the response from the server.'
    if (self.__response and self.__response.isclosed()):
        self.__response = None
    if ((self.__state != _CS_REQ_SENT) or self.__response):
        raise ResponseNotReady()
    if (self.debuglevel > 0):
        response = self.response_class(self.sock, self.debuglevel, strict=self.strict)
    else:
        response = self.response_class(self.sock, strict=self.strict)
    response.begin()
    assert (response.will_close != _UNKNOWN)
    self.__state = _CS_IDLE
    if response.will_close:
        self.close()
    else:
        self.__response = response
    return response
