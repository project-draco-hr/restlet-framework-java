{
  if (endDetected || !getConnection().isPersistent() || HeaderUtils.isConnectionClose(getHeaders())) {
    getConnection().close(true);
  }
  super.onMessageCompleted(endDetected);
}
