{
  List<Variant> results=super.getVariants();
  getLogger().info("Getting variants for : " + getTargetUri());
  if ((this.directoryContent != null) && (getRequest().getResourceRef() != null) && (getRequest().getResourceRef().getBaseRef() != null)) {
    SortedSet<Representation> resultSet=new TreeSet<Representation>(getRepresentationsComparator());
    String baseRef=getRequest().getResourceRef().getBaseRef().toString(false,false);
    if (!baseRef.endsWith("/")) {
      baseRef+="/";
    }
    int lastIndex=this.relativePart.lastIndexOf("/");
    if (lastIndex != -1) {
      baseRef+=this.relativePart.substring(0,lastIndex);
    }
    int rootLength=getDirectoryUri().length();
    if (this.baseName != null) {
      String filePath;
      for (      Reference ref : getVariantsReferences()) {
        Response contextResponse=getDispatcher().get(ref.toString());
        if (contextResponse.getStatus().isSuccess() && (contextResponse.getEntity() != null)) {
          filePath=ref.toString(false,false).substring(rootLength);
          Representation rep=contextResponse.getEntity();
          rep.setIdentifier(baseRef + filePath);
          resultSet.add(rep);
        }
      }
    }
    results.addAll(resultSet);
    if (resultSet.isEmpty()) {
      if (this.targetDirectory && getDirectory().isListingAllowed()) {
        ReferenceList userList=new ReferenceList(this.directoryContent.size());
        userList.setIdentifier(baseRef);
        SortedSet<Reference> sortedSet=new TreeSet<Reference>(getReferencesComparator());
        sortedSet.addAll(this.directoryContent);
        for (        Reference ref : sortedSet) {
          String filePart=ref.toString(false,false).substring(rootLength);
          StringBuilder filePath=new StringBuilder();
          if ((!baseRef.endsWith("/")) && (!filePart.startsWith("/"))) {
            filePath.append('/');
          }
          filePath.append(filePart);
          userList.add(baseRef + filePath);
        }
        List<Variant> list=getDirectory().getIndexVariants(userList);
        for (        Variant variant : list) {
          results.add(getDirectory().getIndexRepresentation(variant,userList));
        }
      }
    }
  }
 else   if (this.targetFile && (this.fileContent != null)) {
    results.add(this.fileContent);
  }
  return results;
}
