def test_expat_entityresolver():
    parser = make_parser()
    parser.setEntityResolver(TestEntityResolver())
    result = StringIO()
    parser.setContentHandler(XMLGenerator(result))
    parser.parse(StringIO('<!DOCTYPE doc [\n  <!ENTITY test SYSTEM "whatever">\n]>\n<doc>&test;</doc>'))
    return (result.getvalue() == (start + '<doc><entity></entity></doc>'))
