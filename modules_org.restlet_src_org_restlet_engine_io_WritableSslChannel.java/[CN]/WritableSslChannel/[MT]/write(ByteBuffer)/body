{
  int result=0;
  flush();
  if (getPacketBufferState() == BufferState.FILLING) {
    int srcSize=src.remaining();
    if (srcSize > 0) {
      SSLEngineResult sslResult=getManager().getEngine().wrap(src,getPacketBuffer());
      if (Context.getCurrentLogger().isLoggable(Level.INFO)) {
        Context.getCurrentLogger().log(Level.INFO,"SSL I/O result" + sslResult);
      }
      result=srcSize - src.remaining();
      getPacketBuffer().flip();
      int remaining=getPacketBuffer().remaining();
      if (remaining > 0) {
        setPacketBufferState(BufferState.DRAINING);
      }
 else {
        getPacketBuffer().clear();
      }
    }
  }
  return result;
}
