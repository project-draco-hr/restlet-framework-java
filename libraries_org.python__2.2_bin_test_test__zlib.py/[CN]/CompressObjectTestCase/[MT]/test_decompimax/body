def test_decompimax(self, source=None, cx=256, dcx=64):
    source = (source or HAMLET_SCENE)
    data = (source * 128)
    co = zlib.compressobj()
    bufs = []
    for i in range(0, len(data), cx):
        bufs.append(co.compress(data[i:(i + cx)]))
    bufs.append(co.flush())
    combuf = ''.join(bufs)
    self.assertEqual(data, zlib.decompress(combuf), 'compressed data failure')
    dco = zlib.decompressobj()
    bufs = []
    cb = combuf
    while cb:
        chunk = dco.decompress(cb, dcx)
        self.failIf((len(chunk) > dcx), ('chunk too big (%d>%d)' % (len(chunk), dcx)))
        bufs.append(chunk)
        cb = dco.unconsumed_tail
    bufs.append(dco.flush())
    self.assertEqual(data, ''.join(bufs), 'Wrong data retrieved')
