{
  String result=null;
  if (key.equals(NAME_ATTRIBUTE)) {
    String rest=key.substring(NAME_ATTRIBUTE.length());
    if ((rest.charAt(0) == '(') && (rest.charAt(rest.length() - 1) == ')')) {
      rest=rest.substring(1,rest.length() - 1);
      if (isVariableName(rest)) {
        rest=getVariableName(rest);
        result=request.getAttributes().get(rest).toString();
        if (result == null) {
          result=response.getAttributes().get(rest).toString();
        }
      }
 else {
        result=request.getResourceRef().getQueryAsForm().get(Integer.parseInt(rest)).getValue();
      }
    }
 else {
      result=defaultValue;
    }
  }
 else   if (key.equals(NAME_BASE_URI)) {
    result=request.getBaseRef().toString();
  }
 else   if (key.startsWith(NAME_CLIENT_ADDRESS)) {
    if (key.equals(NAME_CLIENT_ADDRESS)) {
      result=request.getClientInfo().getAddress();
    }
 else {
      String rest=key.substring(NAME_CLIENT_ADDRESS.length());
      if ((rest.charAt(0) == '(') && (rest.charAt(rest.length() - 1) == ')')) {
        rest=rest.substring(1,rest.length() - 1);
        if (rest.equals("first")) {
          result=request.getClientInfo().getAddresses().get(0);
        }
 else         if (rest.equals("last")) {
          result=request.getClientInfo().getAddresses().get(request.getClientInfo().getAddresses().size() - 1);
        }
 else         if (isVariableName(rest)) {
          result=defaultValue;
        }
 else {
          result=request.getClientInfo().getAddresses().get(Integer.parseInt(rest));
        }
      }
 else {
        result=defaultValue;
      }
    }
  }
 else   if (key.equals(NAME_CLIENT_AGENT)) {
    result=request.getClientInfo().getAgent();
  }
 else   if (key.startsWith(NAME_COOKIE)) {
    String rest=key.substring(NAME_COOKIE.length());
    if ((rest.charAt(0) == '(') && (rest.charAt(rest.length() - 1) == ')')) {
      rest=rest.substring(1,rest.length() - 1);
      if (rest.equals("first")) {
        result=request.getCookies().get(0).getValue();
      }
 else       if (rest.equals("last")) {
        result=request.getCookies().get(request.getCookies().size() - 1).getValue();
      }
 else       if (isVariableName(rest)) {
        rest=getVariableName(rest);
        result=getFirstCookie(request.getCookies(),rest).getValue();
      }
 else {
        result=request.getCookies().get(Integer.parseInt(rest)).getValue();
      }
    }
 else {
      result=defaultValue;
    }
  }
 else   if (key.equals(NAME_METHOD)) {
    result=request.getMethod().getName();
  }
 else   if (key.equals(NAME_REDIRECT_URI)) {
    result=response.getRedirectRef().toString();
  }
 else   if (key.equals(NAME_REFERRER_URI)) {
    result=request.getReferrerRef().toString();
  }
 else   if (key.equals(NAME_RELATIVE_URI)) {
    result=request.getRelativePart();
  }
 else   if (key.equals(NAME_RESOURCE_AUTHORITY)) {
    result=request.getResourceRef().getAuthority();
  }
 else   if (key.equals(NAME_RESOURCE_FRAGMENT)) {
    result=request.getResourceRef().getFragment();
  }
 else   if (key.equals(NAME_RESOURCE_HOST_DOMAIN)) {
    result=request.getResourceRef().getHostDomain();
  }
 else   if (key.equals(NAME_RESOURCE_HOST_PORT)) {
    result=request.getResourceRef().getHostPort().toString();
  }
 else   if (key.equals(NAME_RESOURCE_HOST_IDENTIFIER)) {
    result=request.getResourceRef().getHostIdentifier();
  }
 else   if (key.equals(NAME_RESOURCE_IDENTIFIER)) {
    result=request.getResourceRef().getIdentifier();
  }
 else   if (key.equals(NAME_RESOURCE_PATH)) {
    result=request.getResourceRef().getPath();
  }
 else   if (key.startsWith(NAME_RESOURCE_QUERY)) {
    if (key.equals(NAME_RESOURCE_QUERY)) {
      result=request.getResourceRef().getQuery();
    }
 else {
      String rest=key.substring(NAME_RESOURCE_QUERY.length());
      if ((rest.charAt(0) == '(') && (rest.charAt(rest.length() - 1) == ')')) {
        rest=rest.substring(1,rest.length() - 1);
        if (rest.equals("first")) {
          result=request.getResourceRef().getQueryAsForm().get(0).getValue();
        }
 else         if (rest.equals("last")) {
          Form form=request.getResourceRef().getQueryAsForm();
          result=form.get(form.size() - 1).getValue();
        }
 else         if (isVariableName(rest)) {
          rest=getVariableName(rest);
          result=request.getResourceRef().getQueryAsForm().getFirstValue(rest);
        }
 else {
          result=request.getResourceRef().getQueryAsForm().get(Integer.parseInt(rest)).getValue();
        }
      }
 else {
        result=defaultValue;
      }
    }
  }
 else   if (key.equals(NAME_RESOURCE_SCHEME)) {
    result=request.getResourceRef().getScheme();
  }
 else   if (key.startsWith(NAME_RESOURCE_SEGMENT)) {
    String rest=key.substring(NAME_RESOURCE_SEGMENT.length());
    if ((rest.charAt(0) == '(') && (rest.charAt(rest.length() - 1) == ')')) {
      rest=rest.substring(1,rest.length() - 1);
      if (rest.equals("first")) {
        result=request.getResourceRef().getSegments().get(0);
      }
 else       if (rest.equals("last")) {
        result=request.getResourceRef().getSegments().get(request.getResourceRef().getSegments().size() - 1);
      }
 else {
        result=request.getResourceRef().getSegments().get(Integer.parseInt(rest));
      }
    }
 else {
      result=defaultValue;
    }
  }
 else   if (key.equals(NAME_RESOURCE_URI)) {
    result=request.getResourceRef().toString();
  }
 else   if (key.equals(NAME_RESOURCE_USER_INFO)) {
    result=request.getResourceRef().getUserInfo();
  }
 else   if (key.equals(NAME_SERVER_ADDRESS)) {
    result=response.getServerInfo().getAddress();
  }
 else   if (key.equals(NAME_SERVER_AGENT)) {
    result=response.getServerInfo().getAgent();
  }
 else   if (key.equals(NAME_STATUS)) {
    result=Integer.toString(response.getStatus().getCode());
  }
  if (result == null) {
    result=this.defaultValue;
  }
  return result;
}
