def proxy_open(self, req, proxy, type):
    orig_type = req.get_type()
    (type, r_type) = splittype(proxy)
    (host, XXX) = splithost(r_type)
    if ('@' in host):
        (user_pass, host) = host.split('@', 1)
        if (':' in user_pass):
            (user, password) = user_pass.split(':', 1)
            user_pass = base64.encodestring(('%s:%s' % (unquote(user), unquote(password))))
            req.add_header('Proxy-Authorization', ('Basic ' + user_pass))
    host = unquote(host)
    req.set_proxy(host, type)
    if (orig_type == type):
        return None
    else:
        return self.parent.open(req)
