def expand_makefile_vars(s, vars):
    'Expand Makefile-style variables -- "${foo}" or "$(foo)" -- in\n    \'string\' according to \'vars\' (a dictionary mapping variable names to\n    values).  Variables not present in \'vars\' are silently expanded to the\n    empty string.  The variable values in \'vars\' should not contain further\n    variable expansions; if \'vars\' is the output of \'parse_makefile()\',\n    you\'re fine.  Returns a variable-expanded version of \'s\'.\n    '
    while 1:
        m = (_findvar1_rx.search(s) or _findvar2_rx.search(s))
        if m:
            (beg, end) = m.span()
            s = ((s[0:beg] + vars.get(m.group(1))) + s[end:])
        else:
            break
    return s
