def test_proxy_basic_auth(self):
    opener = OpenerDirector()
    ph = urllib2.ProxyHandler(dict(http='proxy.example.com:3128'))
    opener.add_handler(ph)
    password_manager = MockPasswordManager()
    auth_handler = urllib2.ProxyBasicAuthHandler(password_manager)
    realm = 'ACME Networks'
    http_handler = MockHTTPHandler(407, ('Proxy-Authenticate: Basic realm="%s"\r\n\r\n' % realm))
    opener.add_handler(auth_handler)
    opener.add_handler(http_handler)
    self._test_basic_auth(opener, auth_handler, 'Proxy-authorization', realm, http_handler, password_manager, 'http://acme.example.com:3128/protected', 'proxy.example.com:3128')
