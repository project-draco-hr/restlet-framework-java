def test_flushes(self):
    sync_opt = ['Z_NO_FLUSH', 'Z_SYNC_FLUSH', 'Z_FULL_FLUSH']
    sync_opt = [getattr(zlib, opt) for opt in sync_opt if hasattr(zlib, opt)]
    data = (HAMLET_SCENE * 8)
    for sync in sync_opt:
        for level in range(10):
            obj = zlib.compressobj(level)
            a = obj.compress(data[:3000])
            b = obj.flush(sync)
            c = obj.compress(data[3000:])
            d = obj.flush()
            self.assertEqual(zlib.decompress(''.join([a, b, c, d])), data, ('Decompress failed: flush mode=%i, level=%i' % (sync, level)))
            del obj
