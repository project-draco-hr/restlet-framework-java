{
  getMessages().remove(getMessage());
  if (!getMessage().getStatus().isInformational()) {
    Response inboundMessage=getConnection().getInboundWay().getMessages().peek();
    if (inboundMessage.getRequest() == getMessage().getRequest()) {
      getConnection().getInboundWay().getMessages().remove(inboundMessage);
    }
  }
  if (!getConnection().isPersistent() || HeaderUtils.isConnectionClose(getHeaders())) {
    getConnection().close(true);
  }
  super.onCompleted(endDetected);
}
