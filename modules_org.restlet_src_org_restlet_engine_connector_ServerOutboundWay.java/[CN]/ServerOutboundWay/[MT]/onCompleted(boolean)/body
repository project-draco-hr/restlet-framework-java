{
  if (!getConnection().isPersistent() || HeaderUtils.isConnectionClose(getHeaders())) {
    getConnection().close(true);
  }
  Representation requestEntity=getMessage().getRequest().getEntity();
  if (getMessage().isFinal() && (requestEntity != null) && requestEntity.isAvailable()) {
    try {
      if (getLogger().isLoggable(Level.FINE)) {
        getLogger().log(Level.FINE,"Automatically exhausting the request entity as it is still available after writing the final response.");
      }
      requestEntity.exhaust();
      requestEntity.release();
    }
 catch (    IOException e) {
      getLogger().log(Level.WARNING,"Unable to automatically exhaust the request entity.",e);
    }
  }
  super.onCompleted(endDetected);
}
