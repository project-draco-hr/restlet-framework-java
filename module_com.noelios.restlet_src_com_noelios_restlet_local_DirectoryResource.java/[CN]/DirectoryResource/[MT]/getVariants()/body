{
  List<Variant> result=super.getVariants();
  getLogger().info("Getting variants for : " + getTargetUri());
  String baseRef=this.request.getResourceRef().getBaseRef().toString(false,false);
  if (!baseRef.endsWith("/")) {
    baseRef+="/";
  }
  int lastIndex=this.relativePart.lastIndexOf("/");
  if (lastIndex != -1) {
    baseRef+=this.relativePart.substring(0,lastIndex);
  }
  int rootLength=getDirectoryUri().length();
  if (this.directoryContent != null) {
    if (this.baseName != null) {
      String filePath;
      for (      Reference ref : getVariantsReferences()) {
        Response contextResponse=getDispatcher().get(ref.toString());
        if (contextResponse.getStatus().isSuccess() && (contextResponse.getEntity() != null)) {
          filePath=ref.toString(false,false).substring(rootLength);
          Representation rep=contextResponse.getEntity();
          rep.setIdentifier(baseRef + filePath);
          result.add(rep);
        }
      }
    }
    if (result.size() == 0) {
      if (this.targetDirectory && getDirectory().isListingAllowed()) {
        ReferenceList userList=new ReferenceList(this.directoryContent.size());
        userList.setIdentifier(baseRef);
        for (        Reference ref : this.directoryContent) {
          String filePart=ref.toString(false,false).substring(rootLength);
          StringBuilder filePath=new StringBuilder();
          if ((!baseRef.endsWith("/")) && (!filePart.startsWith("/"))) {
            filePath.append('/');
          }
          filePath.append(filePart);
          userList.add(baseRef + filePath);
        }
        result=getDirectory().getDirectoryVariants(userList);
      }
    }
  }
  return result;
}
