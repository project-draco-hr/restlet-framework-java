def _test():
    print 'Testing os module:'
    import popen2
    cmd = 'cat'
    teststr = 'ab cd\n'
    if (os.name == 'nt'):
        cmd = 'more'
    expected = teststr.strip()
    print 'testing popen2...'
    (w, r) = os.popen2(cmd)
    w.write(teststr)
    w.close()
    got = r.read()
    if (got.strip() != expected):
        raise ValueError(('wrote %s read %s' % (`teststr`, `got`)))
    print 'testing popen3...'
    try:
        (w, r, e) = os.popen3([cmd])
    except:
        (w, r, e) = os.popen3(cmd)
    w.write(teststr)
    w.close()
    got = r.read()
    if (got.strip() != expected):
        raise ValueError(('wrote %s read %s' % (`teststr`, `got`)))
    got = e.read()
    if got:
        raise ValueError(('unexected %s on stderr' % `got`))
    for inst in popen2._active[:]:
        inst.wait()
    if popen2._active:
        raise ValueError('_active not empty')
    print 'All OK'
