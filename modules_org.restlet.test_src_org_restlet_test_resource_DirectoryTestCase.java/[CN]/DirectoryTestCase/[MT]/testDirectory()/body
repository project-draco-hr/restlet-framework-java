{
  this.testDir=new File(System.getProperty("java.io.tmpdir"),"DirectoryTestCase/tests1" + new Date().getTime());
  final Component clientComponent=new Component();
  clientComponent.getClients().add(Protocol.FILE);
  final MyApplication application=new MyApplication(this.testDir);
  clientComponent.getDefaultHost().attach("",application);
  clientComponent.start();
  application.getTunnelService().setExtensionsTunnel(true);
  IoUtils.delete(this.testDir,true);
  this.testDir=new File(System.getProperty("java.io.tmpdir"),"DirectoryTestCase/testsUserPref" + new Date().getTime());
  this.testDir.mkdirs();
  application.setTestDirectory(testDir);
  testUserPreferences(application,application.getDirectory());
  IoUtils.delete(this.testDir,true);
  this.testDir=new File(System.getProperty("java.io.tmpdir"),"DirectoryTestCase/tests2" + new Date().getTime());
  this.testDir.mkdirs();
  application.setTestDirectory(testDir);
  testDirectory(application,application.getDirectory(),"index");
  IoUtils.delete(this.testDir,true);
  this.testDir=new File(System.getProperty("java.io.tmpdir"),"DirectoryTestCase/tests3" + new Date().getTime());
  this.testDir.mkdirs();
  application.setTestDirectory(testDir);
  testDirectory(application,application.getDirectory(),"");
  application.getTunnelService().setExtensionsTunnel(false);
  IoUtils.delete(this.testDir,true);
  this.testDir=new File(System.getProperty("java.io.tmpdir"),"DirectoryTestCase/tests4" + new Date().getTime());
  this.testDir.mkdirs();
  application.setTestDirectory(testDir);
  testDirectory(application,application.getDirectory(),"index");
  IoUtils.delete(this.testDir,true);
  this.testDir=new File(System.getProperty("java.io.tmpdir"),"DirectoryTestCase/tests5" + new Date().getTime());
  this.testDir.mkdirs();
  application.setTestDirectory(testDir);
  testDirectory(application,application.getDirectory(),"");
  IoUtils.delete(this.testDir,true);
  this.testDir=new File(System.getProperty("java.io.tmpdir"),"DirectoryTestCase/tests6" + new Date().getTime());
  this.testDir.mkdirs();
  application.setTestDirectory(testDir);
  testDirectoryDeeplyAccessible(application,application.getDirectory());
  clientComponent.stop();
}
