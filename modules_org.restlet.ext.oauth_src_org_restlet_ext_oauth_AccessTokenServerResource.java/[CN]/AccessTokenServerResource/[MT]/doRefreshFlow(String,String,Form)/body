{
  String rToken=params.getFirstValue(REFRESH_TOKEN);
  if ((rToken == null) || (rToken.length() == 0)) {
    setStatus(Status.CLIENT_ERROR_BAD_REQUEST);
    return sendError(OAuthError.invalid_request,"Mandatory parameter refresh_token is missing",null);
  }
  Client client=validate(clientId,clientSecret);
  if (client == null) {
    setStatus(Status.CLIENT_ERROR_FORBIDDEN);
    return sendError(OAuthError.invalid_client,"Client id verification failed.",null);
  }
  Token token=this.generator.findToken(rToken);
  if ((token != null) && (token instanceof ExpireToken)) {
    AuthenticatedUser user=token.getUser();
    if (client.containsUser(user.getId())) {
      this.generator.refreshToken((ExpireToken)token);
      JSONObject body=createJsonToken(token,null);
      getResponse().setCacheDirectives(noStore);
      return new JsonStringRepresentation(body);
    }
 else {
      setStatus(Status.CLIENT_ERROR_FORBIDDEN);
      return sendError(OAuthError.unauthorized_client,"User does not match.",null);
    }
  }
 else {
    setStatus(Status.CLIENT_ERROR_UNAUTHORIZED);
    return sendError(OAuthError.invalid_grant,"Refresh token.",null);
  }
}
