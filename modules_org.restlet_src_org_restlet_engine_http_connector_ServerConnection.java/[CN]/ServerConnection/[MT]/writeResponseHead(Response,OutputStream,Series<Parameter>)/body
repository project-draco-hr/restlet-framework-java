{
  Protocol protocol=response.getRequest().getProtocol();
  String requestVersion=protocol.getVersion();
  String version=protocol.getTechnicalName() + '/' + ((requestVersion == null) ? "1.1" : requestVersion);
  headStream.write(version.getBytes());
  headStream.write(' ');
  headStream.write(Integer.toString(response.getStatus().getCode()).getBytes());
  headStream.write(' ');
  if (response.getStatus().getDescription() != null) {
    headStream.write(response.getStatus().getDescription().getBytes());
  }
 else {
    headStream.write(("Status " + response.getStatus().getCode()).getBytes());
  }
  headStream.write(13);
  headStream.write(10);
  if (!isPersistent()) {
    headers.set(HeaderConstants.HEADER_CONNECTION,"close",true);
  }
  if (shouldBeChunked(response.getEntity())) {
    headers.add(HeaderConstants.HEADER_TRANSFER_ENCODING,"chunked");
  }
  for (  Parameter header : headers) {
    HeaderUtils.writeHeader(header,headStream);
  }
  headStream.write(13);
  headStream.write(10);
  headStream.flush();
}
