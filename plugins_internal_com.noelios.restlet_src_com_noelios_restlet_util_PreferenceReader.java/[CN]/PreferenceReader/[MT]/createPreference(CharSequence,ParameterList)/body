{
  Preference result=null;
  if (parameters == null) {
switch (type) {
case TYPE_CHARACTER_SET:
      result=new CharacterSetPref(new CharacterSet(metadata.toString()));
    break;
case TYPE_ENCODING:
  result=new EncodingPref(new Encoding(metadata.toString()));
break;
case TYPE_LANGUAGE:
result=new LanguagePref(new Language(metadata.toString()));
break;
case TYPE_MEDIA_TYPE:
result=new MediaTypePref(new MediaType(metadata.toString()));
break;
}
}
 else {
ParameterList mediaParams=extractMediaParams(parameters);
float quality=extractQuality(parameters);
switch (type) {
case TYPE_CHARACTER_SET:
result=new CharacterSetPref(new CharacterSet(metadata.toString()),quality,parameters);
break;
case TYPE_ENCODING:
result=new EncodingPref(new Encoding(metadata.toString()),quality,parameters);
break;
case TYPE_LANGUAGE:
result=new LanguagePref(new Language(metadata.toString()),quality,parameters);
break;
case TYPE_MEDIA_TYPE:
result=new MediaTypePref(new MediaType(metadata.toString(),mediaParams),quality,parameters);
break;
}
}
return result;
}
