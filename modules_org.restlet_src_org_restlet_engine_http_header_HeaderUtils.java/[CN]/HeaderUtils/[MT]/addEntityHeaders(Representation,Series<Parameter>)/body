{
  if (entity == null || !entity.isAvailable()) {
    addHeader(HeaderConstants.HEADER_CONTENT_LENGTH,"0",headers);
  }
 else {
    if (!entity.getEncodings().isEmpty()) {
      if (entity.getEncodings().size() == 1) {
        addHeader(HeaderConstants.HEADER_CONTENT_ENCODING,entity.getEncodings().get(0).getName(),headers);
      }
 else {
        StringBuilder value=new StringBuilder();
        for (        Encoding encoding : entity.getEncodings()) {
          if (!encoding.equals(Encoding.IDENTITY)) {
            if (value.length() > 0) {
              value.append(", ");
            }
            value.append(encoding.getName());
          }
        }
        if (value.length() > 0) {
          addHeader(HeaderConstants.HEADER_CONTENT_ENCODING,value.toString(),headers);
        }
      }
    }
    if (!entity.getLanguages().isEmpty()) {
      if (entity.getLanguages().size() == 1) {
        addHeader(HeaderConstants.HEADER_CONTENT_LANGUAGE,entity.getLanguages().get(0).toString(),headers);
      }
 else {
        StringBuilder value=new StringBuilder();
        for (        Language language : entity.getLanguages()) {
          if (value.length() > 0) {
            value.append(", ");
          }
          value.append(language.getName());
        }
        addHeader(HeaderConstants.HEADER_CONTENT_LANGUAGE,value.toString(),headers);
      }
    }
    long size=entity.getAvailableSize();
    if (size != Representation.UNKNOWN_SIZE) {
      addHeader(HeaderConstants.HEADER_CONTENT_LENGTH,Long.toString(size),headers);
    }
    if (entity.getLocationRef() != null) {
      addHeader(HeaderConstants.HEADER_CONTENT_LOCATION,entity.getLocationRef().getTargetRef().toString(),headers);
    }
    if (entity.getDigest() != null && Digest.ALGORITHM_MD5.equals(entity.getDigest().getAlgorithm())) {
      addHeader(HeaderConstants.HEADER_CONTENT_MD5,new String(org.restlet.engine.util.Base64.encode(entity.getDigest().getValue(),false)),headers);
    }
    if (entity.getRange() != null) {
      try {
        addHeader(HeaderConstants.HEADER_CONTENT_RANGE,RangeWriter.write(entity.getRange(),entity.getSize()),headers);
      }
 catch (      Exception e) {
        Context.getCurrentLogger().log(Level.WARNING,"Unable to format the HTTP Content-Range header",e);
      }
    }
    if (entity.getMediaType() != null) {
      String contentType=entity.getMediaType().toString();
      if ((entity.getMediaType().getParameters().getFirstValue("charset") == null) && (entity.getCharacterSet() != null)) {
        contentType=contentType + "; charset=" + entity.getCharacterSet().getName();
      }
      addHeader(HeaderConstants.HEADER_CONTENT_TYPE,contentType,headers);
    }
    if (entity.getExpirationDate() != null) {
      addHeader(HeaderConstants.HEADER_EXPIRES,DateUtils.format(entity.getExpirationDate()),headers);
    }
    if (entity.getModificationDate() != null) {
      addHeader(HeaderConstants.HEADER_LAST_MODIFIED,HeaderWriter.write(entity.getModificationDate(),false),headers);
    }
    if (entity.getTag() != null) {
      addHeader(HeaderConstants.HEADER_ETAG,entity.getTag().format(),headers);
    }
    if (entity.getDisposition() != null && !Disposition.TYPE_NONE.equals(entity.getDisposition().getType())) {
      addHeader(HeaderConstants.HEADER_CONTENT_DISPOSITION,DispositionWriter.write(entity.getDisposition()),headers);
    }
  }
}
