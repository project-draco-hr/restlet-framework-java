def _deliver(self, mailfrom, rcpttos, data):
    import smtplib
    refused = {}
    try:
        s = smtplib.SMTP()
        s.connect(self._remoteaddr[0], self._remoteaddr[1])
        try:
            refused = s.sendmail(mailfrom, rcpttos, data)
        finally:
            s.quit()
    except smtplib.SMTPRecipientsRefused as e:
        print  >> DEBUGSTREAM, 'got SMTPRecipientsRefused'
        refused = e.recipients
    except (socket.error, smtplib.SMTPException) as e:
        print  >> DEBUGSTREAM, 'got', e.__class__
        errcode = getattr(e, 'smtp_code', (-1))
        errmsg = getattr(e, 'smtp_error', 'ignore')
        for r in rcpttos:
            refused[r] = (errcode, errmsg)
    return refused
