{
  try {
    Logger.getLogger("").setLevel(Level.FINEST);
    ParameterList response=new ParameterList(getQuery().getValuesMap());
    log.fine("response = " + response);
    log.fine("GET COOKIES");
    String openidDisc=getCookies().getFirstValue(DESCRIPTOR_COOKIE);
    log.fine("openIdDiscServer - " + getCookieSettings().getFirstValue("DESCRIPTOR_COOKIE"));
    log.fine("openIdDiscServerLength -" + getCookieSettings().size());
    log.fine("openIdDiscClient - " + openidDisc);
    log.fine("openIdDiscClientLength -" + getCookies().size());
    if (getCookieSettings().size() > 0) {
      for (      CookieSetting setting : getCookieSettings()) {
        log.fine("CookieSetting: " + setting.getName() + setting.getValue());
      }
    }
    if (getCookies().size() > 0) {
      for (      Cookie setting : getCookies()) {
        log.fine("Cookie: " + setting.getName() + setting.getValue());
      }
    }
    DiscoveryInformation discovered=(DiscoveryInformation)session.get(openidDisc);
    log.fine("discovered = " + discovered);
    log.fine("getOriginalRef = " + getOriginalRef());
    log.fine("OpenID disc : " + discovered.getOPEndpoint());
    log.fine("OpenID orig ref : " + getOriginalRef());
    ConsumerManager manager=getManager(discovered.getOPEndpoint().toString());
    VerificationResult verification=manager.verify(getOriginalRef().toString(),response,discovered);
    log.fine("verification = " + verification);
    Identifier verified=verification.getVerifiedId();
    log.fine("verified = " + verified);
    if (verified != null) {
      AuthSuccess authSuccess=(AuthSuccess)verification.getAuthResponse();
      if (authSuccess.hasExtension(AxMessage.OPENID_NS_AX)) {
        FetchRequest fetchResp=(FetchRequest)authSuccess.getExtension(AxMessage.OPENID_NS_AX);
        MessageExtension ext=authSuccess.getExtension(AxMessage.OPENID_NS_AX);
        if (ext instanceof FetchRequest) {
          Map<String,String> required=fetchResp.getAttributes(true);
          axRequired.putAll(required);
          Map<String,String> optional=fetchResp.getAttributes(false);
          axOptional.putAll(optional);
        }
      }
      return verified;
    }
  }
 catch (  OpenIDException e) {
    log.log(Level.INFO,"",e);
  }
  log.setLevel(Level.INFO);
  return null;
}
