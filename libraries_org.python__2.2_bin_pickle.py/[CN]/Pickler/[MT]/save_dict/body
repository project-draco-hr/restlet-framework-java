def save_dict(self, object):
    d = id(object)
    write = self.write
    save = self.save
    memo = self.memo
    if self.bin:
        write(EMPTY_DICT)
    else:
        write((MARK + DICT))
    memo_len = len(memo)
    self.write(self.put(memo_len))
    memo[d] = (memo_len, object)
    using_setitems = (self.bin and (len(object) > 1))
    if using_setitems:
        write(MARK)
    items = object.items()
    for (key, value) in items:
        save(key)
        save(value)
        if (not using_setitems):
            write(SETITEM)
    if using_setitems:
        write(SETITEMS)
