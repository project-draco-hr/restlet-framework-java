{
  Set<OAuth.Parameter> parameters=new HashSet<OAuth.Parameter>();
  Form headers=(Form)request.getAttributes().get("org.restlet.http.headers");
  for (  OAuth.Parameter parameter : OAuthMessage.decodeAuthorization(headers.getFirstValue("Authorization"))) {
    if (!parameter.getKey().equalsIgnoreCase("realm")) {
      parameters.add(parameter);
    }
  }
  for (  org.restlet.data.Parameter p : request.getResourceRef().getQueryAsForm()) {
    parameters.add(new OAuth.Parameter(p.getName(),p.getValue()));
  }
  if (request.getMethod() == Method.POST && request.getEntity().getMediaType() == MediaType.APPLICATION_WWW_FORM) {
    for (    org.restlet.data.Parameter p : request.getEntityAsForm()) {
      parameters.add(new OAuth.Parameter(p.getName(),p.getValue()));
    }
  }
  logger.fine("Got OAuth parameters " + parameters);
  return new ArrayList<OAuth.Parameter>(parameters);
}
