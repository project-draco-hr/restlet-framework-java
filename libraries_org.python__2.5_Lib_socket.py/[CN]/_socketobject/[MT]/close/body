def close(self):
    try:
        _active_sockets.remove(self)
    except KeyError:
        pass
    _sock = self._sock
    if isinstance(_sock, _nonblocking_api_mixin):
        _sock.close_lock.acquire()
        try:
            _sock.reference_count -= 1
            if (not _sock.reference_count):
                _sock.close()
            self._sock = _closedsocket()
            dummy = self._sock._dummy
            for method in _delegate_methods:
                setattr(self, method, dummy)
            self.send = self.recv = self.sendto = self.recvfrom = self._sock._dummy
        finally:
            _sock.close_lock.release()
