{
  String scheme=request.getResourceRef().getScheme();
  request.getResourceRef().normalize();
  if (scheme.equalsIgnoreCase(Protocol.CLAP.getSchemeName())) {
    LocalReference cr=new LocalReference(request.getResourceRef());
    if (cr.getClapAuthorityType() == LocalReference.CLAP_CLASS) {
      handleClassLoader(request,response,getClass().getClassLoader());
    }
 else     if (cr.getClapAuthorityType() == LocalReference.CLAP_SYSTEM) {
      handleClassLoader(request,response,ClassLoader.getSystemClassLoader());
    }
 else     if (cr.getClapAuthorityType() == LocalReference.CLAP_THREAD) {
      handleClassLoader(request,response,Thread.currentThread().getContextClassLoader());
    }
  }
 else {
    throw new IllegalArgumentException("Protocol \"" + scheme + "\" not supported by the connector. Only CLAP is supported.");
  }
}
