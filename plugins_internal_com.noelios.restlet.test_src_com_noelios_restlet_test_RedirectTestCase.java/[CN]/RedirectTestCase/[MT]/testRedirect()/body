{
  Container clientContainer=new Container();
  Container proxyContainer=new Container();
  Container originContainer=new Container();
  clientContainer.getClients().add(Protocol.HTTP);
  proxyContainer.getClients().add(Protocol.HTTP);
  String target="http://localhost:9090${path}#[if query]?${query}#[end]";
  RedirectRestlet proxy=new RedirectRestlet(proxyContainer.getContext(),target,RedirectRestlet.MODE_CONNECTOR);
  Restlet trace=new Restlet(){
    public void handle(    Request request,    Response response){
      String output="Resource URI:  " + request.getResourceRef() + '\n'+ "Base URI:      "+ request.getBaseRef()+ '\n'+ "Relative path: "+ request.getRelativePart()+ '\n'+ "Query string:  "+ request.getResourceRef().getQuery()+ '\n'+ "Method name:   "+ request.getMethod()+ '\n';
      response.setOutput(new StringRepresentation(output,MediaType.TEXT_PLAIN));
    }
  }
;
  proxyContainer.getLocalHost().attach("",proxy);
  originContainer.getLocalHost().attach("",trace);
  proxyContainer.getServers().add(Protocol.HTTP,8080);
  originContainer.getServers().add(Protocol.HTTP,9090);
  originContainer.start();
  proxyContainer.start();
  clientContainer.start();
  Context context=clientContainer.getContext();
  String uri="http://localhost:8080/?foo=bar";
  testCall(context,Method.GET,uri);
  testCall(context,Method.POST,uri);
  testCall(context,Method.PUT,uri);
  testCall(context,Method.DELETE,uri);
  uri="http://localhost:8080/abcd/efgh/ijkl?foo=bar&foo=beer";
  testCall(context,Method.GET,uri);
  testCall(context,Method.POST,uri);
  testCall(context,Method.PUT,uri);
  testCall(context,Method.DELETE,uri);
  uri="http://localhost:8080/v1/client/kwse/CnJlNUQV9%252BNNqbUf7Lhs2BYEK2Y%253D/user/johnm/uVGYTDK4kK4zsu96VHGeTCzfwso%253D/";
  testCall(context,Method.GET,uri);
  clientContainer.stop();
  originContainer.stop();
  proxyContainer.stop();
}
