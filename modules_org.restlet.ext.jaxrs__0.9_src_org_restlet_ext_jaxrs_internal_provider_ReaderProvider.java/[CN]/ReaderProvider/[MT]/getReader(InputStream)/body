{
  Representation entity=Request.getCurrent().getEntity();
  CharacterSet cs;
  if (entity != null) {
    cs=entity.getCharacterSet();
    if (cs == null)     cs=CharacterSet.UTF_8;
  }
 else {
    cs=CharacterSet.UTF_8;
  }
  try {
    try {
      return ByteUtils.getReader(entityStream,cs);
    }
 catch (    UnsupportedEncodingException e) {
      try {
        Reader r;
        r=ByteUtils.getReader(entityStream,CharacterSet.UTF_8);
        logger.warning("The character set " + cs + " is not available. Will use "+ CharacterSet.UTF_8);
        return r;
      }
 catch (      UnsupportedEncodingException e1) {
        try {
          return ByteUtils.getReader(entityStream,null);
        }
 catch (        UnsupportedEncodingException e2) {
          logger.warning("Neither the character set " + cs + " nor the character set "+ CharacterSet.UTF_8+ " (default) is available");
          throw new WebApplicationException(500);
        }
      }
    }
  }
 catch (  IOException ioe) {
    throw new WebApplicationException(500);
  }
}
