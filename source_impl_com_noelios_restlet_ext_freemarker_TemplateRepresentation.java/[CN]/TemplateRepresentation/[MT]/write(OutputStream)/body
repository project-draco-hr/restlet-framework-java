{
  Writer tmplWriter=null;
  try {
    Template template=loadTemplate(templatePath,config);
    if (getCharacterSet() != null) {
      tmplWriter=new BufferedWriter(new OutputStreamWriter(outputStream,getCharacterSet().getName()));
    }
 else {
      tmplWriter=new BufferedWriter(new OutputStreamWriter(outputStream,template.getEncoding()));
    }
    template.process(getValues(),tmplWriter);
  }
 catch (  TemplateException te) {
    throw new IOException("Template processing error");
  }
 finally {
    if (tmplWriter != null)     tmplWriter.close();
  }
}
