def test_custom_encoder(self):
    eq = self.assertEqual

    def encoder(msg):
        orig = msg.get_payload()
        msg.set_payload(0)
        msg['Content-Transfer-Encoding'] = 'broken64'
    au = MIMEAudio(self._audiodata, _encoder=encoder)
    eq(au.get_payload(), 0)
    eq(au['content-transfer-encoding'], 'broken64')
