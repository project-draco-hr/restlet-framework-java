def poll(self, timeout=None):
    try:
        self._check_unconnected_sockets()
        selectedkeys = self._dopoll(timeout)
        results = []
        for k in selectedkeys.iterator():
            jmask = k.readyOps()
            pymask = 0
            if (jmask & OP_READ):
                pymask |= POLLIN
            if (jmask & OP_WRITE):
                pymask |= POLLOUT
            if (jmask & OP_ACCEPT):
                pymask |= POLLIN
            if (jmask & OP_CONNECT):
                pymask |= POLLOUT
            results.append((self.chanmap[k.channel()][0], pymask))
        return results
    except java.lang.Exception as jlx:
        raise _map_exception(jlx)
