def test_setparameters(dsp):
    config1 = (ossaudiodev.AFMT_U8, 1, 8000)
    config2 = (AFMT_S16_NE, 2, 44100)
    for config in [config1, config2]:
        (fmt, channels, rate) = config
        if ((dsp.setfmt(fmt) == fmt) and (dsp.channels(channels) == channels) and (dsp.speed(rate) == rate)):
            break
    else:
        raise RuntimeError('unable to set audio sampling parameters: you must have really weird audio hardware')
    result = dsp.setparameters(fmt, channels, rate, False)
    _assert((result == (fmt, channels, rate)), ('setparameters%r: returned %r' % (config, result)))
    result = dsp.setparameters(fmt, channels, rate, True)
    _assert((result == (fmt, channels, rate)), ('setparameters%r: returned %r' % (config, result)))
