{
  Route route=null;
  if (targetClassName != null) {
    try {
      final Class<?> targetClass=Engine.loadClass(targetClassName);
      if (org.restlet.resource.Resource.class.isAssignableFrom(targetClass)) {
        final Class<? extends org.restlet.resource.Resource> resourceClass=(Class<? extends org.restlet.resource.Resource>)targetClass;
        if ((uriPattern != null) && !defaultRoute) {
          route=router.attach(uriPattern,resourceClass);
        }
 else {
          route=router.attachDefault(resourceClass);
        }
      }
 else       if (ServerResource.class.isAssignableFrom(targetClass)) {
        final Class<? extends ServerResource> resourceClass=(Class<? extends ServerResource>)targetClass;
        if ((uriPattern != null) && !defaultRoute) {
          route=router.attach(uriPattern,resourceClass);
        }
 else {
          route=router.attachDefault(resourceClass);
        }
      }
 else {
        Restlet target=null;
        try {
          target=(Restlet)targetClass.getConstructor(Context.class).newInstance(getComponent().getContext().createChildContext());
        }
 catch (        NoSuchMethodException e) {
          getLogger().log(Level.FINE,"Couldn't invoke the constructor of the target class. Please check this class has a constructor with a single parameter of type Context. The empty constructor and the context setter will be used instead: " + targetClassName,e);
          target=(Restlet)targetClass.getConstructor().newInstance();
          target.setContext(getComponent().getContext().createChildContext());
        }
        if (target != null) {
          if ((uriPattern != null) && !defaultRoute) {
            route=router.attach(uriPattern,target);
          }
 else {
            route=router.attachDefault(target);
          }
        }
      }
    }
 catch (    ClassNotFoundException e) {
      getLogger().log(Level.WARNING,"Couldn't find the target class. Please check that your classpath includes " + targetClassName,e);
    }
catch (    InstantiationException e) {
      getLogger().log(Level.WARNING,"Couldn't instantiate the target class. Please check this class has an empty constructor " + targetClassName,e);
    }
catch (    IllegalAccessException e) {
      getLogger().log(Level.WARNING,"Couldn't instantiate the target class. Please check that you have to proper access rights to " + targetClassName,e);
    }
catch (    NoSuchMethodException e) {
      getLogger().log(Level.WARNING,"Couldn't invoke the constructor of the target class. Please check this class has a constructor with a single parameter of Context " + targetClassName,e);
    }
catch (    InvocationTargetException e) {
      getLogger().log(Level.WARNING,"Couldn't instantiate the target class. An exception was thrown while creating " + targetClassName,e);
    }
  }
  return route;
}
