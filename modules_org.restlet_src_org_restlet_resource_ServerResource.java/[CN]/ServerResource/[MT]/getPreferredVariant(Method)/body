{
  if (this.preferredVariant == null) {
    List<Variant> variants=null;
    if (isAnnotated() && hasAnnotations()) {
      ConverterService cs=getConverterService();
      List<Variant> annoVariants=null;
      for (      AnnotationInfo annotationInfo : this.annotations) {
        if (method.equals(annotationInfo.getRestletMethod())) {
          annoVariants=cs.getVariants(annotationInfo.getJavaReturnType());
          if (annoVariants != null) {
            if (variants == null) {
              variants=new ArrayList<Variant>();
            }
            variants.addAll(annoVariants);
          }
        }
      }
    }
    List<Variant> methodVariants=(List<Variant>)getVariants().get(getMethod());
    if (methodVariants != null) {
      if (variants == null) {
        variants=new ArrayList<Variant>();
      }
      variants.addAll(methodVariants);
    }
    List<Variant> allVariants=(List<Variant>)getVariants().get(Method.ALL);
    if (allVariants != null) {
      if (variants == null) {
        variants=new ArrayList<Variant>();
      }
      variants.addAll(allVariants);
    }
    if ((variants != null) && (!variants.isEmpty())) {
      Language language=null;
      final Application app=Application.getCurrent();
      if (app != null) {
        language=app.getMetadataService().getDefaultLanguage();
      }
      this.preferredVariant=new VariantInfo(null,getClientInfo().getPreferredVariant(variants,language));
    }
  }
  return preferredVariant;
}
