{
  Response response=getMessage();
  ConnectedRequest request=(ConnectedRequest)response.getRequest();
  if (Status.SUCCESS_RESET_CONTENT.equals(response.getStatus()) && response.isEntityAvailable()) {
    getLogger().warning("Responses with a 205 (Reset content) status can't have an entity. Ignoring the entity for resource \"" + request.getResourceRef() + "\".");
    response.setEntity(null);
  }
 else   if (Status.REDIRECTION_NOT_MODIFIED.equals(response.getStatus()) && (request.getEntity() != null)) {
    HeaderUtils.addNotModifiedEntityHeaders(response.getEntity(),headers);
    response.setEntity(null);
  }
 else   if (response.getStatus().isInformational() && response.isEntityAvailable()) {
    getLogger().warning("Responses with an informational (1xx) status can't have an entity. Ignoring the entity for resource \"" + request.getResourceRef() + "\".");
    response.setEntity(null);
  }
  addGeneralHeaders(headers);
  addResponseHeaders(headers);
  addEntityHeaders(response.getEntity(),headers);
  if (!response.isEntityAvailable()) {
    if ((response.getEntity() != null) && response.getEntity().getSize() != 0) {
      getLogger().warning("A response with an unavailable and potentially non empty entity was returned. Ignoring the entity for resource \"" + response.getRequest().getResourceRef() + "\".");
    }
    response.setEntity(null);
  }
  if (Method.GET.equals(request.getMethod()) && Status.SUCCESS_OK.equals(response.getStatus()) && (!response.isEntityAvailable())) {
    getLogger().warning("A response with a 200 (Ok) status should have an entity. Make sure that resource \"" + request.getResourceRef() + "\" returns one or set the status to 204 (No content).");
  }
 else   if (Status.SUCCESS_NO_CONTENT.equals(response.getStatus()) && response.isEntityAvailable()) {
    getLogger().fine("Responses with a 204 (No content) status generally don't have an entity. Only adding entity headers for resource \"" + request.getResourceRef() + "\".");
    response.setEntity(null);
  }
  if (Method.HEAD.equals(request.getMethod())) {
    response.setEntity(null);
  }
}
