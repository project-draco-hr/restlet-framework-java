{
  ConcurrentMap<String,Object> attribs=getContext().getAttributes();
  Reference xrds=new Reference(attribs.get("xrds").toString());
  if ("localhost".equals(xrds.getHostDomain())) {
    xrds.setHostDomain(getReference().getBaseRef().getHostDomain());
    xrds.setHostPort(getReference().getBaseRef().getHostPort());
  }
  String returnTo=getReference().getBaseRef().toString();
  String location=(returnTo != null) ? xrds.toString() + "?returnTo=" + returnTo : xrds.toString();
  getLogger().fine("XRDS endpoint = " + xrds);
  Form headers=(Form)getResponse().getAttributes().get("org.restlet.http.headers");
  if (headers == null) {
    headers=new Form();
    headers.add("X-XRDS-Location",location);
    getResponse().getAttributes().put("org.restlet.http.headers",headers);
  }
 else {
    headers.add("X-XRDS-Location",location);
  }
  return location;
}
