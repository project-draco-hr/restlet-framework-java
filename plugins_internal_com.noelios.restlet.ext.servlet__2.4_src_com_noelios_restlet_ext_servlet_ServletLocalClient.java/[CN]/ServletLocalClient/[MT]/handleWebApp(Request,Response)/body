{
  if (request.getMethod().equals(Method.GET) || request.getMethod().equals(Method.HEAD)) {
    String basePath=request.getResourceRef().toString();
    int lastSlashIndex=basePath.lastIndexOf('/');
    String entry=(lastSlashIndex == -1) ? basePath : basePath.substring(lastSlashIndex + 1);
    Representation output=null;
    if (basePath.endsWith("/")) {
      Set entries=getServletContext().getResourcePaths(basePath);
      ReferenceList rl=new ReferenceList(entries.size());
      rl.setListRef(request.getResourceRef());
      for (Iterator iter=entries.iterator(); iter.hasNext(); ) {
        entry=(String)iter.next();
        rl.add(new Reference(basePath + entry.substring(basePath.length())));
      }
      output=rl.getRepresentation();
    }
 else {
      output=new InputRepresentation(getServletContext().getResourceAsStream(basePath),getDefaultMediaType());
      updateMetadata(entry,output);
      String mediaType=getServletContext().getMimeType(basePath);
      if (mediaType != null) {
        output.setMediaType(new MediaType(mediaType));
      }
    }
    response.setOutput(output);
    response.setStatus(Status.SUCCESS_OK);
  }
 else {
    response.setStatus(Status.CLIENT_ERROR_METHOD_NOT_ALLOWED);
  }
}
