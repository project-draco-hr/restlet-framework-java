{
  ConnectedRequest request=(ConnectedRequest)getMessage().getRequest();
  if (getHeaders() != null) {
    request.setHeaders(getHeaders());
  }
  if (HeaderUtils.isConnectionClose(getHeaders())) {
    getConnection().setState(ConnectionState.CLOSING);
  }
  Representation entity=createEntity(getHeaders());
  request.setEntity(entity);
  getMessage().getServerInfo().setAddress(getConnection().getHelper().getHelped().getAddress());
  getMessage().getServerInfo().setPort(getConnection().getHelper().getHelped().getPort());
  if (request != null) {
    if (request.isExpectingResponse()) {
      getMessages().add(getMessage());
    }
    getHelper().getInboundMessages().add(getMessage());
    getHelper().getController().wakeup();
  }
  if (!request.isEntityAvailable()) {
    onCompleted();
  }
}
