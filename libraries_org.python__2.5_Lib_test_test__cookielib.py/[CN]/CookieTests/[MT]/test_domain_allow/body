def test_domain_allow(self):
    from cookielib import CookieJar, DefaultCookiePolicy
    from urllib2 import Request
    c = CookieJar(policy=DefaultCookiePolicy(blocked_domains=['acme.com'], allowed_domains=['www.acme.com']))
    req = Request('http://acme.com/')
    headers = ['Set-Cookie: CUSTOMER=WILE_E_COYOTE; path=/']
    res = FakeResponse(headers, 'http://acme.com/')
    c.extract_cookies(res, req)
    self.assertEquals(len(c), 0)
    req = Request('http://www.acme.com/')
    res = FakeResponse(headers, 'http://www.acme.com/')
    c.extract_cookies(res, req)
    self.assertEquals(len(c), 1)
    req = Request('http://www.coyote.com/')
    res = FakeResponse(headers, 'http://www.coyote.com/')
    c.extract_cookies(res, req)
    self.assertEquals(len(c), 1)
    req = Request('http://www.coyote.com/')
    res = FakeResponse(headers, 'http://www.coyote.com/')
    cookies = c.make_cookies(res, req)
    c.set_cookie(cookies[0])
    self.assertEquals(len(c), 2)
    c.add_cookie_header(req)
    self.assert_((not req.has_header('Cookie')))
