def test_expires(self):
    from cookielib import time2netscape, CookieJar
    c = CookieJar()
    future = time2netscape((time.time() + 3600))
    interact_netscape(c, 'http://www.acme.com/', ('spam="bar"; expires=%s' % future))
    self.assertEquals(len(c), 1)
    now = time2netscape((time.time() - 1))
    interact_netscape(c, 'http://www.acme.com/', ('foo="eggs"; expires=%s' % now))
    h = interact_netscape(c, 'http://www.acme.com/')
    self.assertEquals(len(c), 1)
    self.assert_((('spam="bar"' in h) and ('foo' not in h)))
    interact_netscape(c, 'http://www.acme.com/', ('eggs="bar"; expires=%s' % future))
    interact_netscape(c, 'http://www.acme.com/', ('bar="bar"; expires=%s' % future))
    self.assertEquals(len(c), 3)
    interact_netscape(c, 'http://www.acme.com/', ('eggs="bar"; expires=%s; max-age=0' % future))
    interact_netscape(c, 'http://www.acme.com/', ('bar="bar"; max-age=0; expires=%s' % future))
    h = interact_netscape(c, 'http://www.acme.com/')
    self.assertEquals(len(c), 1)
    interact_netscape(c, 'http://www.rhubarb.net/', 'whum="fizz"')
    self.assertEquals(len(c), 2)
    c.clear_session_cookies()
    self.assertEquals(len(c), 1)
    self.assert_(('spam="bar"' in h))
