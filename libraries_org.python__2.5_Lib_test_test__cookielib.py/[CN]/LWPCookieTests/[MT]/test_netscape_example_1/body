def test_netscape_example_1(self):
    from cookielib import CookieJar, DefaultCookiePolicy
    from urllib2 import Request
    year_plus_one = (time.localtime()[0] + 1)
    headers = []
    c = CookieJar(DefaultCookiePolicy(rfc2965=True))
    req = Request('http://www.acme.com:80/', headers={'Host': 'www.acme.com:80', })
    headers.append(('Set-Cookie: CUSTOMER=WILE_E_COYOTE; path=/ ; expires=Wednesday, 09-Nov-%d 23:12:40 GMT' % year_plus_one))
    res = FakeResponse(headers, 'http://www.acme.com/')
    c.extract_cookies(res, req)
    req = Request('http://www.acme.com/')
    c.add_cookie_header(req)
    self.assertEqual(req.get_header('Cookie'), 'CUSTOMER=WILE_E_COYOTE')
    self.assertEqual(req.get_header('Cookie2'), '$Version="1"')
    headers.append('Set-Cookie: PART_NUMBER=ROCKET_LAUNCHER_0001; path=/')
    res = FakeResponse(headers, 'http://www.acme.com/')
    c.extract_cookies(res, req)
    req = Request('http://www.acme.com/foo/bar')
    c.add_cookie_header(req)
    h = req.get_header('Cookie')
    self.assert_((('PART_NUMBER=ROCKET_LAUNCHER_0001' in h) and ('CUSTOMER=WILE_E_COYOTE' in h)))
    headers.append('Set-Cookie: SHIPPING=FEDEX; path=/foo')
    res = FakeResponse(headers, 'http://www.acme.com')
    c.extract_cookies(res, req)
    req = Request('http://www.acme.com/')
    c.add_cookie_header(req)
    h = req.get_header('Cookie')
    self.assert_((('PART_NUMBER=ROCKET_LAUNCHER_0001' in h) and ('CUSTOMER=WILE_E_COYOTE' in h) and ('SHIPPING=FEDEX' not in h)))
    req = Request('http://www.acme.com/foo/')
    c.add_cookie_header(req)
    h = req.get_header('Cookie')
    self.assert_((('PART_NUMBER=ROCKET_LAUNCHER_0001' in h) and ('CUSTOMER=WILE_E_COYOTE' in h) and h.startswith('SHIPPING=FEDEX;')))
