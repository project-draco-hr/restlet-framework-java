{
  for (  final Connection<?> conn : getHelper().getConnections()) {
    if (conn.getState() == ConnectionState.CLOSED) {
      getHelper().getConnections().remove(conn);
    }
 else     if ((conn.getState() == ConnectionState.CLOSING) && conn.isEmpty()) {
      conn.close(false);
    }
 else     if (conn.hasTimedOut()) {
      conn.close(false);
      getHelper().getLogger().fine("A network connection timeout as no IO activity was detected during " + getHelper().getMaxIoIdleTimeMs() + " ms. Connection closed.");
    }
 else {
      conn.registerInterest(getSelector());
    }
  }
  if (getSelector().selectNow() > 0) {
    SelectionKey key;
    for (Iterator<SelectionKey> selectedKeys=getSelector().selectedKeys().iterator(); selectedKeys.hasNext(); ) {
      key=selectedKeys.next();
      if (key.attachment() != null) {
        ((Way)key.attachment()).onSelected();
      }
      selectedKeys.remove();
    }
  }
}
