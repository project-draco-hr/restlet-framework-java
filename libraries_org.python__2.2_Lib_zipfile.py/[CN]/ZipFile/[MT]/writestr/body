def writestr(self, zinfo, bytes):
    "Write a file into the archive.  The contents is the string\n        'bytes'."
    self._writecheck(zinfo)
    zinfo.file_size = len(bytes)
    zinfo.CRC = binascii.crc32(bytes)
    if (zinfo.compress_type == ZIP_DEFLATED):
        co = zlib.compressobj(zlib.Z_DEFAULT_COMPRESSION, zlib.DEFLATED, (-15))
        bytes = (co.compress(bytes) + co.flush())
        zinfo.compress_size = len(bytes)
    else:
        zinfo.compress_size = zinfo.file_size
    zinfo.header_offset = self.fp.tell()
    self.fp.write(zinfo.FileHeader())
    zinfo.file_offset = self.fp.tell()
    self.fp.write(bytes)
    if (zinfo.flag_bits & 8):
        self.fp.write(struct.pack('<lll', zinfo.CRC, zinfo.compress_size, zinfo.file_size))
    self.filelist.append(zinfo)
    self.NameToInfo[zinfo.filename] = zinfo
