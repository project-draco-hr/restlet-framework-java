{
  while (true) {
    try {
      if (isOverloaded()) {
        setOverloaded(isWorkerServiceBusy());
      }
 else {
        if (isWorkerServiceBusy()) {
          setOverloaded(true);
          getHelper().getLogger().log(Level.INFO,"Can't submit additional tasks. Consider increasing the maximum number of threads.");
        }
 else {
          for (          final BaseServerConnection conn : getHelper().getConnections()) {
            if (conn.canRead()) {
              execute(new Runnable(){
                public void run(){
                  conn.readRequests();
                }
              }
);
            }
            if (conn.canWrite()) {
              execute(new Runnable(){
                public void run(){
                  conn.writeResponses();
                }
              }
);
            }
          }
          for (int i=0; i < getHelper().getPendingRequests().size(); i++) {
            final ConnectedRequest request=getHelper().getPendingRequests().poll();
            if (request != null) {
              execute(new Runnable(){
                public void run(){
                  getHelper().handle(request);
                }
              }
);
            }
          }
          for (int i=0; i < getHelper().getPendingResponses().size(); i++) {
            final Response response=getHelper().getPendingResponses().poll();
            if (response != null) {
              execute(new Runnable(){
                public void run(){
                  getHelper().handle(response);
                }
              }
);
            }
          }
        }
      }
      Thread.sleep(100);
    }
 catch (    Exception ex) {
      this.helper.getLogger().log(Level.WARNING,"Unexpected error while controlling connections",ex);
    }
  }
}
