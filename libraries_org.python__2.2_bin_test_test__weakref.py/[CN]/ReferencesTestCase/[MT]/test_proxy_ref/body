def test_proxy_ref(self):
    o = C()
    o.bar = 1
    ref1 = weakref.proxy(o, self.callback)
    ref2 = weakref.proxy(o, self.callback)
    del o

    def check(proxy):
        proxy.bar
    self.assertRaises(weakref.ReferenceError, check, ref1)
    self.assertRaises(weakref.ReferenceError, check, ref2)
    self.assert_((self.cbcalled == 2))
