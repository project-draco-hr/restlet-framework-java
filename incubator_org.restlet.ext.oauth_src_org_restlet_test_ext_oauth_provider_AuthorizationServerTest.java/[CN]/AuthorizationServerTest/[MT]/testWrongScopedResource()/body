{
  String callbackUri=prot + "://localhost:" + serverPort+ "/";
  OAuthParameters right=client.getOauthParameters();
  OAuthParameters wrong=new OAuthParameters(right.getClientId(),right.getClientSecret(),right.getBaseRef().toString(),Scopes.toRoles("one two"));
  OAuthUser user=Flow.USERAGENT.execute(wrong,callbackUri,null,null,null,null);
  assertNotNull(user);
  Reference ref=new Reference(prot + "://localhost:" + serverPort+ "/server/scoped");
  ref.addQueryParameter("oauth_token",user.getAccessToken());
  ClientResource cr=new ClientResource(ref);
  try {
    cr.get();
  }
 catch (  ResourceException re) {
    assertEquals(Status.CLIENT_ERROR_FORBIDDEN,re.getStatus());
    ChallengeRequest challenge=cr.getChallengeRequests().get(0);
    assertNotNull(challenge);
    String error=challenge.getParameters().getFirstValue("error");
    assertEquals("Checking error code",OAuthError.INSUFFICIENT_SCOPE.name(),error);
  }
  cr.release();
}
