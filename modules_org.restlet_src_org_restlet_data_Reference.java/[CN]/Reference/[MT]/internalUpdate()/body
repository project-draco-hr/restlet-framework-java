{
  if (internalRef != null) {
    for (int i=0; i < internalRef.length(); i++) {
      if (!isValid(internalRef.charAt(i))) {
        throw new IllegalArgumentException("Invalid character detected in URI reference at index '" + i + "': \""+ internalRef.charAt(i)+ "\"");
      }
    }
    int firstSlashIndex=this.internalRef.indexOf('/');
    this.schemeIndex=this.internalRef.indexOf(':');
    if ((firstSlashIndex != -1) && (this.schemeIndex > firstSlashIndex)) {
      this.schemeIndex=-1;
    }
    this.queryIndex=this.internalRef.indexOf('?');
    this.fragmentIndex=this.internalRef.indexOf('#');
    if ((this.queryIndex != -1) && (this.fragmentIndex != -1) && (this.queryIndex > this.fragmentIndex)) {
      this.queryIndex=-1;
    }
  }
 else {
    this.schemeIndex=-1;
    this.queryIndex=-1;
    this.fragmentIndex=-1;
  }
}
