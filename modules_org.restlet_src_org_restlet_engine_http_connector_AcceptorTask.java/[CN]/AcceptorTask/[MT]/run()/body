{
  this.latch.countDown();
  while (true) {
    try {
      SocketChannel socketChannel=this.serverSocket.accept();
      int connectionsCount=getHelper().getConnections().size();
      if ((getHelper().getMaxTotalConnections() == -1) || (connectionsCount <= getHelper().getMaxTotalConnections())) {
        Connection<Server> connection=getHelper().createConnection(getHelper(),socketChannel.socket(),socketChannel);
        connection.open();
        getHelper().getConnections().add(connection);
      }
 else {
        socketChannel.close();
        getHelper().getLogger().info("Maximum number of concurrent connections reached. New connection rejected.");
      }
    }
 catch (    ClosedByInterruptException ex) {
      this.helper.getLogger().log(Level.FINE,"ServerSocket channel was closed by interrupt",ex);
      break;
    }
catch (    IOException ex) {
      this.helper.getLogger().log(Level.WARNING,"Unexpected error while accepting new connection",ex);
    }
  }
}
