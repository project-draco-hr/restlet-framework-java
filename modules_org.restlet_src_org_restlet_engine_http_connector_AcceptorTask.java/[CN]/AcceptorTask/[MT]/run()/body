{
  this.latch.countDown();
  setRunning(true);
  while (isRunning()) {
    try {
      Socket socket=this.serverSocket.accept();
      int connectionsCount=getHelper().getConnections().size();
      if ((getHelper().getMaxTotalConnections() == -1) || (connectionsCount <= getHelper().getMaxTotalConnections())) {
        Connection<Server> connection=getHelper().createConnection(getHelper(),socket,null);
        connection.open();
        getHelper().getConnections().add(connection);
      }
 else {
        socket.close();
        getHelper().getLogger().info("Maximum number of concurrent connections reached. New connection rejected.");
      }
    }
 catch (    ClosedByInterruptException ex) {
      this.helper.getLogger().log(Level.FINE,"ServerSocket channel was closed by interrupt",ex);
      break;
    }
catch (    AsynchronousCloseException ace) {
      this.helper.getLogger().log(Level.FINE,"The server socket was closed",ace);
    }
catch (    IOException ex) {
      this.helper.getLogger().log(Level.WARNING,"Unexpected error while accepting new connection",ex);
    }
  }
}
