def compile(p, flags=0):
    if (type(p) in STRING_TYPES):
        import sre_parse
        pattern = p
        p = sre_parse.parse(p, flags)
    else:
        pattern = None
    code = _code(p, flags)
    assert (p.pattern.groups <= 100), 'sorry, but this version only supports 100 named groups'
    groupindex = p.pattern.groupdict
    indexgroup = ([None] * p.pattern.groups)
    for (k, i) in groupindex.items():
        indexgroup[i] = k
    return _sre.compile(pattern, flags, code, (p.pattern.groups - 1), groupindex, indexgroup)
