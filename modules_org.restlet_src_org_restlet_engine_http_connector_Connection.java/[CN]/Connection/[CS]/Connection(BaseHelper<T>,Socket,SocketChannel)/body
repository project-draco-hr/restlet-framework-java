{
  this.helper=helper;
  this.inboundMessages=isClientSide() ? null : new ConcurrentLinkedQueue<Response>();
  this.outboundMessages=new ConcurrentLinkedQueue<Response>();
  this.persistent=helper.isPersistingConnections();
  this.pipelining=false;
  this.state=ConnectionState.OPENING;
  this.socket=socket;
  this.socketChannel=socketChannel;
  this.inboundBusy=false;
  this.outboundBusy=false;
  if (getHelper().isTracing()) {
    this.inboundStream=new TraceInputStream(new InboundStream(getSocket().getInputStream()));
    this.outboundStream=new TraceOutputStream(new OutboundStream(getSocket().getOutputStream()));
  }
 else {
    this.inboundStream=new InboundStream(getSocket().getInputStream());
    this.outboundStream=new OutboundStream(getSocket().getOutputStream());
  }
}
