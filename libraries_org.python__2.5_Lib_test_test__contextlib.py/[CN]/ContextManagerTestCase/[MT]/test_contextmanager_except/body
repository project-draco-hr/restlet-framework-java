def test_contextmanager_except(self):
    state = []

    @contextmanager
    def woohoo():
        state.append(1)
        try:
            yield 42
        except ZeroDivisionError as e:
            state.append(e.args[0])
            self.assertEqual(state, [1, 42, 999])
    with woohoo() as x:
        self.assertEqual(state, [1])
        self.assertEqual(x, 42)
        state.append(x)
        raise ZeroDivisionError(999)
    self.assertEqual(state, [1, 42, 999])
