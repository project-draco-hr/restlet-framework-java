def test_closing(self):
    state = []


    class C:

        def close(self):
            state.append(1)
    x = C()
    self.assertEqual(state, [])
    with closing(x) as y:
        self.assertEqual(x, y)
    self.assertEqual(state, [1])
