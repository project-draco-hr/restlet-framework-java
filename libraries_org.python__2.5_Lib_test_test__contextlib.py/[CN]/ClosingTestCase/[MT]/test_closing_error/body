def test_closing_error(self):
    state = []


    class C:

        def close(self):
            state.append(1)
    x = C()
    self.assertEqual(state, [])
    try:
        with closing(x) as y:
            self.assertEqual(x, y)
            (1 / 0)
    except ZeroDivisionError:
        self.assertEqual(state, [1])
    else:
        self.fail("Didn't raise ZeroDivisionError")
