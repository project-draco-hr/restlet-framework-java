def testWithOpen(self):
    tfn = tempfile.mktemp()
    try:
        f = None
        with open(tfn, 'w') as f:
            self.failIf(f.closed)
            f.write('Booh\n')
        self.failUnless(f.closed)
        f = None
        try:
            with open(tfn, 'r') as f:
                self.failIf(f.closed)
                self.assertEqual(f.read(), 'Booh\n')
                (1 / 0)
        except ZeroDivisionError:
            self.failUnless(f.closed)
        else:
            self.fail("Didn't raise ZeroDivisionError")
    finally:
        try:
            os.remove(tfn)
        except os.error:
            pass
