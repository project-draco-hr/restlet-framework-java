def test_dict_chunking(self):
    n = 10
    x = dict.fromkeys(range(n))
    for proto in protocols:
        s = self.dumps(x, proto)
        y = self.loads(s)
        self.assertEqual(x, y)
        num_setitems = count_opcode(pickle.SETITEMS, s)
        self.assertEqual(num_setitems, (proto > 0))
    n = 2500
    x = dict.fromkeys(range(n))
    for proto in protocols:
        s = self.dumps(x, proto)
        y = self.loads(s)
        self.assertEqual(x, y)
        num_setitems = count_opcode(pickle.SETITEMS, s)
        if (proto == 0):
            self.assertEqual(num_setitems, 0)
        else:
            self.failUnless((num_setitems >= 2))
