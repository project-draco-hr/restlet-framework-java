def _subx(pattern, template):
    template = _compile_repl(template, pattern)
    if ((not template[0]) and (len(template[1]) == 1)):
        return template[1][0]

    def filter(match, template=template):
        return sre_parse.expand_template(template, match)
    return filter
