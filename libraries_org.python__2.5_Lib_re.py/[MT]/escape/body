def escape(pattern):
    'Escape all non-alphanumeric characters in pattern.'
    s = list(pattern)
    alphanum = _alphanum
    for i in range(len(pattern)):
        c = pattern[i]
        if (c not in alphanum):
            if (c == '\x00'):
                s[i] = '\\000'
            else:
                s[i] = ('\\' + c)
    return pattern[:0].join(s)
