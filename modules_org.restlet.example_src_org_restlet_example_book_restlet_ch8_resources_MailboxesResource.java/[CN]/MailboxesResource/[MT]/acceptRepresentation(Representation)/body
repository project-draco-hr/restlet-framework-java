{
  final Form form=new Form(entity);
  Mailbox mailbox=new Mailbox();
  System.out.println(Reference.decode(form.getFirstValue("nickname")));
  mailbox.setNickname(form.getFirstValue("nickname"));
  final User owner=getObjectsFacade().getUserById(form.getFirstValue("ownerId"));
  mailbox.setOwner(owner);
  mailbox.setSenderName(owner.getFirstName() + " " + owner.getLastName());
  try {
    mailbox=getObjectsFacade().createMailbox(mailbox);
    getResponse().redirectSeeOther(getRequest().getResourceRef());
  }
 catch (  ObjectsException e) {
    final Map<String,Object> dataModel=new TreeMap<String,Object>();
    dataModel.put("currentUser",getCurrentUser());
    dataModel.put("mailboxes",this.mailboxes);
    dataModel.put("users",this.users);
    dataModel.put("resourceRef",getRequest().getResourceRef());
    dataModel.put("rootRef",getRequest().getRootRef());
    dataModel.put("ownerId",form.getFirstValue("ownerId"));
    dataModel.put("nickname",form.getFirstValue("nickname"));
    dataModel.put("errorMessage",e.getMessage());
    getResponse().setEntity(getHTMLTemplateRepresentation("mailboxes.html",dataModel));
  }
}
