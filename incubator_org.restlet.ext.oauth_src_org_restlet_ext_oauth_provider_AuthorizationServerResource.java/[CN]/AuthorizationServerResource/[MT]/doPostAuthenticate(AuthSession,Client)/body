{
  Reference ref=new Reference("riap://application/auth_page");
  log.info("Name = " + getApplication().getInboundRoot());
  ref.addQueryParameter("client",client.getClientId());
  String[] scopes=session.getRequestedScope();
  if (scopes != null && scopes.length > 0) {
    for (    String s : scopes)     ref.addQueryParameter("scope",s);
  }
  AuthenticatedUser user=client.findUser(session.getScopeOwner());
  if (user != null) {
    scopes=user.getGrantedScopes();
    if (scopes != null && scopes.length > 0) {
      for (      String s : scopes)       ref.addQueryParameter("grantedScope",s);
    }
  }
  log.info("Redir = " + ref);
  Redirector dispatcher=new Redirector(getContext(),ref.toString(),Redirector.MODE_SERVER_OUTBOUND);
  dispatcher.handle(getRequest(),getResponse());
  return getResponse().getEntity();
}
