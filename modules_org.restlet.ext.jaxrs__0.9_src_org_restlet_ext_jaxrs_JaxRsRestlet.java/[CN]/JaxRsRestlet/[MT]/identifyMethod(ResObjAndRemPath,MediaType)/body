{
  final CallContext callContext=this.tlContext.get();
  final org.restlet.data.Method httpMethod=callContext.getRequest().getMethod();
  final ResourceObject resObj=resObjAndRemPath.resourceObject;
  final RemainingPath u=resObjAndRemPath.u;
  final ResourceClass resourceClass=resObj.getResourceClass();
  Collection<ResourceMethod> resourceMethods=resourceClass.getMethodsForPath(u);
  if (resourceMethods.isEmpty()) {
    this.excHandler.resourceMethodNotFound();
  }
  final boolean alsoGet=httpMethod.equals(Method.HEAD);
  removeNotSupportedHttpMethod(resourceMethods,httpMethod,alsoGet);
  if (resourceMethods.isEmpty()) {
    final Set<Method> allowedMethods=resourceClass.getAllowedMethods(u);
    if (httpMethod.equals(Method.OPTIONS)) {
      callContext.getResponse().getAllowedMethods().addAll(allowedMethods);
      throw new RequestHandledException();
    }
    this.excHandler.methodNotAllowed(allowedMethods);
  }
  if (givenMediaType != null) {
    final Collection<ResourceMethod> supporting=resourceMethods;
    resourceMethods=new ArrayList<ResourceMethod>();
    for (    final ResourceMethod resourceMethod : supporting) {
      if (resourceMethod.isGivenMediaTypeSupported(givenMediaType)) {
        resourceMethods.add(resourceMethod);
      }
    }
    if (resourceMethods.isEmpty()) {
      this.excHandler.unsupportedMediaType(supporting);
    }
  }
  final SortedMetadata<MediaType> accMediaTypes=callContext.getAccMediaTypes();
  final Collection<ResourceMethod> supporting=resourceMethods;
  resourceMethods=new ArrayList<ResourceMethod>();
  for (  final ResourceMethod resourceMethod : supporting) {
    if (resourceMethod.isAcceptedMediaTypeSupported(accMediaTypes)) {
      resourceMethods.add(resourceMethod);
    }
  }
  if (resourceMethods.isEmpty()) {
    this.excHandler.noResourceMethodForAccMediaTypes(supporting);
  }
  final ResourceMethod bestResourceMethod=getBestMethod(resourceMethods,givenMediaType,accMediaTypes,httpMethod);
  final MatchingResult mr=bestResourceMethod.getPathRegExp().match(u);
  addPathVarsToMap(mr,callContext);
  final String matchedUriPart=mr.getMatched();
  if (matchedUriPart.length() > 0) {
    final Object jaxRsResObj=resObj.getJaxRsResourceObject();
    callContext.addForAncestor(jaxRsResObj,matchedUriPart);
  }
  return new ResObjAndMeth(resObj,bestResourceMethod);
}
