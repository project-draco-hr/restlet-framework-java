def domain_return_ok(self, domain, request):
    (req_host, erhn) = eff_request_host(request)
    if (not req_host.startswith('.')):
        req_host = ('.' + req_host)
    if (not erhn.startswith('.')):
        erhn = ('.' + erhn)
    if (not (req_host.endswith(domain) or erhn.endswith(domain))):
        return False
    if self.is_blocked(domain):
        _debug('   domain %s is in user block-list', domain)
        return False
    if self.is_not_allowed(domain):
        _debug('   domain %s is not in user allow-list', domain)
        return False
    return True
