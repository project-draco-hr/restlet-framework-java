def escape_path(path):
    'Escape any invalid characters in HTTP URL, and uppercase all escapes.'
    if isinstance(path, unicode):
        path = path.encode('utf-8')
    path = urllib.quote(path, HTTP_PATH_SAFE)
    path = ESCAPED_CHAR_RE.sub(uppercase_escaped_char, path)
    return path
