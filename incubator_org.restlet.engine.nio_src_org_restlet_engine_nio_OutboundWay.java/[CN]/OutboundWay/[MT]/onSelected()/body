{
  try {
    if (getIoState() == IoState.WRITE_INTEREST) {
      Response message=getMessage();
      if (message != null) {
        boolean canWrite=true;
        while (canWrite) {
          if (getBuffer().hasRemaining() && (getMessageState() != MessageState.BODY)) {
            if (getBuilder().length() == 0) {
              writeLine();
            }
            if (getBuilder().length() > 0) {
              int remaining=getBuffer().remaining();
              if (remaining >= getBuilder().length()) {
                getBuffer().put(StringUtils.getLatin1Bytes(getBuilder().toString()));
                getBuilder().delete(0,getBuilder().length());
              }
 else {
                getBuffer().put(StringUtils.getLatin1Bytes(getBuilder().substring(0,remaining)));
                getBuilder().delete(0,remaining);
              }
            }
          }
 else {
            getBuffer().flip();
            canWrite=(getConnection().getSocketChannel().write(getBuffer()) > 0);
          }
        }
      }
    }
  }
 catch (  Exception e) {
    getLogger().log(Level.WARNING,"Error while writing an HTTP message: ",e.getMessage());
    getLogger().log(Level.INFO,"Error while writing an HTTP message",e);
  }
}
