{
  try {
    Response message=null;
    if (canWrite()) {
      message=getMessages().peek();
      if (message != null) {
        setMessageState(MessageState.START_LINE);
        setIoState(IoState.WRITE_INTEREST);
        writeMessage(message);
        if ((getConnection().getState() == ConnectionState.CLOSING) && !isBusy()) {
          close(true);
        }
      }
    }
  }
 catch (  Exception e) {
    getLogger().log(Level.WARNING,"Error while writing an HTTP message: ",e.getMessage());
    getLogger().log(Level.INFO,"Error while writing an HTTP message",e);
  }
}
