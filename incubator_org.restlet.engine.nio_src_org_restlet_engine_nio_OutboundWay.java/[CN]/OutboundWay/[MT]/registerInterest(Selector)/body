{
  if ((getIoState() == IoState.IDLE) && (getMessages().size() > 0)) {
    if (getMessage() == null) {
      setIoState(IoState.WRITE_INTEREST);
      setMessage(getMessages().peek());
      setMessageState(MessageState.START_LINE);
      setHeaderIndex(0);
    }
  }
  SelectableChannel entitySelectableChannel=getEntitySelectableChannel();
  if (entitySelectableChannel != null) {
    int entityInterestOps=getEntityInterestOps();
    if ((getEntityKey() == null) && (entityInterestOps > 0)) {
      try {
        setEntityKey(entitySelectableChannel.register(selector,entityInterestOps,new Selectable(){
          public void onSelected(          SelectionKey key){
          }
        }
));
      }
 catch (      ClosedChannelException cce) {
        getLogger().log(Level.WARNING,"Unable to register NIO interest operations for this entity",cce);
        getConnection().onError();
      }
    }
 else {
      getEntityKey().interestOps(entityInterestOps);
    }
  }
}
