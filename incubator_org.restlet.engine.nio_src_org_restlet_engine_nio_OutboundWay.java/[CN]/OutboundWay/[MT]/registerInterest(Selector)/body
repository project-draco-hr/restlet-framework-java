{
  if ((getIoState() == IoState.IDLE) && (getMessages().size() > 0)) {
    if (getMessage() == null) {
      setIoState(IoState.WRITE_INTEREST);
      setMessage(getMessages().peek());
      setMessageState(MessageState.START_LINE);
      setHeaderIndex(0);
      setSocketKey(null);
    }
  }
  super.registerInterest(selector);
  SelectableChannel entitySelectableChannel=getEntitySelectableChannel();
  if (entitySelectableChannel != null) {
    int entityInterestOps=getEntityInterestOps();
    if ((getEntityKey() == null) && (entityInterestOps > 0)) {
      try {
        setEntityKey(entitySelectableChannel.register(selector,entityInterestOps,this));
      }
 catch (      ClosedChannelException cce) {
        getLogger().log(Level.WARNING,"Unable to register NIO interest operations for this entity",cce);
        getConnection().onError();
      }
    }
 else {
      if (entityInterestOps == 0) {
        getEntityKey().cancel();
      }
 else {
        getEntityKey().interestOps(entityInterestOps);
      }
    }
  }
}
