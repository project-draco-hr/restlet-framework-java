def test_stdout_stderr_file(self):
    tf = tempfile.TemporaryFile()
    p = subprocess.Popen([sys.executable, '-c', 'import sys;sys.stdout.write("apple");sys.stdout.flush();sys.stderr.write("orange")'], stdout=tf, stderr=tf)
    p.wait()
    tf.seek(0)
    output = tf.read()
    stripped = remove_stderr_debug_decorations(output)
    self.assertEqual(stripped, 'appleorange')
