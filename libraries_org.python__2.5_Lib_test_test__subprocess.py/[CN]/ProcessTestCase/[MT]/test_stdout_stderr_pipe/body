def test_stdout_stderr_pipe(self):
    p = subprocess.Popen([sys.executable, '-c', 'import sys;sys.stdout.write("apple");sys.stdout.flush();sys.stderr.write("orange")'], stdout=subprocess.PIPE, stderr=subprocess.STDOUT)
    output = p.stdout.read()
    stripped = remove_stderr_debug_decorations(output)
    self.assertEqual(stripped, 'appleorange')
