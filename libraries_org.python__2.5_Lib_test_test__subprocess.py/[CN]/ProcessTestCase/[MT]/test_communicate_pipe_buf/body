def test_communicate_pipe_buf(self):
    if (mswindows or (jython and (os._name == 'nt'))):
        pipe_buf = 512
    elif jython:
        pipe_buf = 16384
    else:
        (x, y) = os.pipe()
        pipe_buf = os.fpathconf(x, 'PC_PIPE_BUF')
        os.close(x)
        os.close(y)
    p = subprocess.Popen([sys.executable, '-c', ('import sys,os;sys.stdout.write(sys.stdin.read(47));sys.stderr.write("xyz"*%d);sys.stdout.write(sys.stdin.read())' % pipe_buf)], stdin=subprocess.PIPE, stdout=subprocess.PIPE, stderr=subprocess.PIPE)
    string_to_write = ('abc' * pipe_buf)
    (stdout, stderr) = p.communicate(string_to_write)
    self.assertEqual(stdout, string_to_write)
