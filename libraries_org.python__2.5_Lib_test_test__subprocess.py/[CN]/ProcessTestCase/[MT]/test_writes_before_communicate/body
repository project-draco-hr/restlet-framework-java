def test_writes_before_communicate(self):
    p = subprocess.Popen([sys.executable, '-c', 'import sys,os;sys.stdout.write(sys.stdin.read())'], stdin=subprocess.PIPE, stdout=subprocess.PIPE, stderr=subprocess.PIPE)
    p.stdin.write('banana')
    (stdout, stderr) = p.communicate('split')
    self.assertEqual(stdout, 'bananasplit')
    self.assertEqual(remove_stderr_debug_decorations(stderr), '')
