def end(self, tag):
    self._flush()
    self._last = self._elem.pop()
    assert (self._last.tag == tag), ('end tag mismatch (expected %s, got %s)' % (self._last.tag, tag))
    self._tail = 1
    return self._last
