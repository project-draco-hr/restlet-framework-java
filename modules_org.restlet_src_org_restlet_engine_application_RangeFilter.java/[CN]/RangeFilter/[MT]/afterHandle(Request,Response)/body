{
  if (getRangeService().isEnabled()) {
    response.getServerInfo().setAcceptRanges(true);
    if (request.getMethod().isSafe() && response.isEntityAvailable()) {
      boolean rangedEntity=response.getEntity().getRange() != null;
      if (response.getStatus().isSuccess() && !Status.SUCCESS_PARTIAL_CONTENT.equals(response.getStatus())) {
        if (request.getRanges().size() == 1) {
          Range requestedRange=request.getRanges().get(0);
          if (response.getEntity().getSize() == Representation.UNKNOWN_SIZE) {
            if ((requestedRange.getIndex() == Range.INDEX_LAST || requestedRange.getSize() == Range.SIZE_MAX) && !(requestedRange.getIndex() == Range.INDEX_LAST && requestedRange.getSize() == Range.SIZE_MAX)) {
              response.setStatus(Status.SERVER_ERROR_INTERNAL);
              getLogger().warning("Unable to serve this range since at least the end index of the range cannot be computed.");
              response.setEntity(null);
            }
          }
 else {
            if (!requestedRange.equals(response.getEntity().getRange())) {
              if (rangedEntity) {
                getLogger().info("The range of the response entity is not equal to the requested one.");
              }
              response.setEntity(new RangeRepresentation(response.getEntity(),requestedRange));
              response.setStatus(Status.SUCCESS_PARTIAL_CONTENT);
            }
          }
        }
 else         if (request.getRanges().size() > 1) {
          response.setStatus(Status.SERVER_ERROR_NOT_IMPLEMENTED);
          getLogger().warning("Multiple ranges are not supported at this time.");
          response.setEntity(null);
        }
      }
 else {
        if (rangedEntity) {
          getLogger().info("The status of a response to a partial GET must be \"206 Partial content\".");
        }
      }
    }
  }
}
