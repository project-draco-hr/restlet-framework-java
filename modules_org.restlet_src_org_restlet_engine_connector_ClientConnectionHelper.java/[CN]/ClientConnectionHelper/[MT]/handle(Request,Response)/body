{
  try {
    getLogger().finer("Handling request...");
    if (isSynchronous(request) && request.isExpectingResponse()) {
      CountDownLatch latch=new CountDownLatch(1);
      request.getAttributes().put(CONNECTOR_LATCH,latch);
      getOutboundMessages().add(response);
      getController().wakeup();
      if (getMaxIoIdleTimeMs() <= 0) {
        latch.await();
      }
 else {
        if (!latch.await(getMaxIoIdleTimeMs(),TimeUnit.MILLISECONDS)) {
          response.setStatus(Status.CONNECTOR_ERROR_INTERNAL,"The calling thread timed out while waiting for a response to unblock it.");
        }
      }
    }
 else {
      getOutboundMessages().add(response);
      getController().wakeup();
    }
  }
 catch (  Exception e) {
    getLogger().log(Level.INFO,"Error while handling a " + request.getProtocol().getName() + " client request",e);
    response.setStatus(Status.CONNECTOR_ERROR_INTERNAL,e);
  }
}
