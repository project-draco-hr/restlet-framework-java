{
  super.beforeHandle(call);
  if (isMethodTunnel()) {
    String methodName=(String)call.getAttributes().get(getMethodAttribute());
    if (methodName != null) {
      call.setMethod(Methods.create(methodName));
    }
  }
  if (isPreferencesTunnel()) {
    String acceptCharset=(String)call.getAttributes().get(getCharacterSetsAttribute());
    String acceptEncoding=(String)call.getAttributes().get(getEncodingsAttribute());
    String acceptLanguage=(String)call.getAttributes().get(getLanguagesAttribute());
    String acceptMediaType=(String)call.getAttributes().get(getMediaTypesAttribute());
    if (acceptCharset != null) {
      call.getClient().getCharacterSetPrefs().clear();
      PreferenceUtils.parseCharacterSets(acceptCharset,call.getClient());
    }
    if (acceptEncoding != null) {
      call.getClient().getEncodingPrefs().clear();
      PreferenceUtils.parseEncodings(acceptEncoding,call.getClient());
    }
    if (acceptLanguage != null) {
      call.getClient().getLanguagePrefs().clear();
      PreferenceUtils.parseLanguages(acceptLanguage,call.getClient());
    }
    if (acceptMediaType != null) {
      call.getClient().getMediaTypePrefs().clear();
      PreferenceUtils.parseMediaTypes(acceptMediaType,call.getClient());
    }
  }
  if (isUriTunnel()) {
    String uri=(String)call.getAttributes().get(getUriAttribute());
    if (uri != null) {
      call.setResourceRef(uri);
    }
  }
}
