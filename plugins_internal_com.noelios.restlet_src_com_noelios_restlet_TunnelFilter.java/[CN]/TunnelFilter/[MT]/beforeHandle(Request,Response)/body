{
  super.beforeHandle(request,response);
  if (isMethodTunnel()) {
    String methodName=(String)request.getAttributes().get(getMethodAttribute());
    if (methodName != null) {
      request.setMethod(Method.valueOf(methodName));
    }
  }
  if (isPreferencesTunnel()) {
    String acceptCharset=(String)request.getAttributes().get(getCharacterSetsAttribute());
    String acceptEncoding=(String)request.getAttributes().get(getEncodingsAttribute());
    String acceptLanguage=(String)request.getAttributes().get(getLanguagesAttribute());
    String acceptMediaType=(String)request.getAttributes().get(getMediaTypesAttribute());
    if (acceptCharset != null) {
      request.getClientInfo().getAcceptedCharacterSets().clear();
      PreferenceUtils.parseCharacterSets(acceptCharset,request.getClientInfo());
    }
    if (acceptEncoding != null) {
      request.getClientInfo().getAcceptedEncodings().clear();
      PreferenceUtils.parseEncodings(acceptEncoding,request.getClientInfo());
    }
    if (acceptLanguage != null) {
      request.getClientInfo().getAcceptedLanguages().clear();
      PreferenceUtils.parseLanguages(acceptLanguage,request.getClientInfo());
    }
    if (acceptMediaType != null) {
      request.getClientInfo().getAcceptedMediaTypes().clear();
      PreferenceUtils.parseMediaTypes(acceptMediaType,request.getClientInfo());
    }
  }
  if (isUriTunnel()) {
    String uri=(String)request.getAttributes().get(getUriAttribute());
    if (uri != null) {
      request.setResourceRef(uri);
    }
  }
}
