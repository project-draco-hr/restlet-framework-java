def test_basic_pty():
    try:
        debug('Calling master_open()')
        (master_fd, slave_name) = pty.master_open()
        debug(("Got master_fd '%d', slave_name '%s'" % (master_fd, slave_name)))
        debug(('Calling slave_open(%r)' % (slave_name,)))
        slave_fd = pty.slave_open(slave_name)
        debug(("Got slave_fd '%d'" % slave_fd))
    except OSError:
        raise TestSkipped, 'Pseudo-terminals (seemingly) not functional.'
    if (not os.isatty(slave_fd)):
        raise TestFailed, 'slave_fd is not a tty'
    debug('Writing to slave_fd')
    os.write(slave_fd, TEST_STRING_1)
    s1 = os.read(master_fd, 1024)
    sys.stdout.write(normalize_output(s1))
    debug('Writing chunked output')
    os.write(slave_fd, TEST_STRING_2[:5])
    os.write(slave_fd, TEST_STRING_2[5:])
    s2 = os.read(master_fd, 1024)
    sys.stdout.write(normalize_output(s2))
    os.close(slave_fd)
    os.close(master_fd)
