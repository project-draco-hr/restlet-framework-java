def test_default_encoding_issues(self):
    utf8 = "<?xml version='1.0' encoding='iso-8859-1'?>\n                  <params>\n                    <param><value>\n                      <string>abc \x95</string>\n                      </value></param>\n                    <param><value>\n                      <struct>\n                        <member>\n                          <name>def \x96</name>\n                          <value><string>ghi \x97</string></value>\n                          </member>\n                        </struct>\n                      </value></param>\n                  </params>\n                  "
    old_encoding = sys.getdefaultencoding()
    setdefaultencoding_existed = hasattr(sys, 'setdefaultencoding')
    reload(sys)
    sys.setdefaultencoding('iso-8859-1')
    try:
        ((s, d), m) = xmlrpclib.loads(utf8)
    finally:
        sys.setdefaultencoding(old_encoding)
        if (not setdefaultencoding_existed):
            del sys.setdefaultencoding
    items = d.items()
    if have_unicode:
        self.assertEquals(s, u'abc \x95')
        self.assert_(isinstance(s, unicode))
        self.assertEquals(items, [(u'def \x96', u'ghi \x97')])
        self.assert_(isinstance(items[0][0], unicode))
        self.assert_(isinstance(items[0][1], unicode))
    else:
        self.assertEquals(s, 'abc \xc2\x95')
        self.assertEquals(items, [('def \xc2\x96', 'ghi \xc2\x97')])
