{
  List<Representation> variants=resource.getVariants();
  if ((variants == null) || (variants.size() < 1)) {
    response.setStatus(Status.CLIENT_ERROR_NOT_FOUND);
  }
 else {
    Representation bestVariant=request.getClientInfo().getPreferredVariant(variants,fallbackLanguage);
    if (bestVariant == null) {
      response.setStatus(Status.CLIENT_ERROR_NOT_ACCEPTABLE);
    }
 else {
      boolean send=true;
      if ((request.getConditions().getNoneMatch() != null) && (request.getConditions().getNoneMatch().size() > 0)) {
        boolean matched=false;
        if (bestVariant.getTag() != null) {
          Tag tag;
          for (Iterator<Tag> iter=request.getConditions().getNoneMatch().iterator(); !matched && iter.hasNext(); ) {
            tag=iter.next();
            matched=tag.equals(bestVariant.getTag()) || tag.equals(Tag.ALL);
          }
        }
        send=!matched;
      }
 else {
        Date modifiedSince=request.getConditions().getModifiedSince();
        send=((modifiedSince == null) || (bestVariant.getModificationDate() == null) || DateUtils.after(modifiedSince,bestVariant.getModificationDate()));
      }
      if (send) {
        response.setEntity(bestVariant);
        response.setStatus(Status.SUCCESS_OK);
      }
 else {
        response.setStatus(Status.REDIRECTION_NOT_MODIFIED);
      }
    }
  }
}
