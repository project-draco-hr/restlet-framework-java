{
  List<Representation> variants=resource.getVariants();
  if ((variants == null) || (variants.size() < 1)) {
    call.setStatus(Status.CLIENT_ERROR_NOT_FOUND);
  }
 else {
    Representation bestVariant=call.getClient().getPreferredVariant(variants,fallbackLanguage);
    if (bestVariant == null) {
      call.setStatus(Status.CLIENT_ERROR_NOT_ACCEPTABLE);
    }
 else {
      boolean send=true;
      if ((call.getCondition().getNoneMatch() != null) && (call.getCondition().getNoneMatch().size() > 0)) {
        boolean matched=false;
        if (bestVariant.getTag() != null) {
          Tag tag;
          for (Iterator<Tag> iter=call.getCondition().getNoneMatch().iterator(); !matched && iter.hasNext(); ) {
            tag=iter.next();
            matched=tag.equals(bestVariant.getTag()) || tag.equals(Tag.ALL);
          }
        }
        send=!matched;
      }
 else {
        Date modifiedSince=call.getCondition().getModifiedSince();
        send=((modifiedSince == null) || (bestVariant.getModificationDate() == null) || DateUtils.after(modifiedSince,bestVariant.getModificationDate()));
      }
      if (send) {
        call.setOutput(bestVariant);
        call.setStatus(Status.SUCCESS_OK);
      }
 else {
        call.setStatus(Status.REDIRECTION_NOT_MODIFIED);
      }
    }
  }
}
