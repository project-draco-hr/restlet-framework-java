{
  Reference result=null;
  if (uri != null) {
    StringBuilder base=new StringBuilder();
    if (new Reference(uri).isRelative()) {
      base.append(this.base).append(uri);
    }
 else {
      base.append(uri);
    }
    if (localName != null) {
      result=new Reference(base.append(localName).toString());
    }
 else {
      result=new Reference(base.toString());
    }
  }
 else   if (name != null) {
    int index=name.indexOf(":");
    if (index != -1) {
      String prefix=name.substring(0,index);
      if (this.prefixes.containsKey(prefix)) {
        result=new Reference(this.prefixes.get(prefix) + name.substring(index + 1));
      }
    }
  }
 else {
    result=new Reference(this.base + localName);
  }
  return result;
}
