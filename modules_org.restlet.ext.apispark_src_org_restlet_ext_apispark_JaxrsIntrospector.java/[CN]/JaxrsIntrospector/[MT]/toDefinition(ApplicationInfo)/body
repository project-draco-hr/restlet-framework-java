{
  Definition result=null;
  if (application != null) {
    result=new Definition();
    result.setVersion(application.getVersion());
    if (application.getResources().getBaseRef() != null) {
      result.setEndpoint(application.getResources().getBaseRef().toString());
    }
    Contract contract=new Contract();
    result.setContract(contract);
    contract.setDescription(toString(application.getDocumentations()));
    contract.setName(application.getName());
    if (contract.getName() == null || contract.getName().isEmpty()) {
      contract.setName(application.getClass().getName());
      LOGGER.log(Level.WARNING,"Please provide a name to your application, used " + contract.getName() + " by default.");
    }
    LOGGER.info("Contract " + contract.getName() + " added.");
    contract.setResources(new ArrayList<Resource>());
    Map<String,RepresentationInfo> mapReps=new HashMap<String,RepresentationInfo>();
    addResources(application,contract,application.getResources().getResources(),result.getEndpoint(),mapReps);
    java.util.List<String> protocols=new ArrayList<String>();
    for (    ConnectorHelper<Server> helper : Engine.getInstance().getRegisteredServers()) {
      for (      Protocol protocol : helper.getProtocols()) {
        if (!protocols.contains(protocol.getName())) {
          LOGGER.info("Protocol " + protocol.getName() + " added.");
          protocols.add(protocol.getName());
        }
      }
    }
    contract.setRepresentations(new ArrayList<Representation>());
    for (    RepresentationInfo ri : application.getRepresentations()) {
      if (!mapReps.containsKey(ri.getIdentifier())) {
        mapReps.put(ri.getIdentifier(),ri);
      }
    }
    List<RepresentationInfo> toBeAdded=new ArrayList<RepresentationInfo>();
    for (    RepresentationInfo ri : mapReps.values()) {
      if (ri.isRaw()) {
        continue;
      }
      if (ri.isCollection() && !mapReps.containsKey(ri.getType().getName())) {
        RepresentationInfo r=new RepresentationInfo(ri.getMediaType());
        r.setType(ri.getType());
        toBeAdded.add(r);
      }
      Class<?> parentType=ri.getType().getSuperclass();
      if (parentType != null && ReflectUtils.isJdkClass(parentType)) {
        parentType=null;
      }
      if (parentType != null && !mapReps.containsKey(parentType.getName())) {
        RepresentationInfo r=new RepresentationInfo(ri.getMediaType());
        r.setType(parentType);
        toBeAdded.add(r);
      }
      for (      PropertyInfo pi : ri.getProperties()) {
        if (pi.getType() != null && !mapReps.containsKey(pi.getType().getName()) && !toBeAdded.contains(pi.getType())) {
          RepresentationInfo r=new RepresentationInfo(ri.getMediaType());
          r.setType(pi.getType());
          toBeAdded.add(r);
        }
      }
    }
    while (!toBeAdded.isEmpty()) {
      RepresentationInfo[] tab=new RepresentationInfo[toBeAdded.size()];
      toBeAdded.toArray(tab);
      toBeAdded.clear();
      for (int i=0; i < tab.length; i++) {
        RepresentationInfo current=tab[i];
        if (!current.isRaw() && !ReflectUtils.isJdkClass(current.getType())) {
          if (!mapReps.containsKey(current.getName())) {
            RepresentationInfo ri=RepresentationInfo.introspect(current.getType(),null,current.getMediaType());
            mapReps.put(ri.getIdentifier(),ri);
            Class<?> parentType=ri.getType().getSuperclass();
            if (parentType != null && ReflectUtils.isJdkClass(parentType)) {
              parentType=null;
            }
            if (parentType != null && !mapReps.containsKey(parentType.getName())) {
              RepresentationInfo r=new RepresentationInfo(ri.getMediaType());
              r.setType(parentType);
              toBeAdded.add(r);
            }
            for (            PropertyInfo pi : ri.getProperties()) {
              if (pi.getType() != null && !mapReps.containsKey(pi.getType().getName()) && !toBeAdded.contains(pi.getType())) {
                RepresentationInfo r=new RepresentationInfo(ri.getMediaType());
                r.setType(pi.getType());
                toBeAdded.add(r);
              }
            }
          }
        }
      }
    }
    for (    RepresentationInfo ri : mapReps.values()) {
      if (ReflectUtils.isJdkClass(ri.getType())) {
        continue;
      }
      LOGGER.info("Representation " + ri.getName() + " added.");
      Representation rep=new Representation();
      rep.setDescription(toString(ri.getDocumentations()));
      rep.setName(ri.getName());
      rep.setProperties(new ArrayList<Property>());
      for (      PropertyInfo pi : ri.getProperties()) {
        LOGGER.info("Property " + pi.getName() + " added.");
        Property p=new Property();
        p.setDefaultValue(pi.getDefaultValue());
        p.setDescription(pi.getDescription());
        p.setMax(pi.getMax());
        p.setMaxOccurs(pi.getMaxOccurs());
        p.setMin(pi.getMin());
        p.setMinOccurs(pi.getMinOccurs());
        p.setName(pi.getName());
        p.setPossibleValues(pi.getPossibleValues());
        if (pi.getType() != null) {
          p.setType(pi.getType().getSimpleName());
        }
        p.setUniqueItems(pi.isUniqueItems());
        rep.getProperties().add(p);
      }
      rep.setRaw(ri.isRaw());
      contract.getRepresentations().add(rep);
    }
  }
  return result;
}
