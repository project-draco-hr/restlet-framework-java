{
  int i=0;
  int j=0;
  boolean stop=false;
  char[] encodeds=encodedFileName.toCharArray();
  char[] decodeds=decodedVariantFileName.toCharArray();
  for (i=0; (i < decodeds.length) && (j < encodeds.length) && !stop; i++) {
    char decodedChar=decodeds[i];
    char encodedChar=encodeds[j];
    if (encodedChar == '%') {
      String dec=Reference.decode(encodedFileName.substring(j,j + 3));
      if (decodedChar == dec.charAt(0)) {
        j+=3;
      }
 else {
        stop=true;
      }
    }
 else     if (decodedChar == decodedChar) {
      j++;
    }
 else {
      String dec=Reference.decode(encodedFileName.substring(j,j + 1));
      if (decodedChar == dec.charAt(0)) {
        j++;
      }
 else {
        stop=true;
      }
    }
  }
  if (stop) {
    return encodedFileName.substring(0,j) + decodedVariantFileName.substring(i - 1);
  }
  if (j == encodedFileName.length()) {
    return encodedFileName.substring(0,j) + decodedVariantFileName.substring(i);
  }
  return encodedFileName.substring(0,j);
}
