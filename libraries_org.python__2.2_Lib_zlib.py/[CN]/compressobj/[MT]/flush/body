def flush(self, mode=Z_FINISH):
    if self._ended:
        raise error('compressobj may not be used after flush(Z_FINISH)')
    if (mode not in _valid_flush_modes):
        raise ValueError, 'Invalid flush option'
    self.deflater.finish()
    last = _get_deflate_data(self.deflater)
    if (mode == Z_FINISH):
        self.deflater.end()
        self._ended = True
    return last
