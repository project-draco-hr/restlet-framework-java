{
  super(directory.getLogger());
  this.directory=directory;
  this.request=request;
  this.relativePart=request.getRelativePart();
  if (this.relativePart.startsWith("/")) {
    this.relativePart=this.relativePart.substring(1);
  }
  this.targetUri=new Reference(directory.getRootUri() + this.relativePart).normalize().toString();
  if (!this.targetUri.startsWith(directory.getRootUri())) {
    this.targetUri=directory.getRootUri();
  }
  Response contextResponse=getDispatcher().get(this.targetUri);
  if ((contextResponse.getEntity() != null) && contextResponse.getEntity().getMediaType().equals(MediaType.TEXT_URI_LIST)) {
    this.targetDirectory=true;
    this.directoryContent=new ReferenceList(contextResponse.getEntity());
    if (!this.targetUri.endsWith("/")) {
      this.targetUri+="/";
      this.relativePart+="/";
    }
    if (getMetadataService().getIndexName() != null) {
      this.directoryUri=this.targetUri;
      this.baseName=getMetadataService().getIndexName();
      this.targetUri=this.directoryUri + this.baseName;
    }
 else {
      this.directoryUri=this.targetUri;
      this.baseName=null;
    }
  }
 else {
    this.targetDirectory=false;
    int lastSlashIndex=targetUri.lastIndexOf('/');
    if (lastSlashIndex == -1) {
      this.directoryUri="";
      this.baseName=targetUri;
    }
 else {
      this.directoryUri=targetUri.substring(0,lastSlashIndex + 1);
      this.baseName=targetUri.substring(lastSlashIndex + 1);
    }
    contextResponse=getDispatcher().get(this.directoryUri);
    if ((contextResponse.getEntity() != null) && contextResponse.getEntity().getMediaType().equals(MediaType.TEXT_URI_LIST)) {
      this.directoryContent=new ReferenceList(contextResponse.getEntity());
    }
  }
  if (this.directory.isNegotiateContent()) {
    int firstDotIndex=this.baseName.indexOf('.');
    if (firstDotIndex != -1) {
      this.baseExtensions=getExtensions(this.baseName);
      this.baseName=this.baseName.substring(0,firstDotIndex);
    }
  }
  getLogger().info("Converted base path: " + this.targetUri);
  getLogger().info("Converted base name: " + this.baseName);
}
