def makefile(self, mode='r', bufsize=(-1)):
    file = None
    if self.istream:
        if self.ostream:
            file = org.python.core.PyFile(self.istream, self.ostream, '<socket>', mode)
        else:
            file = org.python.core.PyFile(self.istream, '<socket>', mode)
    elif self.ostream:
        file = org.python.core.PyFile(self.ostream, '<socket>', mode)
    else:
        raise IOError, 'both istream and ostream have been shut down'
    if file:
        return _tcpsocket.FileWrapper(self, file)
