def getreply(self):
    "Get a reply from the server.\n\n        Returns a tuple consisting of:\n\n          - server response code (e.g. '250', or such, if all goes well)\n            Note: returns -1 if it can't read response code.\n\n          - server response string corresponding to response code (multiline\n            responses are converted to a single, multiline string).\n\n        Raises SMTPServerDisconnected if end-of-file is reached.\n        "
    resp = []
    if (self.file is None):
        self.file = self.sock.makefile('rb')
    while 1:
        line = self.file.readline()
        if (line == ''):
            self.close()
            raise SMTPServerDisconnected('Connection unexpectedly closed')
        if (self.debuglevel > 0):
            print  >> stderr, 'reply:', repr(line)
        resp.append(line[4:].strip())
        code = line[:3]
        try:
            errcode = int(code)
        except ValueError:
            errcode = (-1)
            break
        if (line[3:4] != '-'):
            break
    errmsg = '\n'.join(resp)
    if (self.debuglevel > 0):
        print  >> stderr, ('reply: retcode (%s); Msg: %s' % (errcode, errmsg))
    return (errcode, errmsg)
