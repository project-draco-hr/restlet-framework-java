{
  final SslContextFactory sslContextFactory=HttpsUtils.getSslContextFactory(this);
  SSLContext sslContext;
  if (sslContextFactory == null) {
    final KeyStore keyStore=KeyStore.getInstance(getKeystoreType());
    final FileInputStream fis=getKeystorePath() == null ? null : new FileInputStream(getKeystorePath());
    final char[] password=getKeystorePassword() == null ? null : getKeystorePassword().toCharArray();
    keyStore.load(fis,password);
    if (fis != null) {
      fis.close();
    }
    final KeyManagerFactory keyManagerFactory=KeyManagerFactory.getInstance(getCertAlgorithm());
    keyManagerFactory.init(keyStore,getKeyPassword().toCharArray());
    final TrustManagerFactory trustManagerFactory=TrustManagerFactory.getInstance(getCertAlgorithm());
    trustManagerFactory.init(keyStore);
    sslContext=SSLContext.getInstance(getSslProtocol());
    sslContext.init(keyManagerFactory.getKeyManagers(),trustManagerFactory.getTrustManagers(),null);
  }
 else {
    sslContext=sslContextFactory.createSslContext();
  }
  SSLServerSocket serverSocket=null;
  final String addr=getHelped().getAddress();
  if (addr != null) {
    final InetAddress iaddr=InetAddress.getByName(addr);
    serverSocket=(SSLServerSocket)sslContext.getServerSocketFactory().createServerSocket(getHelped().getPort(),50,iaddr);
  }
 else {
    serverSocket=(SSLServerSocket)sslContext.getServerSocketFactory().createServerSocket(getHelped().getPort());
  }
  if (isNeedClientAuthentication()) {
    serverSocket.setNeedClientAuth(true);
  }
 else   if (isWantClientAuthentication()) {
    serverSocket.setWantClientAuth(true);
  }
  String[] enabledCipherSuites=HttpsUtils.getEnabledCipherSuites(this);
  String[] excludedCipherSuites=HttpsUtils.getExcludedCipherSuites(this);
  if (excludedCipherSuites != null) {
    if (enabledCipherSuites == null) {
      enabledCipherSuites=serverSocket.getEnabledCipherSuites();
    }
    List<String> enabledCipherSuitesList=new ArrayList<String>(Arrays.asList(enabledCipherSuites));
    for (    String excludedCipherSuite : excludedCipherSuites) {
      enabledCipherSuitesList.remove(excludedCipherSuite);
    }
    enabledCipherSuites=enabledCipherSuitesList.toArray(enabledCipherSuites);
  }
  if (enabledCipherSuites != null) {
    serverSocket.setEnabledCipherSuites(enabledCipherSuites);
  }
  serverSocket.setSoTimeout(60000);
  setSocket(serverSocket);
  setConfidential(true);
  setHandler(PipelineHandlerFactory.getInstance(new SimpleProtocolHandler(this),getDefaultThreads(),getMaxWaitTimeMs()));
  setConnection(ConnectionFactory.getConnection(getHandler(),new SimplePipelineFactory()));
  getConnection().connect(getSocket());
  super.start();
}
