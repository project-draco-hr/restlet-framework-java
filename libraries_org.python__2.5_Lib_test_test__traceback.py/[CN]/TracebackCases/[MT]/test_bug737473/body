def test_bug737473(self):
    import sys, os, tempfile, time
    savedpath = sys.path[:]
    testdir = tempfile.mkdtemp()
    try:
        sys.path.insert(0, testdir)
        testfile = os.path.join(testdir, 'test_bug737473.py')
        with open(testfile, 'w') as fp:
            print  >> fp, '\ndef test():\n    raise ValueError'
        if ('test_bug737473' in sys.modules):
            del sys.modules['test_bug737473']
        import test_bug737473
        try:
            test_bug737473.test()
        except ValueError:
            traceback.extract_tb(sys.exc_traceback)
        time.sleep(4)
        with open(testfile, 'w') as fp:
            print  >> fp, '\ndef test():\n    raise NotImplementedError'
        reload(test_bug737473)
        try:
            test_bug737473.test()
        except NotImplementedError:
            src = traceback.extract_tb(sys.exc_traceback)[(-1)][(-1)]
            self.failUnlessEqual(src, 'raise NotImplementedError')
    finally:
        sys.path[:] = savedpath
        for f in os.listdir(testdir):
            os.unlink(os.path.join(testdir, f))
        os.rmdir(testdir)
