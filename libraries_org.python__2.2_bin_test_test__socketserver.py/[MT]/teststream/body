def teststream(proto, addr):
    s = socket.socket(proto, socket.SOCK_STREAM)
    s.connect(addr)
    s.sendall(teststring)
    buf = data = receive(s, 100)
    while (data and ('\n' not in buf)):
        data = receive(s, 100)
        buf += data
    verify((buf == teststring))
    s.close()
