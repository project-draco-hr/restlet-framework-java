def test_subclass_refs(self):


    class MyRef(weakref.ref):

        def __init__(self, ob, callback=None, value=42):
            self.value = value
            super(MyRef, self).__init__(ob, callback)

        def __call__(self):
            self.called = True
            return super(MyRef, self).__call__()
    o = Object('foo')
    mr = MyRef(o, value=24)
    self.assert_((mr() is o))
    self.assert_(mr.called)
    self.assertEqual(mr.value, 24)
    del o
    self.assert_((mr() is None))
    self.assert_(mr.called)
