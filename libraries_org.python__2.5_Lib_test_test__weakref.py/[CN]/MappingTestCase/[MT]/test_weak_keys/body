def test_weak_keys(self):
    (dict, objects) = self.make_weak_keyed_dict()
    for o in objects:
        self.assert_((weakref.getweakrefcount(o) == 1), ('wrong number of weak references to %r!' % o))
        self.assert_((o.arg is dict[o]), 'wrong object returned by weak dict!')
    items1 = dict.items()
    items2 = dict.copy().items()
    self.assert_((set(items1) == set(items2)), 'cloning of weak-keyed dictionary did not work!')
    del items1, items2
    self.assert_((len(dict) == self.COUNT))
    del objects[0]
    extra_collect()
    self.assert_((len(dict) == (self.COUNT - 1)), 'deleting object did not cause dictionary update')
    del objects, o
    extra_collect()
    self.assert_((len(dict) == 0), 'deleting the keys did not clear the dictionary')
    o = Object(42)
    dict[o] = 'What is the meaning of the universe?'
    self.assert_(dict.has_key(o))
    self.assert_((not dict.has_key(34)))
