def test_expandvars(self):
    oldenv = os.environ.copy()
    try:
        os.environ.clear()
        os.environ['foo'] = 'bar'
        os.environ['{foo'] = 'baz1'
        os.environ['{foo}'] = 'baz2'
        self.assertEqual(posixpath.expandvars('foo'), 'foo')
        self.assertEqual(posixpath.expandvars('$foo bar'), 'bar bar')
        self.assertEqual(posixpath.expandvars('${foo}bar'), 'barbar')
        self.assertEqual(posixpath.expandvars('$[foo]bar'), '$[foo]bar')
        self.assertEqual(posixpath.expandvars('$bar bar'), '$bar bar')
        self.assertEqual(posixpath.expandvars('$?bar'), '$?bar')
        self.assertEqual(posixpath.expandvars('${foo}bar'), 'barbar')
        self.assertEqual(posixpath.expandvars('$foo}bar'), 'bar}bar')
        self.assertEqual(posixpath.expandvars('${foo'), '${foo')
        self.assertEqual(posixpath.expandvars('${{foo}}'), 'baz1}')
    finally:
        os.environ.clear()
        os.environ.update(oldenv)
    self.assertRaises(TypeError, posixpath.expandvars)
