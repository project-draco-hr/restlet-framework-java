def unmimify_part(ifile, ofile, decode_base64=0):
    'Convert a quoted-printable part of a MIME mail message to 8bit.'
    multipart = None
    quoted_printable = 0
    is_base64 = 0
    is_repl = 0
    if (ifile.boundary and (ifile.boundary[:2] == QUOTE)):
        prefix = QUOTE
    else:
        prefix = ''
    hfile = HeaderFile(ifile)
    while 1:
        line = hfile.readline()
        if (not line):
            return
        if (prefix and (line[:len(prefix)] == prefix)):
            line = line[len(prefix):]
            pref = prefix
        else:
            pref = ''
        line = mime_decode_header(line)
        if qp.match(line):
            quoted_printable = 1
            continue
        if (decode_base64 and base64_re.match(line)):
            is_base64 = 1
            continue
        ofile.write((pref + line))
        if ((not prefix) and repl.match(line)):
            is_repl = 1
        mp_res = mp.match(line)
        if mp_res:
            multipart = ('--' + mp_res.group(1))
        if he.match(line):
            break
    if (is_repl and (quoted_printable or multipart)):
        is_repl = 0
    while 1:
        line = ifile.readline()
        if (not line):
            return
        line = re.sub(mime_head, '\\1', line)
        if (prefix and (line[:len(prefix)] == prefix)):
            line = line[len(prefix):]
            pref = prefix
        else:
            pref = ''
        while multipart:
            if (line == (multipart + '--\n')):
                ofile.write((pref + line))
                multipart = None
                line = None
                break
            if (line == (multipart + '\n')):
                ofile.write((pref + line))
                nifile = File(ifile, multipart)
                unmimify_part(nifile, ofile, decode_base64)
                line = nifile.peek
                if (not line):
                    break
                continue
            break
        if (line and quoted_printable):
            while (line[(-2):] == '=\n'):
                line = line[:(-2)]
                newline = ifile.readline()
                if (newline[:len(QUOTE)] == QUOTE):
                    newline = newline[len(QUOTE):]
                line = (line + newline)
            line = mime_decode(line)
        if (line and is_base64 and (not pref)):
            import base64
            line = base64.decodestring(line)
        if line:
            ofile.write((pref + line))
