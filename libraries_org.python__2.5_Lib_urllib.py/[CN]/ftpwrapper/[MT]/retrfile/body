def retrfile(self, file, type):
    import ftplib
    self.endtransfer()
    if (type in ('d', 'D')):
        cmd = 'TYPE A'
        isdir = 1
    else:
        cmd = ('TYPE ' + type)
        isdir = 0
    try:
        self.ftp.voidcmd(cmd)
    except ftplib.all_errors:
        self.init()
        self.ftp.voidcmd(cmd)
    conn = None
    if (file and (not isdir)):
        try:
            cmd = ('RETR ' + file)
            conn = self.ftp.ntransfercmd(cmd)
        except ftplib.error_perm as reason:
            if (str(reason)[:3] != '550'):
                raise IOError, ('ftp error', reason), sys.exc_info()[2]
    if (not conn):
        self.ftp.voidcmd('TYPE A')
        if file:
            cmd = ('LIST ' + file)
        else:
            cmd = 'LIST'
        conn = self.ftp.ntransfercmd(cmd)
    self.busy = 1
    return (addclosehook(conn[0].makefile('rb'), self.endtransfer), conn[1])
