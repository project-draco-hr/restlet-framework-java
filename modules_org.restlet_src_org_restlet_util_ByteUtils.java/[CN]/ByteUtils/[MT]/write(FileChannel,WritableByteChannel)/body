{
  long position=0;
  long count=fileChannel.size();
  long written=0;
  SelectableChannel selectableChannel=null;
  if (writableChannel instanceof SelectableChannel) {
    selectableChannel=(SelectableChannel)writableChannel;
  }
  while (count > 0) {
    NioUtils.waitForState(selectableChannel,SelectionKey.OP_WRITE);
    written=fileChannel.transferTo(position,count,writableChannel);
    position+=written;
    count-=written;
  }
}
