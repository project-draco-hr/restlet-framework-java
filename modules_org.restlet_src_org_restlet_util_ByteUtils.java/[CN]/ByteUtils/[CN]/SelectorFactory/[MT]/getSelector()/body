{
synchronized (selectors) {
    Selector selector=null;
    try {
      if (selectors.size() != 0) {
        selector=selectors.pop();
      }
    }
 catch (    final EmptyStackException ex) {
    }
    int attempts=0;
    try {
      while ((selector == null) && (attempts < 2)) {
        selectors.wait(timeout);
        try {
          if (selectors.size() != 0) {
            selector=selectors.pop();
          }
        }
 catch (        final EmptyStackException ex) {
          break;
        }
        attempts++;
      }
    }
 catch (    final InterruptedException ex) {
    }
    return selector;
  }
}
