def _test_single(self, filename):
    remove_if_exists(filename)
    f = file(filename, 'w')
    f.close()
    try:
        self._do_single(filename)
    finally:
        os.unlink(filename)
    self.failUnless((not os.path.exists(filename)))
    f = os.open(filename, os.O_CREAT)
    os.close(f)
    try:
        self._do_single(filename)
    finally:
        os.unlink(filename)
