def _do_directory(self, make_name, chdir_name, encoded):
    cwd = os.getcwd()
    if os.path.isdir(make_name):
        os.rmdir(make_name)
    os.mkdir(make_name)
    try:
        os.chdir(chdir_name)
        try:
            if (not encoded):
                cwd_result = os.getcwdu()
                name_result = make_name
            else:
                cwd_result = os.getcwd().decode(TESTFN_ENCODING)
                name_result = make_name.decode(TESTFN_ENCODING)
            cwd_result = unicodedata.normalize('NFD', cwd_result)
            name_result = unicodedata.normalize('NFD', name_result)
            self.failUnlessEqual(os.path.basename(cwd_result), name_result)
        finally:
            os.chdir(cwd)
    finally:
        os.rmdir(make_name)
