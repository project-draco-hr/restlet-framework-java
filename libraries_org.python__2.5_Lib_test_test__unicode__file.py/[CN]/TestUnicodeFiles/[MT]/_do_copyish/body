def _do_copyish(self, filename1, filename2):
    self.failUnless(os.path.isfile(filename1))
    os.rename(filename1, (filename2 + '.new'))
    self.failUnless(os.path.isfile((filename1 + '.new')))
    os.rename((filename1 + '.new'), filename2)
    self.failUnless(os.path.isfile(filename2))
    try:
        (filename1 == filename2)
    except UnicodeDecodeError:
        pass
    else:
        shutil.copy(filename1, (filename2 + '.new'))
        os.unlink((filename1 + '.new'))
        shutil.move(filename1, (filename2 + '.new'))
        self.failUnless((not os.path.exists(filename2)))
        shutil.move((filename1 + '.new'), filename2)
        self.failUnless(os.path.exists(filename1))
        shutil.copy2(filename1, (filename2 + '.new'))
        os.unlink((filename1 + '.new'))
