def open_local_file(self, req):
    import email.Utils
    import mimetypes
    host = req.get_host()
    file = req.get_selector()
    localfile = url2pathname(file)
    stats = os.stat(localfile)
    size = stats.st_size
    modified = email.Utils.formatdate(stats.st_mtime, usegmt=True)
    mtype = mimetypes.guess_type(file)[0]
    headers = mimetools.Message(StringIO(('Content-type: %s\nContent-length: %d\nLast-modified: %s\n' % ((mtype or 'text/plain'), size, modified))))
    if host:
        (host, port) = splitport(host)
    if ((not host) or ((not port) and (socket.gethostbyname(host) in self.get_names()))):
        return addinfourl(open(localfile, 'rb'), headers, ('file:' + file))
    raise URLError('file not on local host')
