{
  RestletChain restletChain=new RestletChain();
  if (modulesSettings.isAuthenticationModuleEnabled()) {
    LOGGER.info("Add authentication module");
    restletChain.add(new AuthenticationModule(agentConfig,modulesSettings,context));
  }
  if (modulesSettings.isAuthorizationModuleEnabled()) {
    if (!modulesSettings.isAuthenticationModuleEnabled()) {
      throw new AgentConfigurationException("The authorization module requires the authentication module which is not enabled");
    }
    LOGGER.info("Add authorization module");
    restletChain.add(new AuthorizationModule(agentConfig,modulesSettings,context));
  }
  if (modulesSettings.isFirewallModuleEnabled()) {
    LOGGER.info("Add firewall module");
    restletChain.add(new FirewallModule(agentConfig,modulesSettings,context));
  }
  if (modulesSettings.isAnalyticsModuleEnabled()) {
    LOGGER.info("Add analytics module");
    restletChain.add(new AnalyticsModule(agentConfig,modulesSettings,context));
  }
  if (restletChain.getFirst() == null) {
    LOGGER.warning("No modules are enabled.");
  }
  if (agentConfig.isRedirectionEnabled()) {
    LOGGER.info("Add redirection module");
    String redirectorUrl=agentConfig.getRedirectionUrl() + "{rr}";
    Redirector redirector=new Redirector(context,redirectorUrl,Redirector.MODE_SERVER_OUTBOUND);
    restletChain.add(redirector);
  }
  return restletChain;
}
