def test_it(self):

    def tr(frame, event, arg):
        raise ValueError

    def f():
        return 1
    try:
        for i in xrange((sys.getrecursionlimit() + 1)):
            sys.settrace(tr)
            try:
                f()
            except ValueError:
                pass
            else:
                self.fail('exception not thrown!')
    except RuntimeError:
        self.fail('recursion counter not reset')
