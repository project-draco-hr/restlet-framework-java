def updatecache(filename):
    "Update a cache entry and return its list of lines.\n    If something's wrong, print a message, discard the cache entry,\n    and return an empty list."
    if cache.has_key(filename):
        del cache[filename]
    if ((not filename) or ((filename[0] + filename[(-1)]) == '<>')):
        return []
    fullname = filename
    try:
        stat = os.stat(fullname)
    except os.error as msg:
        basename = os.path.split(filename)[1]
        for dirname in sys.path:
            try:
                fullname = os.path.join(dirname, basename)
            except (TypeError, AttributeError):
                pass
            else:
                try:
                    stat = os.stat(fullname)
                    break
                except os.error:
                    pass
        else:
            return []
    try:
        fp = open(fullname, 'r')
        lines = fp.readlines()
        fp.close()
    except IOError as msg:
        return []
    (size, mtime) = (stat[ST_SIZE], stat[ST_MTIME])
    cache[filename] = (size, mtime, lines, fullname)
    return lines
