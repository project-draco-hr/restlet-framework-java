def findmatch(caps, MIMEtype, key='view', filename='/dev/null', plist=[]):
    "Find a match for a mailcap entry.\n\n    Return a tuple containing the command line, and the mailcap entry\n    used; (None, None) if no match is found.  This may invoke the\n    'test' command of several matching entries before deciding which\n    entry to use.\n\n    "
    entries = lookup(caps, MIMEtype, key)
    for e in entries:
        if e.has_key('test'):
            test = subst(e['test'], filename, plist)
            if (test and (os.system(test) != 0)):
                continue
        command = subst(e[key], MIMEtype, filename, plist)
        return (command, e)
    return (None, None)
