def fakehttp(self, fakedata):


    class FakeSocket(StringIO.StringIO):

        def sendall(self, str):
            pass

        def makefile(self, mode, name):
            return self

        def read(self, amt=None):
            if self.closed:
                return ''
            return StringIO.StringIO.read(self, amt)

        def readline(self, length=None):
            if self.closed:
                return ''
            return StringIO.StringIO.readline(self, length)


    class FakeHTTPConnection(httplib.HTTPConnection):

        def connect(self):
            self.sock = FakeSocket(fakedata)
    assert (httplib.HTTP._connection_class == httplib.HTTPConnection)
    httplib.HTTP._connection_class = FakeHTTPConnection
