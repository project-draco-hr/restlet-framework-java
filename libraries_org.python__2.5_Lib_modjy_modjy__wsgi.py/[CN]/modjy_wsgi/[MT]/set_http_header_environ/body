def set_http_header_environ(self, req, resp, dict):
    header_name_enum = req.getHeaderNames()
    while header_name_enum.hasMoreElements():
        curr_header_name = header_name_enum.nextElement()
        values = None
        values_enum = req.getHeaders(curr_header_name)
        while values_enum.hasMoreElements():
            next_value = values_enum.nextElement().encode(cgi_var_char_encoding)
            if (values is None):
                values = next_value
            elif isinstance(values, list):
                values.append(next_value)
            else:
                values = [values]
        dict[('HTTP_%s' % str(curr_header_name).replace('-', '_').upper())] = values
