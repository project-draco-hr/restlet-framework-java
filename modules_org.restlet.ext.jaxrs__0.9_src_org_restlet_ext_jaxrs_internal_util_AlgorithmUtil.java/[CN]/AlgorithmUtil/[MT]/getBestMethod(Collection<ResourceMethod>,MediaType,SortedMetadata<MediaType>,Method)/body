{
  SortedMetadata<MediaType> givenMediaTypes;
  if (givenMediaType != null) {
    givenMediaTypes=SortedMetadata.singleton(givenMediaType);
  }
 else {
    givenMediaTypes=null;
  }
  Map<ResourceMethod,List<MediaType>> mms1;
  mms1=findMethodSupportsMime(resourceMethods,ConsOrProdMime.CONSUME_MIME,givenMediaTypes);
  if (mms1.isEmpty()) {
    return Util.getFirstElement(resourceMethods);
  }
  if (mms1.size() == 1) {
    return Util.getFirstKey(mms1);
  }
  Map<ResourceMethod,List<MediaType>> mms2;
  mms2=findMethodSupportsMime(mms1.keySet(),ConsOrProdMime.PRODUCE_MIME,accMediaTypes);
  if (mms2.isEmpty()) {
    return Util.getFirstKey(mms1);
  }
  if (mms2.size() == 1) {
    return Util.getFirstKey(mms2);
  }
  for (  final MediaType accMediaType : accMediaTypes) {
    ResourceMethod bestMethod=null;
    for (    final Map.Entry<ResourceMethod,List<MediaType>> mm : mms2.entrySet()) {
      for (      final MediaType methodMediaType : mm.getValue()) {
        if (accMediaType.includes(methodMediaType)) {
          final ResourceMethod currentMethod=mm.getKey();
          if (bestMethod == null) {
            bestMethod=currentMethod;
          }
 else {
            if (httpMethod.equals(Method.HEAD)) {
              final Method bestMethodHttp=bestMethod.getHttpMethod();
              if (bestMethodHttp.equals(Method.GET) && currentMethod.getHttpMethod().equals(Method.HEAD)) {
              }
 else               if (bestMethod.getHttpMethod().equals(Method.HEAD) && currentMethod.getHttpMethod().equals(Method.GET)) {
                bestMethod=currentMethod;
              }
 else {
              }
            }
 else {
            }
          }
        }
      }
    }
    if (bestMethod != null) {
      return bestMethod;
    }
  }
  return Util.getFirstKey(mms2);
}
