{
  final List<Variant> results=super.getVariants();
  if (!results.isEmpty()) {
    return results;
  }
  getLogger().info("Getting variants for : " + getTargetUri());
  if ((this.directoryContent != null) && (getRequest().getResourceRef() != null) && (getRequest().getResourceRef().getBaseRef() != null)) {
    final SortedSet<Representation> resultSet=new TreeSet<Representation>(getRepresentationsComparator());
    String baseRef=getRequest().getResourceRef().getBaseRef().toString(false,false);
    if (!baseRef.endsWith("/")) {
      baseRef+="/";
    }
    final int lastIndex=this.relativePart.lastIndexOf("/");
    if (lastIndex != -1) {
      baseRef+=this.relativePart.substring(0,lastIndex);
    }
    final int rootLength=getDirectoryUri().length();
    if (this.baseName != null) {
      String filePath;
      for (      final Reference ref : getVariantsReferences()) {
        final Response contextResponse=getRepresentation(ref.toString());
        if (contextResponse.getStatus().isSuccess() && (contextResponse.getEntity() != null)) {
          filePath=ref.toString(false,false).substring(rootLength);
          final Representation rep=contextResponse.getEntity();
          if (filePath.startsWith("/")) {
            rep.setIdentifier(baseRef + filePath);
          }
 else {
            rep.setIdentifier(baseRef + "/" + filePath);
          }
          resultSet.add(rep);
        }
      }
    }
    results.addAll(resultSet);
    if (resultSet.isEmpty()) {
      if (this.directoryTarget && getDirectory().isListingAllowed()) {
        final ReferenceList userList=new ReferenceList(this.directoryContent.size());
        userList.setIdentifier(baseRef);
        final SortedSet<Reference> sortedSet=new TreeSet<Reference>(getDirectory().getComparator());
        sortedSet.addAll(this.directoryContent);
        for (        final Reference ref : sortedSet) {
          final String filePart=ref.toString(false,false).substring(rootLength);
          final StringBuilder filePath=new StringBuilder();
          if ((!baseRef.endsWith("/")) && (!filePart.startsWith("/"))) {
            filePath.append('/');
          }
          filePath.append(filePart);
          userList.add(baseRef + filePath);
        }
        final List<Variant> list=getDirectory().getIndexVariants(userList);
        for (        final Variant variant : list) {
          results.add(getDirectory().getIndexRepresentation(variant,userList));
        }
      }
    }
  }
 else   if (this.fileTarget && (this.fileContent != null)) {
    if (getRequest().getOriginalRef() != null) {
      this.fileContent.setIdentifier(getRequest().getOriginalRef());
    }
 else {
      this.fileContent.setIdentifier(getRequest().getResourceRef());
    }
    results.add(this.fileContent);
  }
  return results;
}
