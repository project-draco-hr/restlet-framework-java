def _dump_message(self, message, target, mangle_from_=False):
    'Dump message contents to target file.'
    if isinstance(message, email.Message.Message):
        buffer = StringIO.StringIO()
        gen = email.Generator.Generator(buffer, mangle_from_, 0)
        gen.flatten(message)
        buffer.seek(0)
        target.write(buffer.read().replace('\n', os.linesep))
    elif isinstance(message, str):
        if mangle_from_:
            message = message.replace('\nFrom ', '\n>From ')
        message = message.replace('\n', os.linesep)
        target.write(message)
    elif hasattr(message, 'read'):
        while True:
            line = message.readline()
            if (line == ''):
                break
            if (mangle_from_ and line.startswith('From ')):
                line = ('>From ' + line[5:])
            line = line.replace('\n', os.linesep)
            target.write(line)
    else:
        raise TypeError(('Invalid message type: %s' % type(message)))
