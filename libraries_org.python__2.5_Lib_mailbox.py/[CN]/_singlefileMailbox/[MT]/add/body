def add(self, message):
    'Add message and return assigned key.'
    self._lookup()
    self._toc[self._next_key] = self._append_message(message)
    self._next_key += 1
    self._pending = True
    return (self._next_key - 1)
