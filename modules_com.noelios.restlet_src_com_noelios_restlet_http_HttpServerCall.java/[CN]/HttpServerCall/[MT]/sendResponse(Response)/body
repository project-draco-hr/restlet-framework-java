{
  if (response != null) {
    try {
      writeResponseHead(response);
      Representation entity=response.getEntity();
      if (entity != null) {
        ConnectorService connectorService=getConnectorService(response.getRequest());
        if (connectorService != null)         connectorService.beforeSend(entity);
        writeResponseBody(entity);
        if (connectorService != null)         connectorService.afterSend(entity);
      }
      if (getResponseEntityStream() != null) {
        try {
          getResponseEntityStream().flush();
          getResponseEntityStream().close();
        }
 catch (        IOException ioe) {
          getLogger().log(Level.FINE,"Exception while flushing and closing the entity stream.",ioe);
        }
      }
    }
  finally {
      Representation entity=response.getEntity();
      if (entity != null) {
        entity.release();
      }
    }
  }
}
