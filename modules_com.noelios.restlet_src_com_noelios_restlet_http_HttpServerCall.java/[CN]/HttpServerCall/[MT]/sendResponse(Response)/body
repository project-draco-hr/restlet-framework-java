{
  if (response != null) {
    try {
      writeResponseHead(response);
      Representation entity=response.getEntity();
      if ((entity != null) && !response.getRequest().getMethod().equals(Method.HEAD) && !response.getStatus().equals(Status.SUCCESS_NO_CONTENT)&& !response.getStatus().equals(Status.SUCCESS_RESET_CONTENT)) {
        ConnectorService connectorService=getConnectorService(response.getRequest());
        if (connectorService != null)         connectorService.beforeSend(entity);
        writeResponseBody(entity);
        if (connectorService != null)         connectorService.afterSend(entity);
      }
 else {
        if (response.getStatus().isRedirection()) {
          if (getResponseEntityStream() != null) {
            getResponseEntityStream().write(13);
            getResponseEntityStream().write(10);
          }
        }
      }
      if (getResponseEntityStream() != null) {
        getResponseEntityStream().flush();
        getResponseEntityStream().close();
      }
    }
  finally {
      Representation entity=response.getEntity();
      if (entity != null) {
        entity.release();
      }
    }
  }
}
