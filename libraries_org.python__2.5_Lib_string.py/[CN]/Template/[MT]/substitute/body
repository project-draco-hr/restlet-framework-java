def substitute(self, *args, **kws):
    if (len(args) > 1):
        raise TypeError('Too many positional arguments')
    if (not args):
        mapping = kws
    elif kws:
        mapping = _multimap(kws, args[0])
    else:
        mapping = args[0]

    def convert(mo):
        named = (mo.group('named') or mo.group('braced'))
        if (named is not None):
            val = mapping[named]
            return ('%s' % (val,))
        if (mo.group('escaped') is not None):
            return self.delimiter
        if (mo.group('invalid') is not None):
            self._invalid(mo)
        raise ValueError('Unrecognized named group in pattern', self.pattern)
    return self.pattern.sub(convert, self.template)
