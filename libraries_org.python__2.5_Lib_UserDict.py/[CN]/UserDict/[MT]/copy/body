def copy(self):
    if (self.__class__ is UserDict):
        return UserDict(self.data.copy())
    import copy
    data = self.data
    try:
        self.data = {}
        c = copy.copy(self)
    finally:
        self.data = data
    c.update(self)
    return c
